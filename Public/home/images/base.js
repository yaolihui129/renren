/* from src/app/mainframe/vipSkinEntry.js */define("vipSkinEntry",["jquery"],function(e){var t={init:function(){var t=e("#hometpl_style");return t.length>0&&t.data("notshow")!==1&&(this.btnSkin=e('<div class="vip-skinBtn"></div>').appendTo("#nxHeader .hd-fixed-wraper"),this.btnEntryAction()),this.btnSkin||e()},btnEntryAction:function(){var t=this.btnSkin,n=1,r=null,i=function(){var n=e(window).width()-(e("#webpager").width()||0)-e("#nxHeader .hd-nav").get(0).getBoundingClientRect().right;n<40?t.hide():t.show()};e(document).on("webpager:loaded",function(){i(),t.appendTo("#webpager")}),e(document).on("mainframe:reflow",i),i(),t.on({mouseover:function(){r=setInterval(function(){n<15?(t.css({backgroundPosition:"0 "+ -n*50+"px"}),n+=1):n=4},100)},mouseout:function(){clearInterval(r),n=1,t.css({backgroundPosition:"0 0"})},click:function(){e.ajax({url:"http://i.renren.com/api4v7/getV7SkinJsSrc",type:"post",dataType:"json",success:function(e){require.config({paths:{"vip/skin":e[0]}}),require(["vip/skin"],function(e){e.init()})}})}})}};return t}),define("backToTop",["jquery"],function(e){var t={init:function(){this.btn=e("#toolBackTo"),this.backBtn=e("a:first",this.btn),this.doc=e(document),this.win=e(window),this.indexEvents(),this.position()},position:function(){var t=(e("#webpager").width()===240?240:0)+20;this.btn.css("right",t)},indexEvents:function(){var e=this;this.backBtn.on("click",function(){e.doc.scrollTop(0)}),this.win.on("scroll/1",function(){e.doc.scrollTop()===0?e.backBtn.hide():e.backBtn.css("display","block")}),this.doc.on("mainframe:reflow",this.position.bind(this))}};return{init:function(){t.init()}}}),define("feedbackLayer",function(require,e){var t=jQuery.noConflict(),n={isValidate:!0,totalWords:1e3,succMsg:"反馈已发送，我们将尽快处理您的意见或建议。<br />感谢您对2014新版人人网的支持！",errMsg:"服务器错误，请重试！",renderTpl:function(){var e=t("<div></div>").html(['<textarea placeholder="建议描述(必填)"></textarea>',"<p><span>0</span>/"+this.totalWords+"</p>"].join("")).attr("class","v7-feedback-layer");return this.layerDom=e,this.contentArea=e.find("textarea"),this.wordCon=e.find("p"),this.wordsCount=e.find("span"),e},buildLayer:function(){var e=this;t.ui.dialog({title:"建议反馈",width:522,buttons:[{text:"取消",click:function(){t(this).dialog("instance").close()}},{text:"确定",id:"fb_submit",disabled:!0,click:function(){e.submitContent(t(this).dialog("instance"))}}],close:function(){t(this).remove()}},this.renderTpl()),this.submitBtn=t("#fb_submit"),this.submitBtn.parent().after('<a class="feedback-link" href="http://fans.renren.com/forum.php?mod=forumdisplay&fid=71" target="_blank">前往人人粉丝论坛</a>')},toggleBtnState:function(e){e=="enable"?this.submitBtn.removeAttr("disabled").removeClass("ui-button-disabled ui-state-disabled").addClass("ui-button-blue"):e=="disable"&&this.submitBtn.attr("disabled","disabled").removeClass("ui-button-blue").addClass("ui-button-disabled ui-state-disabled")},calcWords:function(e){var t=e.val().length;this.wordsCount.text(t),t<=0?(this.wordCon.attr("class",""),this.toggleBtnState("disable")):t>this.totalWords?(this.isValidate=!1,this.wordCon.attr("class","err-count"),this.toggleBtnState("disable")):(this.isValidate=!0,this.wordCon.attr("class",""),this.toggleBtnState("enable"))},bindCalcWordsEv:function(){var e=this;this.contentArea.bind({keyup:function(){e.calcWords(t(this))},paste:function(){setTimeout(function(){e.calcWords(e.contentArea)},50)}})},isEmpty:function(){return this.fbContent=this.contentArea.val().trim(),this.fbContent===""},submitContent:function(e){if(this.isEmpty()||!this.isValidate)return;var n=this;t.ajax({url:"http://help.renren.com/support/leavemessage/v7",type:"post",data:"body="+encodeURIComponent(n.fbContent),dataType:"json",success:function(r){var i=r.rlt;i=="0"?this.error():(e.close(),t.dialog.success(n.succMsg))},error:function(){t.dialog.error(n.errMsg)}})},init:function(){this.buildLayer(),this.bindCalcWordsEv()}};e.init=function(){n.init()}}),function(e){define("statsLogs",function(require,t){function n(){this.limitCount=10,this.limitTime=15e3,this.logAry=[],this.startTime=(new Date).getTime(),this.interval=null,this.sendLog=function(t){e.post("http://www.renren.com/homeV7Logger/send","log="+t,function(){})},this.writeLog=function(t){e.extend(t,{sendUserId:nx.user.id}),t=JSON.stringify(t),this.logAry.length<=0&&(this.startTime=(new Date).getTime(),this.isTimeout()),this.logAry.push(t),this.isCountout()},this.transformLog=function(){var e="["+this.logAry.join(",")+"]";return e},this.isCountout=function(){this.logAry.length>=this.limitCount&&this.sendAndReset()},this.isTimeout=function(){this.interval=setInterval(function(){(new Date).getTime()-this.startTime>=this.limitTime&&this.sendAndReset()},1e3)},this.sendLogBeforePageUnload=function(){this.sendAndReset(),nx.browser.msie&&setTimeout(function(){},1e3)},this.sendAndReset=function(){this.logAry.length>0&&this.sendLog(this.transformLog()),this.logAry=[],this.interval&&(clearInterval(this.interval),this.interval=null)},this.initialize=function(){var t=this;e(window).bind("unload",function(){t.sendLogBeforePageUnload()}),e(window).bind("beforeunload",function(){t.sendLogBeforePageUnload()})},this.initialize()}t.Logs=n}),define("mainLog",function(require,t){function o(e){var t={hostId:nx.user.id,targetTag:e};s.writeLog(t)}function u(t){for(var n=0;n<t.length;n++)e(t[n].s).bind("click",{index:n},function(e){o(t[e.data.index].t)})}function a(t){for(var n=0;n<t.length;n++)e(t[n].d).delegate(t[n].s,"click",{index:n},function(e){o(t[e.data.index].t)})}var n=[{s:".hd-logo a",t:"logo_click"},{s:"#hd-search",t:"search_click"},{s:".hd-account dt a",t:"name_click"},{s:".hd-account .hd-name",t:"name_click"},{s:"#hdLoginDays",t:"day_click"},{s:".app-nav-list .app-feed a",t:"leftmenu_home_click"},{s:".app-nav-list .app-matter a",t:"leftmenu_matter_click"},{s:".app-nav-list .app-homepage a",t:"leftmenu_profile_click"},{s:".app-nav-list .app-album a",t:"leftmenu_myalbum_click"},{s:".app-nav-list .app-friends a",t:"leftmenu_friend_click"},{s:".app-nav-list .app-school a",t:"leftmenu_xiaoyuan_click"},{s:".app-nav-list .app-share a",t:"leftmenu_hotshare_click"},{s:".app-nav-list .app-myapp a",t:"leftmenu_apps_click"},{s:".app-nav-list .app-manage a",t:"leftmenu_mymanage_click"},{s:".app-nav-list .app-more a",t:"leftmenu_editapps_click"},{s:".app-nav-list .app-more a",t:"leftmenu_editapps_click"},{s:".recent-app-cont li:eq(0) a",t:"leftmenu_recentapp1_click"},{s:".recent-app-cont li:eq(1) a",t:"leftmenu_recentapp2_click"},{s:".recent-app-cont li:eq(2) a",t:"leftmenu_recentapp3_click"},{s:".fd-nav-home ~ a",t:"tab_newsfeed_click"},{s:".content-focus",t:"tab_follow_click"},{s:".group-focus",t:"tab_closefriends_click"},{s:"#toolBackTo a",t:"returnbutton_click"},{s:"#toolRefreshFeed a",t:"newsfeedbutton_click"}],r=[{d:".hd-search",s:"#s-default-items li:eq(0) a",t:"search_newfriends_click"},{d:".hd-search",s:"#s-default-items li:eq(1) a",t:"search_managefriends_click"},{d:".hd-search",s:"#s-default-items li:eq(2) a",t:"search_profile_click"},{d:".hd-search",s:"#s-default-items li:eq(3) a",t:"search_hotshare_click"},{d:"#feed-list",s:".new-feed-tip a",t:"newsfeedbar_click"},{d:".bd-content",s:".textarea-textzone",t:"publicer_cilck"},{d:".bd-content",s:"#appPublisherBtnPhoto",t:"publicer_photo_click"},{d:".bd-content",s:"#appPublisherBtnShare",t:"publicer_share_click"},{d:".bd-content",s:"#appPublisherBtnBlog",t:"publicer_blog_click"},{d:".bd-content",s:"#appPublisherBtnBlog",t:"publicer_movie_click"},{d:".bd-content",s:".ui-renren-publisher-toolbar .ui-button[data-app=photo]",t:"publicer_activated_photo_click"},{d:".bd-content",s:".ui-renren-publisher-toolbar .ui-button[data-app=share]",t:"publicer_activated_share_click"},{d:".bd-content",s:".ui-renren-publisher-toolbar .ui-button[data-app=movie]",t:"publicer_activated_movie_click"}],i=require("statsLogs"),s=new i.Logs;t.init=function(){u(n),a(r)}})}(jQuery),define("friendTopLimit",function(require,e){var t=jQuery.noConflict(),n={renderTpl:function(e){var n="",r="";e==1?(n="您的好友数量即将达到上限TAT~</br>您可以开通关注，让新朋友们关注您，</br>或开通VIP，尊享更高上限哦~",r='<a href="http://vip.renren.com/pay/pre" target="_blank" class="vip-pay">开通VIP</a><a href="http://follow.renren.com/promotion" target="_blank" class="follow-attention">开通关注</a>'):(n="您的好友数量即将到达上限TAT~</br>您可以开通关注，让新朋友们关注您 ~",r='<a href="http://follow.renren.com/promotion" target="_blank" class="follow-attention">开通关注</a>');var i=t("<div></div>").html(['<div class="toplimit-con">','<div class="toplimit-tips">','<p class="toplimit-tips-con">'+n+"</p>","</div>",'<div class="toplimit-btns">'+r+"</div>","</div>"].join(""));return i},buildDialog:function(e){var n=this;require(["ui/dialog"],function(){t.ui.dialog({width:522,buttons:!1,dialogClass:"v7-friend-toplimit",close:function(){t(this).remove()}},n.renderTpl(e))})},init:function(e){this.buildDialog(e)}};e.init=function(){var e=t("#showActivityFlag");if(e[0]){var r=t("#showActivityFlag").val();if(r){var i=t("#showActivityIndex");if(i[0]){var s=i.val();n.init(s)}}}}}),define("headerControls",["jquery"],function(e){var t={showAccountMore:function(){var t=null;e(".hd-account-action .nv-account-ctrl a").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}),e(".hd-account-action-vip .account-more").on("mouseenter",function(){var t=e(this).parent().find(".nv-drop-vipstatus-progressbar span");if(!t.length)return;var n=Math.floor(t.parent().width()*parseFloat(t.data("length"))/100);t.hasClass("vipoverdie")?t.width("100%").delay(100).animate({width:n}):t.width(0).delay(100).animate({width:n})})},showLoginTip:function(){require(["ui/tooltip"],function(){e("#hdLoginDays").tooltip({tooltipClass:"hd-login-tooltip nx-tooltip",position:{my:"center top+20",at:"bottom center"},disabled:!1,items:"[data-tips]:not([disabled])",content:function(){var t=e.parseJSON(e(this).data("tips").replace(/'/g,'"')),n=[];return n.push(t.days?'<p><span class="r">'+t.days+"天</span>连续登录":""),n.push(t.range?'<p><span class="r">'+t.range+"级</span>等级":""),n.push(t.score?'<p><span class="r">'+t.score+"分</span>积分":""),'<div class="t-wrap">'+n.join("")+"</div>"}})})},init:function(){this.showAccountMore(),this.showLoginTip()}};return{init:function(){t.init()}}}),define("responseFrame",["jquery"],function(e){function t(){this.win=e(window),this.rootEle=e("html"),this.bodyEle=e("body"),this.nxContainer=e("#nxContainer"),this.nxHeader=e("#nxHeader"),this.hdFixed=this.nxHeader.find(".hd-fixed-wraper"),this.hdMain=this.nxHeader.find(".hd-main"),this.nxSlidebar=e("#nxSlidebar"),this.subNav=e("#frameFixedNav"),this.fixedLayer=e('<div id="fixedLayer">').prependTo(this.bodyEle),this.fixedWidth=0,this.sidebarWidth=0,this.webpagerWidth=0,this.headerCombined=!1,this.webpagerAutoFolded=!1,nx.store.get("webpager.user")!==nx.user.id.toString()&&(nx.store.set("webpager.user",nx.user.id),nx.store.remove("webpager.html")),this.resizeView(),this.loadWebpager(),e(window).on("resize/50",this.resizeView.bind(this)).on("scroll/1",this.combineNav.bind(this)),e(document).on("webpager:fold",function(){this.resizeViewForWebpager(!0)}.bind(this)).on("webpager:unfold",function(){this.resizeViewForWebpager(!1)}.bind(this)).on("ready newsfeed:single newsfeed:double",this.resizeView.bind(this)),e(window).on("unload",function(){window.scrollTo(0,0)})}return t.prototype={_switchClass:function(e){this.nxContainer.removeClass("nx-normalViewport nx-narrowViewport nx-freeViewport").addClass(e)},_changeClass:function(){var e=this.win.width(),t=this.rootEle.prop("class").match(/nx-main(\d+)/);t?(nx.data.isDoubleFeed&&e>=1260?t=880:t=Number(t[1]),t+=60,e<80+t+240?this._switchClass("nx-freeViewport"):e<160+t+240?this._switchClass("nx-narrowViewport"):this._switchClass("nx-normalViewport")):this._switchClass("nx-freeViewport")},_computeSize:function(){var e=this._isWPOpen(),t=this.nxContainer.hasClass("nx-freeViewport");t||this.nxContainer.addClass("nx-webpager-"+(e?"unfold":"fold")),this.webpagerWidth=!e||t?0:240,this.sidebarWidth=Number(this.nxSlidebar.outerWidth()),this.fixedWidth=this.win.width()-this.webpagerWidth,this.nxSlidebar.height(this.win.height()-this.nxHeader.height()),this.fixedLayer.width(this.fixedWidth-(e&&t?240:0)),this.hdFixed.width(this.fixedWidth),this.subNav.width(this.fixedWidth-this.sidebarWidth)},_isWPOpen:function(){return nx.webpager.disable?!1:typeof nx.webpager.fold=="undefined"?nx.cookie("wp_fold")!=="1":!nx.webpager.fold},resizeViewForWebpager:function(t){if(this.nxContainer.hasClass("nx-freeViewport")){this.nxContainer.removeClass("nx-webpager-fold nx-webpager-unfold"),this.fixedLayer.width(this.fixedWidth-(t?0:240));return}if(this.webpagerAutoFolded)return;var n=this;this.nxContainer.hasClass("nx-narrowViewport")&&(this.sidebarWidth=this.sidebarWidth?this.sidebarWidth+(t?80:-80):0),this.webpagerWidth=t?0:240,this.fixedWidth=this.win.width()-this.webpagerWidth,this.fixedLayer.velocity({width:this.fixedWidth}),this.nxContainer.velocity({"margin-right":this.webpagerWidth},function(){n.nxContainer.removeClass("nx-webpager-fold nx-webpager-unfold").addClass("nx-webpager-"+(t?"fold":"unfold")),e.event.trigger("mainframe:reflow")}),this.hdFixed.velocity({width:this.fixedWidth},function(){var t=e("#nxHeader .pop-vip");t.length&&(t.insertAfter("#nxHeader .hd-account-action-vip").show(),t.data("bind")||(t.find(".pop-vip-close").one("click",function(){t.remove()}),t.data("bind",!0)))}),this.subNav.velocity({width:this.fixedWidth-this.sidebarWidth})},resizeView:function(t){this._changeClass(),this._computeSize(),e.event.trigger("mainframe:reflow")},loadWebpager:function(){if(this.webpagerWidth===240&&e("#webpager-holder").length===0&&e("body > #webpager").length===0){var t=e("<div>").attr({id:"webpager-holder"}).html('<div id="webpager"><div class="nav-holder"></div><div class="subnav-holder"></div></div>').height(this.win.height()).insertBefore(this.nxContainer),n=nx.store.get("webpager.html"),r=nx.store.get("webpager.css");n&&r&&nx.load(r,function(){var r=e(n);t.before(r),e("#webpager").height()<e(window).height()?r.remove():t.empty().append(r)})}},combineNav:function(){var t=e(document).scrollTop(),n=nx.browser.msie&&nx.browser.versionNumber===7,r=this;t>150?this.headerCombined||(this.headerCombined=!0,e("#search-result-box").is(":visible")&&e("#hd-search").blur(),this.subNav.velocity("stop").velocity({top:"0px"},function(){e(this).addClass("fix-app-nav"),n&&(r.nxHeader.css("z-index","-1"),r.hdMain.find(".hd-nav").hide())}),n||this.hdMain.find(".hd-nav").velocity("stop").velocity("fadeOut")):this.headerCombined&&(this.headerCombined=!1,this.subNav.removeClass("fix-app-nav").velocity("stop").velocity({top:"50px"}),n?(this.hdMain.find(".hd-nav").show(),this.nxHeader.css("z-index","auto")):this.hdMain.find(".hd-nav").velocity("stop").velocity("fadeIn"))}},{initFrameSize:function(){this.fm=new t},resizeView:function(e){return this.fm.resizeView(e)},combineNav:function(){return this.fm.combineNav()}}}),define("mainframe",function(require){var e=require("jquery"),t=require("headerControls"),n=require("sideBarControls"),r=require("topSearch"),i=require("sidebar"),s=require("backToTop"),o=require("feedbackLayer"),u=require("friendTopLimit"),a=require("lawInfo"),f=require("liquidFooter"),l=require("navControl"),c=require("switchAccount"),h=require("mainLog"),p=require("vipSkinEntry");n.init(),r.init(),i.init(),t.init(),l.init(),s.init(),c.init(),h.init(),f.init(),u.init(),p.init(),e(".v7-feedback").css("display","block").click(function(e){e.stopPropagation(),o.init()}),e("#lawInfo").click(function(){a.init()})}),require(["jquery","responseFrame"],function(e,t){var n=setInterval(function(){e("#nxHeader").length&&(clearInterval(n),typeof t.fm!="object"&&t.initFrameSize())},1);e(function(){require(["mainframe"],e.noop)}),window._developer_no_webpager=!0}),define("lawInfo",function(require,e){var t=jQuery.noConflict(),n={tpl:['<div class="law-info">',"北京千橡网景科技发展有限公司<br />",'<a href="http://sq.ccm.gov.cn/ccnt/sczr/service/business/emark/toDetail/DFB957BAEB8B417882539C9B9F9547E6" target="_blank">京网文[2013]0136-030号</a> · <a href="http://www.miibeian.gov.cn/" target="_blank">京ICP证090254号</a><br />',"京公网安备110000000009号 · 乙测资字1111532<br />","文化部监督电子邮箱：wlwh@vip.sina.com<br />",'<a href="http://a.xnimg.cn/n/core/res/certificate.jpg" target="_blank">互联网药品信息服务资格证</a> · <a href="http://py.qianlong.com" target="_blank">北京地区网站联合辟谣平台</a><br />',"违法和不良信息举报电话：027-87676735<br />","举报邮箱：jubao@renren.com<br />",'<div><img src="http://s.xnimg.cn/imgpro/civilization/jubaologo.png" height="25" width="25"><a href="http://www.12377.cn/" target="_blank" style="margin-left: 5px;">违法和不良信息举报中心</a></div>','<p class="typ1"><a href="http://www.bjjubao.org/" target="_blank">北京互联网举报中心</a></p>','<p class="typ2"><a href="http://www.bj.cyberpolice.cn/index.jsp" target="_blank">网络110报警服务</a></p>','<p class="typ3"><a href="http://www.bjwhzf.gov.cn/accuse.do" target="_blank">北京文化市场举报热线</a></p>',"</div>"].join(""),showInfo:function(){this.dialog=t.ui.dialog({title:"法律声明",width:430,buttons:[],close:function(){t(this).remove()}},this.tpl)}};e.init=function(){n.showInfo()}}),define("liquidFooter",function(require,e){var t=jQuery.noConflict();e.init=function(){var e=760,n=t(document.documentElement).attr("class").split(" ");for(var r=0,i=n.length;r<i;r++)if(n[r].indexOf("nx-main")!==-1){var s=parseInt(n[r].substring(7));e=isNaN(s)?e:s;break}t(".ft-wrapper").css("width",e+"px")}}),define("navControl",["jquery","exports"],function(e,t){var n={init:function(){this.bannerMoreGroupCon=e("#frameFixedNav .nf-group-list-container"),this.bannerMoreGroupCon.length&&this.events()},events:function(){this.bannerMoreGroupCon.parent().on("mouseenter",this.initScrollBar.bind(this))},initScrollBar:function(){if(this.bannerMoreGroupCon.find(".nf-group-item").length>10){var e=this;require(["ui/scrollbar"],function(){e.bannerMoreGroupCon.scrollbar()})}}};t.init=function(){n.init()}}),define("sideBarControls",["jquery","ui/scrollbar"],function(e){var t,n={appBarScroll:function(){t=e.ui.scrollbar({barClass:"scroll-cont",scrollEle:".app-nav-wrap",stopBubble:!1,wheelSpeed:100},e("#nxSlidebar")[0]),e(window).bind("resize/100",function(){t.update()})},showMyManageApp:function(){e("#my-manage-app").click(function(n){n.preventDefault();var r=e(this).siblings(".app-nav-list");if(r.find("li").length===0)return;if(!r.is(":animated"))if(r.is(":visible")){var i=e(this);r.slideUp("fast",function(){i.removeClass("app-manage-open"),e(".nx-sidebar").trigger("resize"),e("#my-manage-app").attr("data-tip","我管理的"),e("#my-manage-app .app-title").text("我管理的"),t.update()})}else{var i=e(this);r.slideDown("fast",function(){i.addClass("app-manage-open"),e(".nx-sidebar").trigger("resize"),e("#my-manage-app").attr("data-tip","收起"),e("#my-manage-app .app-title").text("收起"),t.update()})}})},appNavTips:function(){require(["ui/tooltip"],function(){e(".app-nav-list").tooltip({tooltipClass:"app-nav-tooltip nx-tooltip",position:{my:"left-18 center",at:"right center"},items:".app-nav-item",content:function(){var t=e(this).data("tip")||"";return'<div class="ui-tooltip-arr"></div>'+e("<a>").text(t).html()},beforeOpen:function(){return e(".nx-sidebar .app-title").is(":visible")?!0:!1},hide:!1,openDelay:0})})},init:function(){this.appBarScroll(),this.showMyManageApp(),this.appNavTips()}};return n}),define("sidebar",["jquery"],function(e){var t=function(){function i(){return;var n}var t=this,n=e(window),r=e(".nx-right");if(!r.length)return;t.msie=nx.browser.name==="msie"&&nx.browser.versionNumber<9?!0:!1,t.fixedEvent||(t.fixedEvent=!0,e(document).on("webpager:fold",function(){r.data("windowscroll")&&!e("#nxContainer").hasClass("nx-freeViewport")&&r.velocity({right:"-=120"})}),e(document).on("webpager:unfold",function(){r.data("windowscroll")&&!e("#nxContainer").hasClass("nx-freeViewport")&&r.velocity({right:"+=120"})}),e(document).on("mainframe:reflow",function(){r.data("windowscroll")&&(nx.data.isDoubleFeed&&e(window).width()>=1260?(r.data("windowscroll",null),r.css({position:"relative",top:0,bottom:0,right:0}),r.prev(".nx-right-placeholder").remove()):r.css("right",(e(".bd-main").width()-e(".bd-content").width())/2+parseInt(e("#nxContainer").css("margin-right"),10)))}),n.on("feedchange",function(e,t){t==="empty"&&r.data("windowscroll")?(r.data("windowscroll",null),r.css({position:"relative",top:0,bottom:0,right:0}),r.prev(".nx-right-placeholder").remove()):n.trigger("scroll")}),n.on("scroll/1",function(){if(r.parents(".double-cols-feed").length)return;var t=n.scrollTop();if(r.data("windowscroll"))if(n.scrollTop()<r.data("windowscroll"))r.data("windowscroll",null),r.css({position:"relative",top:0,bottom:0,right:0}),r.prev(".nx-right-placeholder").remove();else{var i=e(".ft-wrapper").outerHeight(!0);n.viewport().check(i).bottom?r.css("bottom")==="0px"&&r.css({top:"auto",bottom:i}):r.css("bottom")===i+"px"&&(r.height()+50>n.height()?r.css({top:"auto",bottom:0}):r.css({top:50,bottom:"auto"}))}else r.height()<e(".bd-content").height()&&t>115&&r.get(0).getBoundingClientRect().bottom-n.height()<1&&(r.height()+50>n.height()?(r.data("windowscroll",r.offset().top+r.height()-n.height()),r.css({top:"auto",bottom:0})):(r.data("windowscroll",115),r.css({top:50,bottom:"auto"})),r.css({position:"fixed",right:n.width()-r.get(0).getBoundingClientRect().right}),r.prev(".nx-right-placeholder").remove().end().before('<div class="nx-right-placeholder">'))}),n.trigger("scroll"),e(nx.data.feed).on("sortByTime",i),e(nx.data.feed).on("sortBySmart",i),e(nx.data.feed).on("contentFocus",i),e(nx.data.feed).on("groupFocus",i),e(nx.data.feed).on("friendsNewsFeed",i),e(nx.data.feed).on("friendsOriginal",i),e(nx.data.feed).on("newsfeedFilter",i),t.msie&&(e(nx.data.feed).on("feedLoading",function(){e(".ft-wrapper").css("position","")}),e(nx.data.feed).on("feedRendered",function(){e(".ft-wrapper").css("position","relative")})))};return{init:function(){new t}}}),define("switchAccount",function(require,e){require("ui/scrollbar");var t=jQuery.noConflict(),n=require("mustache.js"),r={Templ:{accountItem:['<li class="nv-drop-account">','	<a href="javascript:;">','		<span class="ui-icon ui-icon-toogleuser"></span>{{accountType}}',"	</a>","</li>",'<li class="nv-account-sline"></li>'].join(""),actChangeDialog:['<div class="act-change-main">',"	<p>你可以通过切换身份，以公共主页的身份加好友，回踩粉丝与其他主页互动</p>",'	<div class="act-change-list-con">',"		<ul>","			{{#otherAccounts}}",'				<li class="clearfix">','					<div class="user-info">','						<a class="avatar" namecard="{{transId}}" href="http://www.renren.com/profile.do?id={{transId}}">','							<img src="{{head}}">',"						</a>",'						<a class="u-name" namecard="{{transId}}" href="http://www.renren.com/profile.do?id={{transId}}">{{name}}</a>',"					</div>",'					<a class="change-btn" href="javascript:;">切换</a>',"				</li>","			{{/otherAccounts}}","		</ul>","	</div>","</div>"].join(""),pwdConfirmDialog:['<div class="pwd-confirm-main">','	<div class="user-info">','		<img src="{{head}}">',"		<span>{{name}}</span>","	</div>",'	<div class="pwd-confirm">',"		<p>请输入人人帐号“{{name}}”对应密码</p>","		<p><label>帐号：</label><span>{{account}}</span></p>",'		<p><label>密码：</label><input id="switch-account-pwd" type="password"></p>','		<p class="switch-confirm-icode{{hiddenClass}}"><label>验证码：</label><input type="text"></p>','		<p class="switch-confirm-icode-img{{hiddenClass}}"><label></label><img src="http://icode.renren.com/getcode.do?rk=300&t=LOGIN&rnd={{random}}"><a href="javascript:;">换一个</a></p>',"	</div>","</div>"].join("")}},i={getOtherAccounts:function(e,n){t.ajax({url:"http://www.renren.com/getOtherAccounts",type:"get",dataType:"json",success:function(t){e.call(n,t)}})},switchToPage:function(e,n,r){t.ajax({url:"http://page.renren.com/api/pageState",type:"post",dataType:"text",data:"pids="+e,success:function(e){n.call(r,t.parseJSON(e))}})},switchAccount:function(e,n,r){t.ajax({url:"http://www.renren.com/switchAccount",type:"post",data:"origUrl="+encodeURIComponent(document.location.href)+"&destId="+e,dataType:"json",success:function(e){n.call(r,e)}})},checkPwd:function(e,n,r,i){t.ajax({url:"http://www.renren.com/verifypwd/checkPwd",type:"post",data:"ick="+n+"&pwd="+t("#switch-account-pwd").val()+"&origUrl="+encodeURIComponent(document.location.href)+"&destId="+e.id+"&showIC="+(r.hasClass("hidden")?!1:!0),dataType:"json",success:function(e){if(e.status==="ok")document.location.href=e.msg;else if(e.status==="fail"){r.removeClass("hidden"),i.removeClass("hidden");var n="http://icode.renren.com/getcode.do?rk=300&t=LOGIN&rnd="+Math.random();i.find("img").attr("src",n),t.dialog.error(e.msg)}}})}},s={init:function(){this.accountAction=t("#nxHeader .hd-account-action:not(.hd-account-action-vip)"),this.dropList=t(".nx-account-drop",this.accountAction),this.nvControl=t(".nv-account-ctrl",this.accountAction),this.accountsData=null,this.switchData=null,this.events()},events:function(){var e=this;this.accountAction.on("mouseenter",".account-more",e.getAccountInfo),this.nvControl.on("click",".nv-drop-account a",function(){e.accountsData.otherAccounts.length>1?e.createDialog(e.accountsData):(e.switchData=e.accountsData.otherAccounts[0],e.switchPageAccount())})},getAccountInfo:function(){var e=this;s.accountAction.off("mouseenter",".account-more",e.getAccountInfo),i.getOtherAccounts(function(e){s.accountsData=e;var i={};if(e.otherAccounts===undefined)return;e.otherAccounts.length>1?i.accountType="切换身份":e.otherAccounts.length===1&&(e.otherAccounts[0].isPage==="true"||e.otherAccounts[0].self_isPage==="true"?i.accountType="切换至公共主页":e.otherAccounts[0].self_domain?e.otherAccounts[0].self_domain==="kaixin.com"?i.accountType="切换身份":e.otherAccounts[0].self_domain==="renren.com"&&(i.accountType="切换至人人帐号"):e.otherAccounts[0].domain&&(e.otherAccounts[0].domain==="kaixin.com"?i.accountType="切换身份":e.otherAccounts[0].domain==="renren.com"&&(i.accountType="切换至人人帐号")));var o=t(n.render(r.Templ.accountItem,i));t(o).prependTo(s.nvControl)})},switchPageAccount:function(){var e=this;this.switchData.isPage==="true"?i.switchToPage(this.switchData.transId,function(n){if(n.code!==0){t.dialog.error("网络错误，请稍后再试");return}n.data[e.switchData.transId]?e.switchUserAccount():t.dialog.error("不能切换身份到"+e.switchData.name+'，请先<a href="http://page.renren.com/'+e.switchData.transId+'/admin/identify">认证</a> 或 <a href="http://page.renren.com/'+e.switchData.transId+'/admin/rename">更名</a>')}):this.switchUserAccount()},switchUserAccount:function(){var e=this;i.switchAccount(this.switchData.id,function(t){t.isJump?window.location=t.url:e.createPwdDialog(t)})},createDialog:function(e){var i=t(n.render(r.Templ.actChangeDialog,e));this._dialog=t.ui.dialog({title:"切换身份",dialogClass:"act-change-dialog",show:!1,width:500,buttons:[{text:"取消",click:function(){var e=t(this).dialog("instance");e.close()}}],cancel:function(){t(this).remove()},close:function(){t(this).remove()},open:function(){e.otherAccounts.length>3&&t(this).find(".act-change-list-con").scrollbar({minScrollbarLength:1,wheelSpeed:20,stopBubble:!1})}},i),this.dialog=t(".act-change-dialog"),this.dialogEvents()},dialogEvents:function(){var e=this;this.dialog.on("click",".change-btn",function(){var n=t(this).parents("li").index();e.switchData=e.accountsData.otherAccounts[n],e.switchPageAccount()})},createPwdDialog:function(e){var s=this;this.switchData.account=e.account,this.random=Math.random(),e.showIC===!1?this.switchData.hiddenClass=" hidden":this.switchData.hiddenClass="";var o=t(n.render(r.Templ.pwdConfirmDialog,this.switchData));this._pwdDialog=t.ui.dialog({title:"切换身份",dialogClass:"pwd-confirm-dialog",show:!1,width:500,buttons:[{text:"取消",click:function(){var e=t(this).dialog("instance");e.close()}},{text:"确定","class":"ui-button-blue",click:function(){var e=t(this).dialog("instance");e._trigger("confirm")}}],cancel:function(){t(this).remove()},close:function(){t(this).remove()},confirm:function(){i.checkPwd(s.switchData,t(this).find(".switch-confirm-icode input").val(),t(this).find(".switch-confirm-icode"),t(this).find(".switch-confirm-icode-img"))}},o),this.pwdDialog=t(".pwd-confirm-dialog"),this.pwdDialogEvents()},pwdDialogEvents:function(){var e=this;this.pwdDialog.on("click",".switch-confirm-icode-img a",function(){e.changeIC()})},changeIC:function(){var e="http://icode.renren.com/getcode.do?rk=300&t=LOGIN&rnd="+Math.random();this.pwdDialog.find(".switch-confirm-icode-img img").attr("src",e)}};e.init=function(){s.init()}}),define("topSearch",function(require,e){require("ui/placeholder");var t=jQuery,n=t("#hd-search"),r="http://sg.renren.com/s/suggest/v7",i="http://browse.renren.com/s/all?from=opensearch&q=",s=[],o="搜索好友，公共主页，状态",u,a="placeholder"in document.createElement("input");s=['<div id="search-result-box" class="search-result">','		<em class="search-arr-down"><span class="search-arr-outer"></span></em>','		<div class="s-main" id="s-main-cont">','	<div id="s-result-cont">','		<ul class="s-default s-list" ><li id="s-tipword"></li></ul>','		<div class="s-line"></div>','		<div id="s-result-wrap"></div>',"	</div>",'	<ul id="s-default-items" class="s-default s-list">','		<li class="s-def-item s-def-know">','			<a class="s-item" target="_self" href="http://friend.renren.com/newfriends">','				<div class="s-icon"></div>','				<div class="s-info">可能认识的人</div>',"			</a>","		</li>",'		<li class="s-def-item s-def-friend">','			<a class="s-item" target="_self" href="http://friend.renren.com/managefriends">','				<div class="s-icon"></div>','				<div class="s-info">我的好友</div>',"			</a>","		</li>",'		<li class="s-def-item">','			<a class="s-item" target="_self" href="http://www.renren.com/'+nx.user.id+'/profile">','				<div class="s-icon"><img src="'+nx.user.tinyPic+'" alt="" /></div>','				<div class="s-info">个人主页</div>',"			</a>","		</li>",'		<li class="s-def-item s-def-share">','			<a class="s-item" target="_self" href="http://share.renren.com/share/hot/v7">','				<div class="s-icon"></div>','				<div class="s-info">热门</div>',"			</a>","		</li>","	</ul>","</div>","</div>"].join("");var f={makeHtml:function(e,n){var r=[],s=[],o=n.data,u=0,a=nx.stringplus.TSubStringOut(e,10,"..");t("#s-search-list").html(""),t("#s-result-cont").hide(),t("#s-default-items").hide(),t("#s-result-wrap").html("");if(n.code>-1){u=o.user.length+o.zhan.length+o.page.length;if(u===0){t("#s-default-items").show(),t("#s-tipword").html('<a class="s-item s-tip"  target="_blank" href="'+i+e+'">在人人网搜索与“'+a+"”相关的内容</a>"),t("#s-result-cont li").first().addClass("s-item-selected"),t("#s-result-cont").show();return}r.push('<ul class="s-default s-list" id="s-search-list">'),s.push('<ul class="s-default s-list" id="s-more-list">'),o.user.length>0&&(o.user.forEach(function(e,t){r.push('<li class="s-def-know">','	<a class="s-item" target="_blank" href="http://www.renren.com/'+e.id+'/profile?ref=opensearch_normal">','		<div class="s-icon"><img src="'+e.pic+'" alt="" /></div>','		<div class="s-info">','			<p class="s-name">'+e.name+'</p><p class="s-dis">'),e.from&&r.push(e.from),e.friend>0&&r.push(" - "+e.friend+"共同好友"),e.friend>0&&e.follow>0&&r.push(" | "),e.follow&&r.push(" - "+e.follow+"人关注"),r.push("				</p></div></a></li>")}),s.push('<li class="s-def-item s-def-know">','	<a class="s-item" target="_blank" href="'+i+a+"#qt="+a+'/tindex=2">','		<div class="s-icon"></div>','		<div class="s-info">搜索叫“'+a+"”的人</div>","	</a>","</li>")),o.page.length>0&&(o.page.forEach(function(e,t){r.push('<li class="s-def-know">','	<a class="s-item" target="_blank" href="'+e.url+'">','		<div class="s-icon"><img src="'+e.pic+'" alt="" /></div>','		<div class="s-info">','			<p class="s-name">'+e.name+'</p><p class="s-dis">公共主页'),e.follow&&r.push(" - "+e.follow+"人关注"),r.push("</p></div></a></li>")}),s.push('<li class="s-def-item s-def-page">','	<a class="s-item" target="_blank" href="'+i+a+"#qt="+a+'/tindex=4">','		<div class="s-icon"></div>','		<div class="s-info">搜索叫“'+a+"”的公共主页</div>","	</a>","</li>")),o.zhan.length>0&&(o.zhan.forEach(function(e,t){r.push('<li class="s-def-know">','	<a class="s-item" target="_blank" href="'+e.url+'">','		<div class="s-icon"><img src="'+e.pic+'" alt="" /></div>','		<div class="s-info">','			<p class="s-name">'+e.name+'</p><p class="s-dis">小站'),e.follow&&r.push(" - "+e.follow+"人关注"),r.push("</p></div></a></li>")}),s.push('<li class="s-def-item s-def-site">','	<a class="s-item" target="_blank" href="'+i+a+"#qt="+a+'/tindex=5">','		<div class="s-icon"></div>','		<div class="s-info">搜索叫“'+a+"”的小站</div>","	</a>","</li>")),r.push("</ul>"),u>0&&r.push('<div class="s-line"></div>'),s.push('</ul><div class="s-line"></div>'),t("#s-tipword").html('<a class="s-item s-tip"  target="_blank" href="'+i+a+'">在人人网搜索与“'+a+"”相关的内容</a>"),t("#s-result-wrap").html(r.join("")+s.join("")),t("#s-result-cont li").first().addClass("s-item-selected"),t("#s-result-cont").show()}else if(
u===0){t("#s-default-items").show();return}},moveItem:function(e){var n=t("#s-main-cont li:visible"),r=n.index(t("#s-main-cont .s-item-selected")),i=n.length;n.removeClass("s-item-selected"),e==="down"?r=r===i-1?0:r+1:r=r===0?i-1:r-1,n.eq(r).addClass("s-item-selected")},hideSearch:function(){u.hide(),t("#s-search-list").html(""),t("#s-main-cont li").removeClass("s-item-selected"),t("#s-result-cont").hide();var e=t.trim(n.val());a||(e!==o||e.length===0)&&n.val(o).addClass("hd-search-placeholder")},startSearch:function(){var e=this,i=t.trim(n.val());!a&&i===o&&n.val("").removeClass("hd-search-placeholder"),i.length>0&&i!==o?t.getJSON(r+"?q="+encodeURI(i)+"&ownerId="+nx.user.id,function(r){var s=t.trim(n.val());s===i?f.makeHtml(i,r):e.startSearch()}):(t("#s-search-list").html(""),t("#s-result-cont").hide(),t("#s-default-items").show())},init:function(){a||n.val(n.attr("placeholder")).addClass("hd-search-placeholder"),n.bind("focus",function(){u=t("#search-result-box"),u.length?u.show():(t(".hd-search").append(t(s)),u=t("#search-result-box"),u.width(n.parent(".hd-search").width())),t("#s-default-items").show(),u.position({of:t(".hd-search"),my:"left top",at:"left bottom+10"}),u.delegate("li","mouseover",function(){t("#s-main-cont li").removeClass("s-item-selected"),t(this).addClass("s-item-selected")}),t("body").bind("click",function(e){e.target!==n[0]&&u.length>0&&f.hideSearch()}),f.startSearch()}).bind("blur",function(){setTimeout(function(){f.hideSearch()},200)}),t(".hd-search-btn").bind("click",function(){top.location.href=i+t.trim(n.val())});var e="";n.bind("keydown",function(t){if(t.keyCode===13||t.keyCode===40||t.keyCode===38){e=n.val(),t.preventDefault();return}}),n.bind("keyup",function(r){switch(r.keyCode){case 13:r.preventDefault();if(e===n.val()){var s;t("#s-main-cont .s-item-selected").length>0?s=t("#s-main-cont .s-item-selected").find("a").attr("href"):s=i+t.trim(n.val()),top.location.href=s}break;case 40:f.moveItem("down"),r.preventDefault();break;case 38:f.moveItem("up"),r.preventDefault();break;default:f.startSearch()}})}};e.init=f.init}),require(["jquery"],function(e){nx.browser.msie&&nx.browser.versionNumber===6&&window.location.href!=="http://www.renren.com/notSupportIE6/useIE6"&&(window.location.href="http://www.renren.com/notSupportIE6/useIE6"),e.expr.cacheLength=10,e(window).one("load",function(){var e=nx.user.pageid||location.href.match(/http:\/\/([^.]+)/)[1];if(window.performance&&performance.timing){var t=performance.timing.domInteractive-performance.timing.responseStart,n=performance.timing.domComplete-performance.timing.responseStart;t<12e4&&nx.stats.ps.add("ready-"+e,t),n<3e5&&nx.stats.ps.add("load-"+e,n),t>2e9&&nx.stats.gs.send("exception-"+nx.user.id,1),performance.memory&&(nx.stats.ps.add("mlj-"+e,Math.floor(performance.memory.usedJSHeapSize/1e3)),nx.stats.ps.add("mlt-"+e,Math.floor(performance.memory.totalJSHeapSize/1e3)))}else if(nx.log&&nx.log.startTime){var r=new Date-nx.log.startTime;r>0&&r<3e5&&nx.stats.ps.add("load-"+e,r)}}),e(document).one("ready",function(){if(!nx.log)return;var t=nx.user.pageid||location.href.match(/http:\/\/([^.]+)/)[1],n=new Date-nx.log.startTime;n>0&&n<6e4&&!window.performance&&nx.stats.ps.add("ready-"+t,n);var r={get:function(e){return window.localStorage?r.get=function(e){return localStorage.getItem("stats."+e)}:r.get=function(e){return nx.cookie("stats_"+e)},r.get(e)},set:function(e,t){return window.localStorage?r.set=function(e,t){return localStorage.setItem("stats."+e,t)}:r.set=function(e,t){return nx.cookie("stats_"+e,t,{expires:7})},r.set(e,t)}},i=function(){var e=JSON.parse(r.get("online")||"{}"),n=e[t]||{},i=n.activeTime||+(new Date),s=n.onlineTime||0,o=+(new Date);o-i>12e4?(s>0&&s<6e5&&nx.stats.gs.add("active-"+t,s),s=0):(s+=o-i,s>6e4&&s<7e4&&window.performance&&performance.memory&&(nx.stats.ps.add("maj-"+t,Math.floor(performance.memory.usedJSHeapSize/1e3)),nx.stats.ps.add("mat-"+t,Math.floor(performance.memory.totalJSHeapSize/1e3)))),e[t]={activeTime:o,onlineTime:s},r.set("online",JSON.stringify(e))};i(),e(document).on("click",i),e(window).on("scroll/1000",i),nx.stats.pv(t),nx.stats.gs.add("browser-"+nx.browser.name,nx.browser.versionNumber)}),e(document).one("ready",function(){var t=window.navigator.userAgent.toLowerCase();t.indexOf("windows nt 5")>-1&&e("body").css({fontFamily:"宋体,Tahoma,arial"}),e(document).one("mouseenter/500","[namecard]",function(){define(["nx/namecard"],function(){e(document).namecard()})}),/^#(?:photo|blog)\//.test(location.hash)?require(["viewer"],e.noop):e(document).one("click","[data-viewer]",function(e){var t=this.getAttribute("data-viewer");require(["viewer"],function(e){e.init(t)}),e.preventDefault()}),e(document).on("click","[data-common]",function(){var t=this.getAttribute("data-common");define(["ui/showCommonFriend"],function(){e.ui.commonFriend({elm:t})})}),(!nx.webpager||!nx.webpager.disable)&&e("#webpagerengine").length===0&&e("<iframe>",{id:"webpagerengine",name:"webpagerengine",src:"http://webpager.renren.com/api/ime.jsp",frameBorder:0,width:0,height:0}).appendTo("body")})});