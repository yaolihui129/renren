/* from dist/ui/renren/huati.js *//*
 * renren.huati
 * ming.zhou
 * Depends:
 * base.js[, ui/renren/addfriend]
 */define("ui/renren/huati",function(require,e){require("ui/tooltip");var t=require("jquery"),n=require("mustache.js"),r={wrapHtml:['<div id="huatiBoxIn">','<div class="side-item-header clearfix">',"<h4>热门话题</h4>",'<div class="option">','<a href="#nogo" class="pager-btn pager-back back-disable" title="上一页" ></a>','<a href="#nogo" class="pager-btn pager-forward forward-disable" title="下一页" ></a>','<a href="http://huati.renren.com" target="_blank" title="更多话题" class="more"></a>',"</div>","</div>",'<div class="side-item-body huati-side-area clearfix"  id="huatiListBox">','<ul class="huati-side-list clearfix" id="huatiList">',"</ul>","</div>","</div>"].join(""),templHtml:["{{#list}}",'<li class="clearfix">','<a href="http://huati.renren.com/{{showUrl}}" target="_blank" class="huati-side-title">','	<span class="huati-title" title="{{title}}" style="display:none;">{{title}}</span>','	<span class="huati-desc">{{description}}</span>',"</a>",'<div class="huati-side-main">','<a class="huati-side-img" target="_blank" href="http://huati.renren.com/{{showUrl}}">','	<img class="footprint-thumb" src="{{summaryThumbUrl}}" />',"</a>",'<div class="huati-side-descript">{{description}}</div>',"</div>","</li>","{{/list}}"].join(""),templDoubleHtml:["{{#list}}","<li>",'<a class="huati-side-img" target="_blank" href="http://huati.renren.com/{{showUrl}}">','<img class="footprint-thumb" src="{{summaryThumbUrl}}" />',"</a>",'<div class="huati-side-main">','<a href="http://huati.renren.com/{{showUrl}}" target="_blank" class="huati-side-title" title="{{title}}">{{title}}</a>','<div class="huati-side-descript">{{description}}</div>','<a class="huati-detail-btn" target="_blank" href="http://huati.renren.com/{{showUrl}}"><span class="link-icon">话题详情</span></a>',"</div>","</li>","{{/list}}"].join("")};t.widget("renren.huati",{options:{column:"single",loadUrl:"http://huati.renren.com/browse/carouseltopic",amount:1,speed:200,area:"#huatiBoxIn",ul:"#huatiList",box:"#huatiListBox",btn1:".pager-back",btn2:".pager-forward",btn1dclass:"back-disable",btn2dclass:"forward-disable",more:".more",listWidth:224},_create:function(){this._initData(),this._fetch()},_init:function(){},_destroy:function(){},_events:function(){var e=this;t(this.options.area).delegate(this.options.btn1,"click",function(){return e._back(),!1}),t(this.options.area).delegate(this.options.btn2,"click",function(){return e._forward(),!1});var n=t(this.options.box).parent(),r;n.hover(function(){r&&(nx.timer.clearTimeout(r),r=null),n.find(".pager-btn").show(),n.closest(".double-cols-feed").length||(e.hover=!0,r=nx.timer.setTimeout(function(){n.find(".huati-side-title").find("span").hide(),n.find(".huati-side-title").find(".huati-title").show(),n.find(".huati-side-main").show().animate({height:"54px"},300)},300))},function(){r&&(nx.timer.clearTimeout(r),r=null),n.find(".pager-btn").hide(),n.closest(".double-cols-feed").length||(e.hover=!1,r=nx.timer.setTimeout(function(){n.find(".huati-side-title").find("span").hide(),n.find(".huati-side-title").find(".huati-desc").show(),n.find(".huati-side-main").animate({height:0}).hide()},300))}),t(this.options.box).parent().tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(n.vertical).addClass(n.horizontal).appendTo(this)}}})},_initData:function(){this.data={},this.req=null,this.cindex=0,this.direction="forward",this._disableForward=!0,this._disableBack=!0,this.slideTimer=null,this.type=null},_setContent:function(e){var n=this._getSomeDom(this.data,this.cindex,this.cindex+this.options.amount),r=t(n);this.direction==="forward"&&t(this.options.ul).append(r),this.direction==="back"&&t(this.options.ul).prepend(r),this.hover&&(t(this.options.ul).find(".huati-side-title").find("span").hide(),t(this.options.ul).find(".huati-side-title").find(".huati-title").show(),t(this.options.ul).find(".huati-side-main").height(54).show());if(e)return;this._slide()},_getSomeDom:function(e,t,n){var r=e.slice(t,n),i=this._createCardHtml(r);return i},_slide:function(){this._disableActions=!0;var e,n=t(this.options.ul),r=this;this.direction==="forward"&&(e=t(r.options.ul).find("li").eq(0),n.animate({left:-r.options.listWidth},this.options.speed,function(){e.remove(),n.css({left:"0"}),r._disableActions=!1;return})),this.direction==="back"&&(n.css({left:-r.options.listWidth}),e=t(r.options.ul).find("li").eq(1),n.animate({left:0},this.options.speed,function(){e.remove(),n.css({left:"0"}),r._disableActions=!1;return}))},_fetch:function(){var e=this.options.loadUrl,n=this;this.req=t.ajax({url:e+"?t="+Math.random(),type:"GET",dataType:"json",success:function(e){if(!e.length)return;var i=/([^\/]+)$/,s="p/m2w55h55q85lt_$1";e.forEach(function(e){e.summaryThumbUrl=e.summaryThumbUrl.replace(i,s)}),n.data=e,t(r.wrapHtml).appendTo(t("#huatiBox").show()),n._setContent(!0),t(n.options.ul).parent().show(),n.data.length>n.options.amount&&n._enableForward(),n._events()},error:function(){t("#huatiBox").length&&t("#huatiBox").hide()}})},_createCardHtml:function(e){this.options.column=="single"&&e.forEach(function(e){nx.stringplus.TLength(e.description)>34&&(e.description=nx.stringplus.TSubString(e.description,34,"..."))}),e={list:e};if(this.options.column=="single")return n.render(r.templHtml,e);if(this.options.column=="double")return n.render(r.templDoubleHtml,e)},_enableForward:function(){if(!this._disableForward)return;t(this.options.area).find(this.options.btn2).removeClass(this.options.btn2dclass),this._disableForward=!1},_enableBack:function(){if(!this._disableBack)return;t(this.options.area).find(this.options.btn1).removeClass(this.options.btn1dclass),this._disableBack=!1},_disableForwardAction:function(){t(this.options.area).find(this.options.btn2).addClass(this.options.btn2dclass),this.direction="back",this._disableForward=!0},_disableBackAction:function(){t(this.options.area).find(this.options.btn1).addClass(this.options.btn1dclass),this.direction="forward",this._disableBack=!0},_canForward:function(){return this.cindex<this.data.length-this.options.amount},_canBack:function(){return this.cindex>0||this.data.length>0?!0:!1},_forward:function(e){if(this._disableActions)return;if(this._disableForward)return;this.direction="forward",this._checkBeforeForward(),this._setContent(e),this._checkAfterForward(),this._canBack()&&this._enableBack()},_checkBeforeForward:function(){this.cindex+=this.options.amount},_checkAfterForward:function(){this._canForward()||this._disableForwardAction()},_back:function(){if(this._disableActions)return;if(this._disableBack)return;this.direction="back",this._checkBeforeBack(),this._setContent(),this._checkAfterBack()},_checkBeforeBack:function(){this.cindex-=this.options.amount,this._canForward()&&this._enableForward(),this.data.length>0&&this._enableForward()},_checkAfterBack:function(){this.cindex<=0&&this._disableBackAction()},_getItem:function(e){return t("#commonFriend_"+e)}})}),define("ui/renren/footprint",function(require,e){require("ui/tooltip");var t=require("jquery"),n=require("mustache.js"),r={templHtml:["{{#list}}","<li>",'<span class="headpichold">','<a href="http://www.renren.com/profile.do?id={{guestId}}" namecard="{{guestId}}" target="_blank">','<img class="footprint-thumb" src data-src="{{headUrl}}" title="{{name}} {{date}}"/>',"</a>","</span>","</li>","{{/list}}"].join("")};t.widget("renren.footprint",{options:{loadUrl:"http://www.renren.com/footpointView",getNumUrl:"http://www.renren.com/footpointView/footprintCount",amount:6,speed:200,area:"#footprintBox",ul:"#footprintList",box:"#footprintListBox",btn1:".pager-back",btn2:".pager-forward",btn1dclass:"back-disable",btn2dclass:"forward-disable",more:".more",listWidth:214,freshTime:6e5},_create:function(){this._dealImg(),this._initData(),this._events(),this._countFresh()},_init:function(){},_destroy:function(){},_events:function(){var e=this;t(this.options.area).delegate(this.options.btn1,"click",function(){return e._back(),!1}),t(this.options.area).delegate(this.options.btn2,"click",function(){return e.req?e._forward():e._fetch(),!1}),t(this.options.box).parent().hover(function(){t(this).find(".pager-back").css({display:"inline-block"}),t(this).find(".pager-forward").css({display:"inline-block"})},function(){t(this).find(".pager-back").css({display:"none"}),t(this).find(".pager-forward").css({display:"none"})}),t(this.options.box).parent().tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(n.vertical).addClass(n.horizontal).appendTo(this)}}}),t("#footprintTab").mouseover(function(){if(t("#footprintBox .no-footprint").length!=0)return;if(t(this).hasClass("active")){var n=parseInt(t("#footprintBox .side-item-header h4 span").text());e._getFootprintNum(function(r){r>n&&(t("#footprintBox .side-item-header h4 span").text(r),t("#footprintNum").text(""),e._enableForward(),e._disableBackAction(),e._initData(),e._fetch(!0))})}})},_countFresh:function(){if(t("#footprintBox .no-footprint").length!=0)return;var e=this;setTimeout(function(){e._showFootprintNum(),e._countFresh()},e.options.freshTime)},_dealImg:function(e){var n=e||0,r=t("#footprintList").find(".footprint-thumb"),i=r.length;for(n;n<i;n++){var s=t(r[n]),o=s.attr("data-src"),u=o.lastIndexOf("/");o=o.substr(0,u)+"/p/m3w100h100q85lt_"+o.substr(u+1),s.attr("src",o)}},_initData:function(){this.data={},this.req=null,this.cindex=0,this.direction="forward",this._disableForward=!0,this._disableBack=!0,this.slideTimer=null,this.footprintNum=parseInt(t("#footprintBox .side-item-header span").text());var e=t(this.options.area).find("input").val();e>this.options.amount?this._disableForward=!1:(this._disableForward=!0,this._disableForwardAction())},_setContent:function(e){var n=this._getSomeDom(this.data,this.cindex,this.cindex+this.options.amount),r=t('<div class="group"></div>').append(n),i=0;this.direction==="forward"&&(t(this.options.ul).append(r),i=6),this.direction==="back"&&(t(this.options.ul).prepend(r),i=0);if(e)return;this._dealImg(i),this._slide()},_getSomeDom:function(e,t,n){var r=e.slice(t,n),i=this._createCardHtml(r);return i},_slide:function(){this._disableActions=!0;var e,n=t(this.options.ul),r=this;this.direction==="forward"&&(e=t(r.options.ul).find(".group").eq(0),n.animate({left:-r.options.listWidth},this.options.speed,function(){e.remove(),n.css({left:"0"}),r._disableActions=!1;return})),this.direction==="back"&&(n.css({left:-r.options.listWidth}),e=t(r.options.ul).find(".group").eq(1),n.animate({left:0},this.options.speed,function(){e.remove(),n.css({left:"0"}),r._disableActions=!1;return}))},_getFootprintNum:function(e){var n=this,r=this.options.getNumUrl;t.ajax({url:r,type:"get",dataType:"json",success:function(t){e(t.count)}})},_showFootprintNum:function(){var e=this;this._getFootprintNum(function(e){var n=e-parseInt(t("#footprintBox .side-item-header h4 span").text());t("#footprintNum").show();if(n==0){t("#footprintNum").hide();return}n>20?t("#footprintNum").text("20+"):t("#footprintNum").text(n)})},_getFirstPage:function(){var e=this.options.loadUrl,n=this;n.req=t.ajax({url:e,type:"post",dataType:"json",success:function(e){var r="",i;if(n.data.length>=6)for(i=0;i<6;i++)r+='<li><span class="headpichold"><a title="'+n.data[i].name+" "+n.data[i].date+'" target="_blank" namecard="'+n.data[i].guestId+'" href="http://www.renren.com/profile.do?id='+n.data[i].guestId+'"><img width="32" height="32" src="'+n.data[i].headUrl+'"></a></span></li>';else for(i=0;i<n.data.length;i++)r+='<li><span class="headpichold"><a title="'+n.data[i].name+" "+n.data[i].date+'" target="_blank" namecard="'+n.data[i].guestId+'" href="http://www.renren.com/profile.do?id='+n.data[i].guestId+'"><img width="32" height="32" src="'+n.data[i].headUrl+'"></a></span></li>';t(n.options.ul).find(".group").html(r),n.data.length>n.options.amount&&n._enableForward()}})},_fetch:function(e){var n=this.options.loadUrl,r=this;r.req=t.ajax({url:n,type:"post",dataType:"json",success:function(n){r.data=n.visitList;if(r.data.length<1)return;if(e){var i="",s;if(r.data.length>=6)for(s=0;s<6;s++)i+='<li><span class="headpichold"><a title="'+r.data[s].name+" "+r.data[s].date+'" target="_blank" namecard="'+r.data[s].guestId+'" href="http://www.renren.com/profile.do?id='+r.data[s].guestId+'"><img width="32" height="32" src="'+r.data[s].headUrl+'"></a></span></li>';else for(s=0;s<r.data.length;s++)i+='<li><span class="headpichold"><a title="'+r.data[s].name+" "+r.data[s].date+'" target="_blank" namecard="'+r.data[s].guestId+'" href="http://www.renren.com/profile.do?id='+r.data[s].guestId+'"><img width="32" height="32" src="'+r.data[s].headUrl+'"></a></span></li>';t(r.options.ul).find(".group").html(i),r.data.length>r.options.amount&&r._enableForward();return}r._forward(),r.data.length>r.options.amount&&r._enableForward()}})},_createCardHtml:function(e){return e={list:e},n.render(r.templHtml,e)},_enableForward:function(){if(!this._disableForward)return;t(this.options.area).find(this.options.btn2).removeClass(this.options.btn2dclass),this._disableForward=!1},_enableBack:function(){if(!this._disableBack)return;t(this.options.area).find(this.options.btn1).removeClass(this.options.btn1dclass),this._disableBack=!1},_disableForwardAction:function(){t(this.options.area).find(this.options.btn2).addClass(this.options.btn2dclass),this.direction="back",this._disableForward=!0},_disableBackAction:function(){t(this.options.area).find(this.options.btn1).addClass(this.options.btn1dclass),this.direction="forward",this._disableBack=!0},_canForward:function(){return this.cindex<this.data.length-this.options.amount},_canBack:function(){return this.cindex>0||this.data.length>0?!0:!1},_forward:function(e){if(this._disableActions)return;if(this._disableForward)return;this.direction="forward",this._checkBeforeForward(),this._setContent(e),this._checkAfterForward(),this._canBack()&&this._enableBack()},_checkBeforeForward:function(){this.cindex+=this.options.amount},_checkAfterForward:function(){this._canForward()||this._disableForwardAction()},_back:function(){if(this._disableActions)return;if(this._disableBack)return;this.direction="back",this._checkBeforeBack(),this._setContent(),this._checkAfterBack()},_checkBeforeBack:function(){this.cindex-=this.options.amount,this._canForward()&&this._enableForward(),this.data.length>0&&this._enableForward()},_checkAfterBack:function(){this.cindex<=0&&this._disableBackAction()}})}),define("ui/renren/recommendFri",["jquery","mustache.js","ui/tooltip","ui/renren/relationFollow"],function(e,t){var n={wrapHtml:['<div id="recommendFriBox" class="recommend-box">','<div class="side-item-header clearfix">',"<h4>推荐好友</h4>",'<div class="option">','<a href="#" stats="recommendfriends-refresh" class="pager-forward" title="换一组" ></a>','<a href="http://friend.renren.com/newfriends" stats="recommendfriends-more" target="_blank" title="更多推荐" class="more"></a>',"</div>","</div>",'<div class="side-item-body recommend-fri-area clearfix">','<ul class="recommend-friends-list">',"</ul>","</div>","</div>"].join(""),titleHtml:['<div id="recommendFriBox" class="recommend-box">','<div class="side-item-header clearfix">',"<h4>热门推荐</h4>",'<div class="option">','<a href="#nogo" data-log="backward" class="ad-log pager-back back-disable" title="上一页" ></a>','<a href="#nogo" data-log="forward" class="ad-log pager-forward forward-disable" title="下一页" ></a>','<a href="http://app.renren.com" target="_blank" title="更多推荐" data-log="more" class="more ad-log"></a>',"</div>","</div>",'<div class="recommend-app-area" id="pymk_home_2">','<ul class="recommend-app-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),appTitleHtml:['<div id="recommendFriBox" class="recommend-box recommend-app-ad">','<div class="side-item-header clearfix">','<div class="option">','<a href="#nogo" data-log="backward" class="ad-log pager-back back-disable" title="上一页" ></a>','<a href="#nogo" data-log="forward" class="ad-log pager-forward forward-disable" title="下一页" ></a>','<a href="http://2014.renren.com/im" target="_blank" title="更多推荐" data-log="more" class="more ad-log"></a>',"</div>","</div>",'<div class="recommend-app-area" id="pymk_home_2">','<ul class="recommend-app-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),adHtml:["{{#list}}","<li>",'<p class="userhead"><a target="_blank" href="{{link}}" data-log="picture" class="ad-log"><img src="{{imgurl}}" width="100" height="100"><span class="username">{{name}}</span></a></p>','<p class="app-title"><a data-log="title" class="ad-log" target="_blank" href="{{link}}">{{content}}</a></p>',"</li>","{{/list}}"].join(""),appAdHtml:["{{#list}}",'<li><h4><a target="_blank" data-log="title" class="ad-log app-ad-title" href="{{link}}">{{name}}</a></h4>',"{{#isDouble}}",'<a target="_blank" data-log="picture" href="{{link}}" class="ad-log"><img src="{{imgurl_two_pane}}" alt="{{name}}" width="400" height="135"></a></li>',"{{/isDouble}}","{{^isDouble}}",'<a target="_blank" data-log="picture" href="{{link}}" class="ad-log"><img src="{{imgurl_single}}" alt="{{name}}" width="240" height="160"></a></li>',"{{/isDouble}}","</li>","{{/list}}"].join(""),templHtml:["{{#list}}",'<li class="recommend-friend" data-id="{{id}}" data-type="{{data_type}}">','<div class="userhead" namecard="{{id}}">','<a href="http://www.renren.com/profile.do?id={{id}}"><img src="{{mainimg}}" width="68" height="68"/></a>','<span class="friends-num">{{#hasCommonFri}}<a href="javascript:;" stats="recommendfriends-reason" data-common=\'{"uid":{{id}},"name":"{{name}}"}\'>{{/hasCommonFri}}',"{{shortExplanation}}","{{#hasCommonFri}}</a>{{/hasCommonFri}}</span>",'<a title="不再推荐此人" class="ui-icon ui-iconfont x-to-hide" href="#" stats="recommendfriends-exclude">&#xe846;</a>',"</div>",'<p class="userinfo-single">','<a namecard="{{id}}" title="{{name}}" class="username" href="http://www.renren.com/profile.do?id={{id}}" stats="recommendfriends-profile">{{shortName}}</a>','<a href="#" stats="recommendfriends-add" class="add-btn recommend-single" data-id="{{id}}" data-from="Web_SG_RcdFour_addFriend" title="关注好友"><span class="ui-icon ui-iconfont">&#xe849;</span></a>',"</p>","</li>","{{/list}}"].join(""),templDoubleHtml:["{{#list}}",'<li class="recommend-friend" data-id="{{id}}" data-type="{{data_type}}">','<div class="userhead">','<img src="{{mainimg}}" width="90" height="90"/>','<a href="#" stats="recommendfriends-add" class="ui-icon add-btn" data-id="{{id}}" data-from="Web_SG_RcdFour_addFriend" title="关注好友"></a>','<a title="不再推荐此人" class="ui-icon ui-iconfont x-to-hide" href="#" stats="recommendfriends-exclude">&#xe846;</a>',"</div>",'<p class="userinfo">','<a target="_blank" title="{{name}}" class="username" href="http://www.renren.com/profile.do?id={{id}}" stats="recommendfriends-profile">{{shortName}}</a>','<span class="friends-num">{{#hasCommonFri}}<a href="javascript:;" stats="recommendfriends-reason" data-common=\'{"uid":{{id}},"name":"{{name}}"}\'>{{/hasCommonFri}}',"{{explanation}}","{{#hasCommonFri}}</a>{{/hasCommonFri}}</span>","</p>","</li>","{{/list}}"].join("")};e.widget("renren.recommendfri",{options:{isDoubleFeed:!1},_create:function(){this.data=[],this.req=null,this.timer=null,this.showNum=this.options.isDoubleFeed?4:6,this.element.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-5",at:"center top",using:function(t,n){e(this).css(t),e("<div>").addClass("right-opt-tip-arrow").addClass(n.vertical).addClass(n.horizontal).appendTo(this)}}}),this._on({"click .pager-forward":"_fetch","click .x-to-hide":"_remove","mouseover .add-btn":function(t){var n=this;e(t.currentTarget).renrenrelationFollow({addAction:function(){n._remove(t)},friendAction:function(){n._remove(t)}})}}),this._fetch()},_destroy:function(){this.element.tooltip("destroy")},_setOption:function(e,t){e==="isDoubleFeed"&&(this._super(e,t),this.showNum=this.options.isDoubleFeed?4:6,this.data.length<this.showNum?this._fetch():this._setContent())},_fetch:function(t){if(this.req)return!1;this.req=e.ajax({url:"http://rcd.renren.com/cwf_nget_v7rcd_new",data:"pz=10",dataType:"jsonp",jsonp:"_jcb",context:this,complete:function(){this.req=null},success:function(t){if(t.code||!t.data||t.data.list.length<1){this.element.remove();return}var n=/^(\d+).(.+)$/;this.data=t.data.list,this.data.forEach(function(t){t.shortExplanation=t.explanation.replace(n,"$2$1").replace("的人",""),t.shortName=nx.stringplus.TSubString(e.trim(t.name),4,"...")}),this._setContent()}}),t&&t.preventDefault()},_setFramework:function(){this.element.html(n.wrapHtml)},_setContent:function(){var t=this.data.slice(0,this.showNum),n=this._createCardHtml(t);this.element.find(".add-btn").each(function(t,n){n=e(n),n.data("renren-addfriend")&&n.renrenaddfriend("destroy")}),this._setFramework(),this.element.find(".recommend-friends-list").html(n)},_patchContent:function(e){var t=this._createCardHtml([e]);this.element.find(".recommend-friends-list").append(t)},_createCardHtml:function(e){var r={list:e},i;return e.forEach(function(e){e.hasCommonFri=e.explanation.indexOf("共同好友")!==-1}),this.options.isDoubleFeed?i=t.render(n.templDoubleHtml,r):i=t.render(n.templHtml,r),i},_remove:function(t){var n=e(t.target),r=n.parents(".recommend-friend"),i=r.data("id"),s=r.data("type"),o=this;r.find(".add-btn").data("renren-addfriend")&&r.find(".add-btn").renrenrelationFollow("destroy"),this.data.forEach(function(e,t){e.id===i&&o.data.splice(t,1)}),r.animate({opacity:0},1e3,function(){r.remove(),o.data[o.showNum-1]?o._patchContent(o.data[o.showNum-1]):o._fetch()}),n.hasClass("x-to-hide")&&e.ajax({url:"http://rcd.renren.com/cwf_nremove_home",type:"post",data:"type="+s+"&guest="+i,dataType:"text"}),t.preventDefault()}})}),define("ui/renren/recommendFri_old",function(require,e){require("ui/tooltip"),require("ui/renren/relationFollow");var t=require("jquery"),n=require("mustache.js"),r={wrapHtml:['<div id="recommendFriBox" class="recommend-box">','<div class="side-item-header clearfix">',"<h4>推荐好友</h4>",'<div class="option">','<a href="#nogo" stats="recommendfriends-old-back" class="pager-back back-disable" title="上一页" ></a>','<a href="#nogo" stats="recommendfriends-old-forward" class="pager-forward forward-disable" title="下一页" ></a>','<a href="http://friend.renren.com/newfriends" stats="recommendfriends-old-more" target="_blank" title="更多推荐" class="more"></a>',"</div>","</div>",'<div class="side-item-body recommend-fri-area clearfix"  id="pymk_home_2">','<ul class="recommend-friends-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),titleHtml:['<div id="recommendFriBox" class="recommend-box">','<div class="side-item-header clearfix">',"<h4>热门推荐</h4>",'<div class="option">','<a href="#nogo" data-log="backward" class="ad-log pager-back back-disable" title="上一页" ></a>','<a href="#nogo" data-log="forward" class="ad-log pager-forward forward-disable" title="下一页" ></a>','<a href="http://app.renren.com" target="_blank" title="更多推荐" data-log="more" class="more ad-log"></a>',"</div>","</div>",'<div class="recommend-app-area" id="pymk_home_2">','<ul class="recommend-app-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),appTitleHtml:['<div id="recommendFriBox" class="recommend-box recommend-app-ad">','<div class="side-item-header clearfix">','<div class="option">','<a href="#nogo" data-log="backward" class="ad-log pager-back back-disable" title="上一页" ></a>','<a href="#nogo" data-log="forward" class="ad-log pager-forward forward-disable" title="下一页" ></a>','<a href="http://2014.renren.com/im" target="_blank" title="更多推荐" data-log="more" class="more ad-log"></a>',"</div>","</div>",'<div class="recommend-app-area" id="pymk_home_2">','<ul class="recommend-app-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),adHtml:["{{#list}}","<li>",'<p class="userhead"><a target="_blank" href="{{link}}" data-log="picture" class="ad-log"><img src="{{imgurl}}" width="100" height="100"><span class="username">{{name}}</span></a></p>','<p class="app-title"><a data-log="title" class="ad-log" target="_blank" href="{{link}}">{{content}}</a></p>',"</li>","{{/list}}"].join(""),appAdHtml:["{{#list}}",'<li><h4><a target="_blank" data-log="title" class="ad-log app-ad-title" href="{{link}}">{{name}}</a></h4>',"{{#isDouble}}",'<a target="_blank" data-log="picture" href="{{link}}" class="ad-log"><img src="{{imgurl_two_pane}}" alt="{{name}}" width="400" height="135"></a></li>',"{{/isDouble}}","{{^isDouble}}",'<a target="_blank" data-log="picture" href="{{link}}" class="ad-log"><img src="{{imgurl_single}}" alt="{{name}}" width="240" height="160"></a></li>',"{{/isDouble}}","</li>","{{/list}}"].join(""),templHtml:["{{#list}}",'<li id="commonFriend_{{id}}" data-type="{{data_type}}">','<p class="userhead">','<a target="_blank" stats="recommendfriends-old-profile" href="http://www.renren.com/profile.do?id={{id}}" namecard="{{id}}">','<img src="{{mainimg}}" width="100" height="100"/>','<span class="username">{{name}}</span>',"</a>",'<span class="x-to-hide" data-type="{{data_type}}" data-id={{id}}>','<a title="不再推荐此人" stats="recommendfriends-old-exclude"  class="ui-icon ui-icon-square-close" href="#nogo"></a>',"</span>","</p>",'<p class="friends-num">','<a href="#nogo" stats="recommendfriends-old-add" class="add-btn" data-from="Web_SG_RcdTwo_addFriend" data-id="{{id}}" title="关注好友"></a>','{{#hasCommonFri}}<a href="javascript:;" stats="recommendfriends-old-reason" data-common=\'{"uid":{{id}},"name":"{{name}}"}\'>{{/hasCommonFri}}',"{{explanation}}","{{#hasCommonFri}}</a>{{/hasCommonFri}}","</p>","</li>","{{/list}}"].join(""),templDoubleHtml:["{{#list}}",'<li id="commonFriend_{{id}}" data-type="{{data_type}}">','<p class="userhead">','<img src="{{mainimg}}" width="100" height="100"/>','<a href="#nogo" stats="recommendfriends-old-add" class="add-btn" data-from="Web_SG_RcdTwo_addFriend" data-id="{{id}}" title="关注好友"></a>','<span class="x-to-hide" data-type="{{data_type}}" data-id={{id}}>','<a title="不再推荐此人" stats="recommendfriends-old-exclude" class="ui-icon ui-icon-square-close" href="#nogo"></a>',"</span>","</p>",'<p class="friends-num">','<a target="_blank" stats="recommendfriends-old-profile" class="user-name" href="http://www.renren.com/profile.do?id={{id}}" namecard="{{id}}">{{name}}</a>','{{#hasCommonFri}}<a href="javascript:;" stats="recommendfriends-old-reason" data-common=\'{"uid":{{id}},"name":"{{name}}"}\'>{{/hasCommonFri}}',"{{explanation}}","{{#hasCommonFri}}</a>{{/hasCommonFri}}","</p>","</li>","{{/list}}"].join("")},i={show:"RecFriend_show",remove:"RecFriend_cancle",addFriend:"RecFriend_addFriend",addFriendEnd:"RecFriend_addFriendEnd",name:"RecFriend_nameToPrf",head:"RecFriend_imgToPrf",back:"RecFriend_back",forward:"RecFriend_forward",more:"RecFriend_more"};t.widget("renren.recommendfri",{options:{column:"single",loadUrl:"http://rcd.renren.com/cwf_nget_v7rcd",delUrl:"http://rcd.renren.com/cwf_nremove_home",amount:2,speed:200,area:"#recommendFriBox",ul:"#commonFriends_home_2",box:"#pymk_home_2",btn1:".pager-back",btn2:".pager-forward",btn1dclass:"back-disable",btn2dclass:"forward-disable",more:".more",listWidth:224},_create:function(){this._initData(),this._fetch()},_init:function(){},_destroy:function(){},_events:function(){var e=this;(function(){var n=function(n,r){var i=nx.user.id;t(e.options.area).delegate(n,"click",function(){t.ajax({url:"http://www.renren.com/homeV7Logger/send",type:"post",data:{log:"[{'hostId':'"+i+"','targetTag':'rcd_"+r+"'}]"},dataType:"json",success:function(e){return}})})};n(".userhead img","head"),n(".user-name,.username","name"),n(".more","more"),n(".pager-back,.pager-forward","page"),n(".friends-num a[data-common]","common")})(),t(this.options.box).parent().delegate(".ad-log","click",function(){var n=t(this).data("log"),r=e.options.column+"_"+e.type;t.get("http://www.renren.com/homeLog/recommend?type="+r+"&position="+n);return}),t(this.options.area).delegate(this.options.btn1,"click",function(){return e._back(),!1}),t(this.options.area).delegate(this.options.btn2,"click",function(){return e._forward(),!1}),t(this.options.box).parent().hover(function(){t(this).find(".pager-back").css({display:"inline-block"}),t(this).find(".pager-forward").css({display:"inline-block"})},function(){t(this).find(".pager-back").css({display:"none"}),t(this).find(".pager-forward").css({display:"none"})}),t(this.options.box).parent().tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(n.vertical).addClass(n.horizontal).appendTo(this)}}}),t(this.options.box).delegate(".add-btn","mouseover",function(){var n=t(this).parent().parent().find(".x-to-hide");t(this).hasClass("loged")||(t(this).addClass("loged"),t(this).on("click",function(){t.ajax({url:"http://www.renren.com/homeV7Logger/send",type:"post",data:{log:"[{'hostId':'"+nx.user.id+"','targetTag':'rcd_add'}]"},dataType:"json",success:function(e){return}})})),t(".add-btn").renrenrelationFollow({addAction:function(t){e._remove(n)},friendAction:function(){e._remove(n)}})}),t(this.options.box).delegate(".x-to-hide","click",function(){return e._remove(t(this)),!1}),t(this.options.box).delegate(".userhead","mouseenter",function(n){t(this).parent().find(".x-to-hide").show();if(e.options.column=="double"){var r=t(this).find(".add-btn");r.css("visibility","visible")}}),t(this.options.box).delegate(".userhead","mouseleave",function(e){t(this).parent().find(".x-to-hide").hide();var n=t(this).find(".add-btn");n.css("visibility","hidden")})},_initData:function(){this.data={},this.req=null,this.cindex=0,this.direction="forward",this._disableForward=!0,this._disableBack=!0,this.slideTimer=null,this.type=null},_setContent:function(e){var n=this._getSomeDom(this.data,this.cindex,this.cindex+this.options.amount),r=t('<div class="group"></div>').append(n);this.direction==="forward"&&t(this.options.ul).append(r),this.direction==="back"&&t(this.options.ul).prepend(r);if(e)return;this._slide()},_getSomeDom:function(e,t,n){var r=e.slice(t,n),i=this._createCardHtml(r);return i},_slide:function(){this._disableActions=!0;var e,n=t(this.options.ul),r=this;this.direction==="forward"&&(e=t(r.options.ul).find(".group").eq(0),n.animate({left:-r.options.listWidth},this.options.speed,function(){e.remove(),n.css({left:"0"}),r._disableActions=!1;return})),this.direction==="back"&&(n.css({left:-r.options.listWidth}),e=t(r.options.ul).find(".group").eq(1),n.animate({left:0},this.options.speed,function(){e.remove(),n.css({left:"0"}),r._disableActions=!1;return}))},_fetch:function(){var e=this.options.loadUrl,n=this;this.req=t.ajax({url:e+"?t="+Math.random(),type:"get",dataType:"json",success:function(e){if(!e.data)return;n.data=e.data.list.slice(0,50),n.type=e.type;if(n.data.length<1)return;e.type=="1"?t(r.wrapHtml).appendTo(t("#recommendArea")):e.type=="2"?t(r.titleHtml).appendTo(t("#recommendArea")):e.type=="3"&&(n.options.amount=1,t(r.appTitleHtml).appendTo(t("#recommendArea"))),n._setContent(!0),t(n.options.ul).parent().show(),n.data.length>n.options.amount&&n._enableForward(),n._events(),n._sendOnShowLog()}})},_createCardHtml:function(e){var i={list:e};if(this.type=="1"){t.each(e,function(e,t){t.explanation==="可能认识的人"?t.hasCommonFri=!1:t.hasCommonFri=!0});if(this.options.column=="single")return n.render(r.templHtml,i);if(this.options.column=="double")return n.render(r.templDoubleHtml,i)}else{if(this.type=="2")return n.render(r.adHtml,i);if(this.type=="3")return i.isDouble=this.options.column==="double",n.render(r.appAdHtml,i)}},_enableForward:function(){if(!this._disableForward)return;t(this.options.area).find(this.options.btn2).removeClass(this.options.btn2dclass),this._disableForward=!1},_enableBack:function(){if(!this._disableBack)return;t(this.options.area).find(this.options.btn1).removeClass(this.options.btn1dclass),this._disableBack=!1},_disableForwardAction:function(){t(this.options.area).find(this.options.btn2).addClass(this.options.btn2dclass),this.direction="back",this._disableForward=!0},_disableBackAction:function(){t(this.options.area).find(this.options.btn1).addClass(this.options.btn1dclass),this.direction="forward",this._disableBack=!0},_canForward:function(){return this.cindex<this.data.length-this.options.amount},_canBack:function(){return this.cindex>0||this.data.length>0?!0:!1},_forward:function(e){if(this._disableActions)return;if(this._disableForward)return;this.direction="forward",this._checkBeforeForward(),this._setContent(e),this._checkAfterForward(),this._canBack()&&this._enableBack
()},_checkBeforeForward:function(){this.cindex+=this.options.amount},_checkAfterForward:function(){this._canForward()||this._disableForwardAction()},_back:function(){if(this._disableActions)return;if(this._disableBack)return;this.direction="back",this._checkBeforeBack(),this._setContent(),this._checkAfterBack()},_checkBeforeBack:function(){this.cindex-=this.options.amount,this._canForward()&&this._enableForward(),this.data.length>0&&this._enableForward()},_checkAfterBack:function(){this.cindex<=0&&this._disableBackAction()},_remove:function(e){var n=this,r=e.attr("data-type"),i=e.attr("data-id"),s=t(n._getItem(i)).index();t.ajax({url:n.options.delUrl+"?t="+Math.random(),type:"post",data:"type="+r+"&guest="+i,dataType:"text",success:function(r){try{setTimeout(function(){n._syncData(s),e.parents("li").fadeOut("slow",function(){t(this).remove(),n._checkAfterForward(),n._disableActions=!1,n._patch()})},1e3)}catch(i){}},error:function(){t.dialog.error("服务器异常，请稍候再试。")}})},_patch:function(){if(this.data.length<1){t(this.options.box).parent().hide();return}var e=this.data[this.cindex+this.options.amount-1],n=[];n.push(e);if(!e){if(t(this.options.ul).find("li").length===0){this._back(),this._disableForwardAction();return}}else{var r=this._createCardHtml(n);t(this.options.ul).find(".group").append(r)}},_getItem:function(e){return t("#commonFriend_"+e)},_syncData:function(e){this.data.splice(this.cindex+e,1)},_sendOnShowLog:function(){var e=this,n=[],r=[],s=t(e.options.ul).find("li");for(var o=0,u=s.length;o<u;o++){n.push(s.eq(o).attr("id").split("_")[1]),r.push(s.eq(o).attr("data-type"));var a=e._getLog(s.eq(o).attr("id").split("_")[1],"show")}e._logRcd({action:a||i.show,guest_id:n.join("|"),type:r.join("|")})},_getLog:function(e,n){try{return t("log_"+n+"_"+e).val()}catch(r){return!1}},_logRcd:function(e){var t=[];t.push(e.action),t.push(nx.user.id),e.guest_id&&t.push(e.guest_id),e.recommend_id&&t.push(e.recommend_id),e.all_id&&t.push(e.all_id),e.type&&t.push(e.type),e.pregroup&&t.push(e.pregroup),(new Image).src="http://rcd.renren.com/ajaxHomeReconnectStat?param="+t.join("|")+"&t="+(new Date).getTime()}})}),define("photo/past",function(require,e){var t=require("jquery");require("ui/tooltip");var n={url:Math.floor(Math.random()*10)<5?"http://ark.renren.com/photo/photo/data?r="+(new Date).getTime():"http://photo.renren.com/photo/data?r="+(new Date).getTime(),urlType:"http://photo.renren.com/photo/setMode?r="+(new Date).getTime()+"&mode=",tpl:['<div class="side-item photopast">',' <div class="advert-box ad-pic-past">','  <div class="side-item-advert" data-adzone-id="100000100002"></div>'," </div>",'<div class="side-item-header"><h3>过往的今天</h3>','<div class="advert-box advert-box-photo"><div class="side-item-advert" data-adzone-id="100000100001"></div></div>','<div class="option ui-button ui-button-icon-only">','<span class="ui-icon ui-icon-square-setting"></span>','<p class="option-layer">','<a href="javascript:;" mode="1">过往的今天</a>','<a href="javascript:;" mode="0">好友的最新</a>','<a href="javascript:;" mode="2">热门推荐</a>',"</p></div></div>",'<div class="side-item-body"><div class="photopast-image"><img/>','<div class="photopast-notice"><div class="photopast-notice-bg"></div><p class="photopast-notice-text"></p></div>','<a href="javascript:;" class="photopast-btn photopast-prev"></a><a href="javascript:;" class="photopast-btn photopast-next"></a>','<p class="photopast-title"><a class="title"></a><a href="javascript:;" data-tip="赞一个" class="like"></a><a href="javascript:;" data-tip="分享" class="share"></a></p>',"</div>",'<div class="photopast-memo"><a class="photopast-name" target="_blank"></a><b class="photopast-date"></b></div>',"</div>"],cache:[],page:0,errors:0,timer:null};n.init=function(){t("#right-fix-info").append(n.tpl.join("")),n.bind(),n.get(),t(".photopast-title").tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-16",at:"top center",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(n.vertical).addClass(n.horizontal).appendTo(this)}},disabled:!1,content:function(){var e=t(this),n=t(this).data("tip");return e.hasClass("liked")&&(n="取消赞"),n},items:"a[data-tip]",hide:!1,openDelay:0})},n.title=function(e){var n="",r=t(".photo-past-ads"),i=r.is(":hidden");e=parseInt(e);switch(e){case 0:n="好友的最新";break;case 1:n="过往的今天";break;case 2:n="热门推荐"}t(".photopast h3").text(n),t(".photopast .option-layer a").removeClass("hover"),t(".photopast .option-layer a[mode="+e+"]").addClass("hover")},n.notice=function(e,r){var i="";e=parseInt(e);switch(e){case 0:i="你的好友最近没有上传照片";break;case 1:i="好友未在过往的今天上传照片";break;case 3:i="木有新鲜事 赶紧去添加好友";break;default:i="OPPS~最热推荐里边也木有照片"}var s=t(".photopast-notice-text"),o=t(".photopast-notice");r?(s.text(i),o.show()):(n.title(e),s.addClass("photopast-notice-suc").text("设置成功"),o.show()),setTimeout(function(){s.removeClass("photopast-notice-suc"),o.fadeOut()},2e3)},n.get=function(e){var r=n.url;e&&(r=n.urlType+e),t.ajax({url:r,dataType:"json",success:function(t){t.mode!=undefined?t.data.length>0?(n.cache=t.data,n.render(),n.title(t.suggestmode),e&&n.notice(e)):e&&n.notice(3,!0):e&&n.notice(e,!0)},stats:!0})},n.prev=function(){n.page===0?n.page=n.cache.length-1:n.page--,n.render()},n.next=function(e){n.page===n.cache.length-1?n.page=0:n.page++,n.render(e)},n.render=function(e){var r=n.cache[n.page];if(r){var i=0,s=0,o=new Image;o.onerror=function(){n.errors++,n.errors<10&&n.next()},o.onload=function(){var o=240,u=this.width,a=this.height,f=240,l=o;if(a<100)n.errors++,n.errors<10&&n.next();else{var c=240/u*a;c>o?(i=-(c-o)/2,l=c):c<100?(l=100,f=100/a*u,f<240?(n.errors++,n.errors<10&&n.next()):s=-(f-240)/2):l=c,t(".photopast-image img").remove(),t(".photopast-image").append('<img style="margin-left:'+s+"px;margin-top:"+i+'px;" width="'+f+'" height="'+l+'" src="'+this.src+'" data-viewer={"type":"photo","owner":"'+r.userId+'","id":"'+r.photoId+'","url":"'+r.largeUrl+'","width":0,"height":0} />'),i!==0&&t(".photopast-image").css({height:"maxHeight",overflow:"hidden"});var h=nx.stringplus.TSubString(r.originalTitle,"10","...");if(h.indexOf("@")!=-1){var p=h.indexOf("@"),d=r.title.indexOf(">")+1,v=r.title.substring(p,d),m=h.split("@"),g=m[0],y="@"+m[1].split(")")[0],b=m[1].split(")")[1]?")"+m[1].split(")")[1]:"";h=String(g+v+y+"</a>"+b)}t(".photopast-title .title").html(h+"&nbsp;").attr("title",r.originalTitle),t(".photopast-name").text(nx.stringplus.SubString(r.userName,6)).attr({href:"http://www.renren.com/"+r.userId,namecard:r.userId}),r.nYear.length===3?t(".photopast-date").text(["上传于",r.nYear[0],"年",r.nYear[1],"月",r.nYear[2],"日"].join("")):t(".photopast-date").text(["上传于",r.nYear,"年前的今天"].join("")),t(".photopast-title .share").attr("data-share",'{"stype":"create_share_feed","type":"photo","id":"'+r.photoId+'","owner":"'+r.userId+'"}'),t(".photopast-title .like").remove();var w=r.like===1?"取消赞":"赞一个",E=r.like===1?"like liked":"like",S='<a href="javascript:;" data-tip="'+w+'" class="'+E+'" data-like=""></a>';t(t(".photopast-title a")[0]).after(S),t(".photopast-title .like").attr("data-like",'{"stype":"photo","sourceId":"'+r.photoId+'","owner":"'+r.userId+'"}').bind("mouseover",function(){var e=t(this);e.renrenlike({onadd:function(){n.cache[n.page].like=1},onremove:function(){n.cache[n.page].like=0}})}),n.timer===null&&(n.timer=setInterval(function(){n.next(!0)},15e3)),e||(clearInterval(n.timer),n.timer=setInterval(function(){n.next(!0)},15e3))}},o.src=r.largeUrl.replace(/([^\/]+)$/,"p/m3w240h240q100lt_$1").replace(/\.gif$/,".gif.jpg")}},n.bind=function(){var e=t(".photopast .option");e.bind("mouseover",function(){t(this).addClass("hover"),t(".photopast .option-layer").show()}),e.bind("mouseout",function(){t(this).removeClass("hover"),t(".photopast .option-layer").hide()}),t(".photopast .option-layer a").click(function(){var e=t(this);e.hasClass("hover")||(t(".photopast .option-layer").hide(),t(".photopast-notice-text").text("加载中..."),t(".photopast-notice").show(),n.get(e.attr("mode")))}),t(".photopast-next").click(function(){n.next()}),t(".photopast-prev").click(function(){n.prev()}),t(".photopast-title .share").click(function(){t(this).renrenshare(t(this).data().share)});var r=t(".photopast-image");r.bind("mouseenter",function(){t(".photopast-btn").show()}),r.bind("mouseleave",function(){t(".photopast-btn").hide()})},e.init=function(){n.init()}}),define("newsfeed/group",function(require,e){var t=jQuery.noConflict(),n=require("ui/friendManagement"),r=require("ui/friendSearch");require("ui/scrollbar");var i={addIntoGroup:function(e,n,r,i){t.ajax({url:"http://friend.renren.com/friends/api/editgroups?t="+Math.random(),type:"post",dataType:"text",data:"p={'action':'addmultgroups','names':['"+e+"'],'buddys':'"+n+"'}",success:function(e){r.call(i,t.parseJSON(e))}})},addIntoGroupList:function(e,n,r,i){var s={action:"addmultgroups",names:e,buddys:n};t.ajax({url:"http://friend.renren.com/friends/api/editgroups?t="+Math.random(),type:"post",dataType:"text",data:"p="+JSON.stringify(s),success:function(e){r.call(i,t.parseJSON(e))}})},getGroupSuggest:function(e,n,r){t.ajax({url:"http://friend.renren.com/friends/api/suggestaddgroup?t="+Math.random(),type:"post",dataType:"text",data:"gname="+e,success:function(e){n.call(r,t.parseJSON(e))}})},getSpecificData:function(e,n,r){t.ajax({url:"http://friend.renren.com/friendsSelector.do",type:"post",dataType:"text",data:"p={'init':false,'qkey':'friend','uid':true,'uname':true,'uhead':true,'limit':24,'param':{},'query':'','group':'"+e+"','net':'','page':false}",success:function(e){n.call(r,t.parseJSON(e))}})},removeFromGroup:function(e,n,r,i){t.ajax({url:"http://friend.renren.com/friends/api/batchremove?t="+Math.random(),type:"post",dataType:"text",data:"p={'action':'batchremove','ids':["+n+"],'groupname':'"+e+"'}",success:function(e){r.call(i,t.parseJSON(e))}})},getGroupList:function(e,n,r){t.ajax({url:"http://www.renren.com/home/getGroupDetail",type:"get",dataType:"text",data:"groupId="+e,success:function(e){n.call(r,e)}})},setNumberNotice:function(e,n,r,i){t.ajax({url:"http://www.renren.com/leftmenu/setNumberNotice",type:"post",dataType:"text",data:"menuId="+e+"&type=2&notice="+n,success:function(e){r.call(i,e)}})}},s=function(e,n){this.groupName=e,this.groupId=n,t(".nf-group-list-container").find(".fd-nav-cur-item").removeClass("fd-nav-cur-item"),t(".nf-group-list-container").find("a[data-gid="+n+"]").parent("li").addClass("fd-nav-cur-item"),this.topPos={1:"85px",2:"125px",3:"165px"},this.bdContent=t(".bd-content"),this.feedList=t("#feed-list"),this.rightMenu=t(".nx-right");var r=t("#friends-filter");this.memberManage=r.find(".member-manage"),this.remindBtn=r.find(".not-remind"),this.toolList=r.find(".tool-menu ul"),this.memberList=r.find(".member-list"),this.suggestorContainer=r.find(".group-suggestor"),this.suggestorList=r.find(".suggestor-list"),this.suggestorGroup=r.find(".suggestor-group"),this.groupScroll=this.suggestorGroup.find("ul"),this.suggestorGName=r.find(".suggestion-group"),this.gName=r.find(".group-name"),this.gCounts=r.find(".user-counts"),this.searchInput=r.find(".ui-friend-search"),this.selectedItem=null,this.userId=null,this.addInGroupList=[],this.initGroupInfo(this.groupName),this.bindEvent();var i=this;this.searchInput.friendSearch({placeholder:"输入好友姓名加入本组",showGroupName:!0,groupName:e,selectEvent:function(e,t,n,r){i.addMember(e,t,n,r)}})};s.prototype={bindEvent:function(){var e=this;this.memberManage.on("click",function(){t.ui.friendManagement({specificGName:e.groupName,onAddFriends:function(t){e.changeGroupInfo(t)},onRemoveFriends:function(t){e.changeGroupInfo(t)}})}),this.suggestorContainer.on("click",".show-group-list",function(){e.selectedItem=t(this).parents("li");var n=e.selectedItem.index();e.userId=e.selectedItem.attr("data-uid"),e.suggestorGroup.show(),e.suggestorGroup.css("top",e.topPos[n+1]),e.suggestorGroup.find(".a-group").length>10&&(e.suggestorGroup.css("height","340px"),e.suggestorGroup.scrollbar(),e.groupScroll.scrollbar())}),this.suggestorContainer.on("click",".add-group",function(){var n=t(this).parents("li"),r=n.attr("data-uid"),s=n.children("img").attr("src"),o=n.children(".suggest-name").html();e.userId=n.attr("data-uid");var u=[];if(e.suggestorGroup.css("display")=="block"){var a=e.suggestorGroup.find(".selected");for(var f=0;f<a.length;f++)u.push(t(a[f]).children("span").text())}else u.push(e.groupName);i.addIntoGroupList(u,e.userId,function(i){i.code==0&&(n.remove(),e.memberList.length==12&&e.memberList.children().last().remove(),e.memberList.children().first().before(t(e.getMemberContent({id:r,head:s,name:o}))),e.gCounts.text(parseInt(e.gCounts.text())+1),e.isNone(),e.initInput())})}),this.suggestorGroup.on("click",".a-group",function(){var n=[];t(this).toggleClass("selected");var r=e.suggestorGroup.find(".selected");for(var s=0;s<r.length;s++)n.push(t(r[s]).children("span").text());i.addIntoGroupList(n,e.userId,function(t){t.code==0&&e.isNone()})}),this.remindBtn.on("click",function(){var n=this;t(this).text()=="不显示更新提醒"?i.setNumberNotice(e.groupId,!1,function(e){t(n).text("显示更新提醒")}):t(this).text()=="显示更新提醒"&&i.setNumberNotice(e.groupId,!0,function(e){t(n).text("不显示更新提醒")})}),t("body").on("click",function(n){t(n.target).parents(".suggestor-group").length==0&&!t(n.target).hasClass("show-group-list")&&t(n.target).parents(".show-group-list").length==0&&e.suggestorGroup.hide()})},isNone:function(){this.suggestorList.find("li").length==0&&this.suggestorContainer.remove()},initGroupInfo:function(e){this.groupName=e,this.loadSuggestion(e)},removeFeedTip:function(){t("#toolRefreshFeed").remove(),this.feedList.find(".new-feed-tip").remove()},loadSuggestion:function(e){var t=this;this.suggestorGName.html(e),i.getGroupSuggest(e,function(e){if(e.recommend){var n=e.recommend,r="";for(var i=0;i<(n.length>3?3:n.length);i++)r+=t.getSugContent(n[i]);t.suggestorList.html(r),t.suggestorContainer.show()}})},loadGroupInfo:function(e){var t=this;i.getSpecificData(e,function(n){var r=n.candidate;t.gName.html(e),t.gCounts.html(r.length);var i="";for(var s=0;s<(r.length>12?12:r.length);s++)i+=t.getMemberContent(r[s]);t.memberList.html(i)})},addMember:function(e,n,r,s){var o=this,u=s.split(","),a=[];for(var f=0;f<u.length;f++)u[f]!=""&&a.push(u[f]);var l=!0;for(var f=0;f<a.length;f++)this.groupName==a[f]&&(l=!1,t.dialog.success("您所选的好友已经在该组中"));l&&(a.push(o.groupName),i.addIntoGroupList(a,e,function(i){o.memberList.children().length==12&&o.memberList.children().last().remove(),o.memberList.children().first().before(t(o.appendUserTpl(e,n,r))),o.gCounts.html(parseInt(o.gCounts.text())+1),o.suggestorList.find("li[data-uid="+e+"]").length>0&&(o.suggestorList.find("li[data-uid="+e+"]").remove(),o.suggestorList.find("li").length==0&&o.suggestorContainer.remove())}))},appendUserTpl:function(e,t,n){var r=['<a href="http://www.renren.com/profile.do?id='+e+'" namecard="'+e+'" title="'+t+'">','	<img src="'+n+'">',"</a>"].join("");return r},initInput:function(){this.searchInput.val(""),t("#friends-filter .query-result").hide()},getSugContent:function(e){var t=['<li class="clearfix" data-uid = "'+e.id+'">','	<img src="'+e.tinyurl+'">','	<a href="http://www.renren.com/profile.do?id='+e.id+'" class="suggest-name">'+e.name+"</a>",'	<span class="suggest-operation clearfix">','		<a href="javascript:;" class="add-group">加入</a>','		<a href="javascript:;" class="show-group-list"><i></i></a>',"	</span>","</li>"].join("");return t},getMemberContent:function(e){var t=['<a href="http://www.renren.com/profile.do?=id'+e.id+'" namecard="'+e.id+'" title="'+e.name+'">','	<img src="'+e.head+'">',"</a>"].join("");return t},changeGroupInfo:function(e){var n=this;t.ajax({url:"http://www.renren.com/home/getGroupDetail?groupId="+e,dataType:"text",success:function(r){n.feedList.children().not(".new-feed-tip").remove(),t(nx.data.feed).trigger("friendsNewsFeed",e),t("#friends-filter").length>0&&t("#friends-filter").remove(),t(r).prependTo(n.rightMenu)}})}},e.groupFriends=s}),define("ui/friendSearch",function(require,e){var t=jQuery.noConflict();require("ui/placeholder");var n={queryInfor:function(e,n,r){t.ajax({url:"http://friend.renren.com/friends/api/queryinformation",type:"post",dataType:"text",data:"l=5&p="+e,success:function(e){n.call(r,t.parseJSON(e))}})}};t.widget("ui.friendSearch",{options:{placeholder:"",groupName:"",showGroupName:!1,selectEvent:function(){}},_create:function(){this.searchResult="",this.element.placeholder({text:this.options.placeholder}),this.element.after(t('<ul class="query-result"></ul>')),this.resultContainer=t(".query-result"),this.groupName=this.options.groupName||"",this.memberList=t(".member-list"),this.listLength=0,this._events()},_init:function(){},_destroy:function(){},_events:function(){var e=this;this.element.on("keyup",function(r){if(r.keyCode!=40&&r.keyCode!=38||e.resultContainer.css("display")!="block")if(r.keyCode==13){var i=e.resultContainer.find(".actived");if(i.length>0){var s=i.attr("data-uid"),o=i.children(".name").html(),u=i.children("img").attr("src"),a=i.find(".groups-name").html();e.resultContainer.css("display")=="block"&&e.options.selectEvent(s,o,u,a),e.initInput()}}else{var f="",l=e.element.val();n.queryInfor(l,function(n){if(n.code==0&&n.data.length>0){for(var r=0;r<n.data.length;r++){var i=n.data[r].id;if(i>1e3&&i<6e8||i>699999999&&i<780000001||i>799999999&&i<2147479033){var s=e.singleQuery(n.data[r]);f+=s}}e.resultContainer.html(t(f)),f!=""?e.resultContainer.show():e.resultContainer.hide()}else e.resultContainer.hide();e.listLength=e.resultContainer.children().length})}else if(r.keyCode==40){var i=e.resultContainer.find(".actived");i.length>0?i.parent("li").index()!=e.listLength-1?(i.parent("li").next().children("a").addClass("actived"),i.removeClass("actived")):(i.removeClass("actived"),e.resultContainer.find("li:eq(0) a").addClass("actived")):e.resultContainer.find("li:eq(0) a").addClass("actived")}else if(r.keyCode==38){var i=e.resultContainer.find(".actived");i.length>0?i.parent("li").index()!=0?(i.parent("li").prev().children("a").addClass("actived"),i.removeClass("actived")):(i.removeClass("actived"),e.resultContainer.find("li:eq("+(e.listLength-1)+") a").addClass("actived")):e.resultContainer.find("li:eq("+(e.listLength-1)+") a").addClass("actived")}}),this.element.on("blur",function(n){var r=this;setTimeout(function(){t(r).val()==""&&e.resultContainer.hide()},100)}),this.element.on("click",function(n){t(this).val()==""&&e.resultContainer.hide()}),this.resultContainer.on("click",".add-into-group",function(){var n=t(this).attr("data-uid"),r=t(this).children(".name").html(),i=t(this).children("img").attr("src"),s=t(this).find(".groups-name").html();e.options.selectEvent(n,r,i,s),e.initInput()}),this.resultContainer.on("mouseenter",".add-into-group",function(){e.resultContainer.find(".actived").removeClass("actived"),t(this).addClass("actived")})},singleQuery:function(e){var t="";if(this.options.showGroupName){for(var n=0;n<e.groups.length;n++)if(this.groupName==e.groups[n])return"";e.groups.length>0&&(t=e.groups.toString())}if(t=="")var r=["<li>",'	<a href="#nogo" onclick="return false;" class="add-into-group clearfix" data-uid="'+e.id+'">','		<img src="'+e.tinyurl+'">','		<span class="name">'+e.name+"</span>",'		<span class="group"><span class="groups-name">'+t+"</span></span>","	</a>","</li>"].join("");else var r=["<li>",'	<a href="#nogo" onclick="return false;" class="add-into-group clearfix" data-uid="'+e.id+'">','		<img src="'+e.tinyurl+'">','		<span class="name">'+e.name+"</span>",'		<span class="group">[<span class="groups-name">'+t+"</span>]</span>","	</a>","</li>"].join("");return r},appendUserTpl:function(e,t,n){var r=['<a href="http://www.renren.com/profile.do?id='+e+'" namecard="'+e+'" title="'+t+'">','	<img src="'+n+'">',"</a>"].join("");return r},initInput:function(){this.element.val(""),this.resultContainer.hide()}})}),define("ui/friendManagement",function(require,e){var t=jQuery.noConflict(),n={getAllData:function(e,n){var r=JSON.stringify({uid:!0,uhead:!0,uname:!0,group:!0,init:!0,param:{}});t.ajax({url:"http://friend.renren.com/friendsSelector.do",type:"post",dataType:"text",data:"p="+r,success:function(r){e.call(n,t.parseJSON(r))}})},getSpecificData:function(e,n,r){var i=JSON.stringify({uid:!0,uhead:!0,uname:!0,group:e,init:e==="全部好友",param:{}});t.ajax({url:"http://friend.renren.com/recommendSelector.do",type:"post",cache:!0,dataType:"text",data:"p="+i,success:function(e){n.call(r,t.parseJSON(e))},error:function(e){console.log("失败")}})},batchRemove:function(e,n,r,i){t.ajax({url:"http://friend.renren.com/friends/api/batchremove?t="+Math.random(),type:"post",dataType:"text",data:"p={'action':'batchremove','ids':["+e+"],'groupname':'"+n+"'}",success:function(e){r.call(i,t.parseJSON(e))}})},searchGroupData:function(e,n,r,i){if(n==="全部好友")var s="all";else var s="normal";t.ajax({url:"http://friend.renren.com/friends/api/searchgroupdata?t="+Math.random(),type:"post",dataType:"text",data:"p=[{'t':'people','data':'"+e+"'},{'t':'gid','data':'"+n+"'},{'t':'gtype','data':'"+s+"'}]",success:function(e){r.call(i,t.parseJSON(e))}})},addIntoGroup:function(e,n,r,i){t.ajax({url:"http://friend.renren.com/friends/api/batchaddgroups?t="+Math.random(),type:"post",dataType:"text",data:"p={'action':'batchadd','keep':'1','groupsname':['"+e+"'],'ids':["+n+"]}",success:function(e){r.call(i,t.parseJSON(e))}})}};t.widget("ui.friendManagement",{options:{specificGName:"",onAddFriends:function(){},onRemoveFriends:function(){}},_create:function(){this.initGroupName=this.options.specificGName,this.otherRequestCount=0,this.dialogContainer=null,this.tabCurrent=null,this.currentContainer=null,this.currentSelectContainer=null,this.currentUserList=null,this.curCountDom=null,this.curTotalDom=null,this.curTotalCount=null,this.curList=null,this.activedUserCount=0,this.curSelectAllBox=null,this.tabOther=null,this.otherContainer=null,this.otherSelectContainer=null,this.otherCount=null,this.groupList=null,this.otherUserList=null,this.searchInput=null,this.activedGroupName=null,this.otherActivedUCont=0,this.otherActList=null,this.otherSelectAllBox=null,this.showDialog()},_init:function(){},_destroy:function(){_self.dialogContainer.remove()},_events:function(){var e=this;this.dialogContainer.on("click",".cls-btn,.cancel",function(){e.dialogContainer.remove(),t(".ui-widget-overlay").hide()}),this.dialogContainer.on("click",".other-group",function(){e.initOtherGroup(),e.showOtherGroup(),e.otherCleanUp(),e.otherCheckBtn(),e.otherCheckAll()}),this.dialogContainer.on("click",".current-group",function(){e.showCurrentGroup(),e.initCurrentGroup(),e.curCleanUp(),e.curCheckBtn(),e.curCheckAll()}),this.currentContainer.on("click",".a-friend",function(){t(this).toggleClass("selected");var n=t(this).children("p").html(),r=t(this).attr("data-uid");t(this).hasClass("selected")?(t(e.getSeletedItem(n,r)).appendTo(e.currentSelectContainer),e.activedUserCount++):(e.currentSelectContainer.find(".a-selected[data-uid="+r+"]").remove(),e.activedUserCount--),e.curCountDom.html(e.activedUserCount),e.curCheckAll(),e.curCheckBtn()}),this.currentContainer.on("click",".a-selected i",function(){var n=t(this).parent().attr("data-uid");t(this).parent().remove(),e.currentUserList.find(".a-friend[data-uid="+n+"]").removeClass("selected"),e.activedUserCount--,e.curCountDom.html(e.activedUserCount),e.curCheckAll(),e.curCheckBtn()}),this.currentContainer.on("click",".select-all a",function(){t(this).hasClass("checked")?e.curCleanUp():e.curSelectAll(),e.curCheckBtn()}),this.currentContainer.on("click",".clear-data",function(){e.curCleanUp(),e.curCheckBtn()}),this.dialogContainer.on("click",".remove",function(){t(this).hasClass("disable")||e.removeMember()}),this.otherContainer.on("click",".a-group",function(){e.activedGroupName=t(this).html();var r=t(this).attr("data-map");n.getSpecificData(e.activedGroupName,function(t){e.renderSpecificGroup(t,r),e.otherCheckBtn(),e.searchFriends()})}),this.otherContainer.on("keyup",".search-friend",function(){e.searchFriends()}),this.otherContainer.on("click",".a-friend",function(){t(this).toggleClass("selected");var n=t(this).children("p").html(),r=t(this).attr("data-uid");t(this).hasClass("selected")?(t(e.getSeletedItem(n,r)).appendTo(e.otherSelectContainer),e.otherActivedUCont++):(e.otherSelectContainer.find(".a-selected[data-uid="+r+"]").remove(),e.otherActivedUCont--),e.otherCheckAll(),e.otherCount.html(e.otherActivedUCont),e.otherCheckBtn()}),this.otherContainer.on("click",".a-selected i",function(){var n=t(this).parent().attr("data-uid");t(this).parent().remove(),e.otherUserList.find(".a-friend[data-uid="+n+"]").removeClass("selected"),e.otherActivedUCont--,e.otherCheckAll(),e.otherCount.html(e.otherActivedUCont),e.otherCheckBtn()}),this.otherContainer.on("click",".select-all a",function(){t(this).hasClass("checked")?e.otherCleanUp():e.otherSelectAll(),e.otherCheckBtn()}),this.otherContainer.on("click",".clear-data",function(){e.otherCleanUp(),e.otherCheckBtn()}),this.otherContainer.on("click",".add",function(){t(this).hasClass("disable")||e.addMember()})},initCurrentGroup:function(){var e=this;n.getSpecificData(e.initGroupName,function(n){var r=n.candidate,i="";for(var s=0;s<r.length;s++)i+=e.getUserListItem(n.candidate[s].head,n.candidate[s].name,n.candidate[s].id);e.currentUserList.html(t(i)),e.initCurrentCount()})},initOtherGroup:function(){var e=this;if(e.otherRequestCount==0)n.getAllData(function(t){e.renderGroupList(t),e.activedGroupName=e.groupList.find("li a:first").html(),e.renderSpecificGroup(t,-1),e.otherRequestCount++});else{var t=e.groupList.find(".actived"),r=t.attr("data-map");e.activedGroupName=t.html(),n.getSpecificData(e.activedGroupName,function(t){e.renderSpecificGroup(t,r)})}},createDialog:function(){var e=this;n.getSpecificData(e.initGroupName,function(n){var r=n.candidate,i="";for(var s=0;s<r.length;s++)i+=e.getUserListItem(n.candidate[s].head,n.candidate[s].name,n.candidate[s].id);t.ui.dialog({dialogClass:"member-manage-dialog",width:569,buttons:[]}),t(".member-manage-dialog .ui-widget-content").hide(),t(e.getDialog(i,e.initGroupName)).appendTo(t(".member-manage-dialog")),e.setParam(),e.resizePosition(),e.initCurrentCount(),e._events()})},showCurrentGroup:function(){this.tabCurrent.addClass("selected"),this.tabOther.removeClass("selected"),this.otherContainer.hide(),this.currentContainer.show()},showOtherGroup:function(){this.tabOther.addClass("selected"),this.tabCurrent.removeClass("selected"),this.currentContainer.hide(),this.otherContainer.show()},renderGroupList:function(e){var t=e.groups,n="";for(var r=0;r<t.length+1;r++)r===0?n+=this.getGroupListItem("全部好友",r):n+=this.getGroupListItem(t[r-1],r);this.groupList.html(n)},setParam:function(){this.dialogContainer=t(".member-manage-dialog"),this.tabCurrent=this.dialogContainer.find(".current-group"),this.tabOther=this.dialogContainer.find(".other-group"),this.currentContainer=this.dialogContainer.find(".dialog-content-current"),this.currentUserList=this.currentContainer.find(".list-detail"),this.currentSelectContainer=this.currentContainer.find(".select-list-container"),this.curCountDom=this.currentContainer.find(".select-tips .selected"),this.curTotalDom=this.currentContainer.find(".select-tips .total"),this.curSelectAllBox=this.currentContainer.find(".select-all a"),this.removeBtn=this.currentContainer.find(".remove"),this.otherContainer=this.dialogContainer.find(".dialog-content-other"),this.otherSelectContainer=this.dialogContainer.find(".dialog-content-other .select-list-container"),this.otherCount=this.otherContainer.find(".select-tips .selected"),this.groupList=this.otherContainer.find(".group-list ul"),this.otherUserList=this.otherContainer.find(".list-detail"),this.searchInput=this.otherContainer.find(".search-friend"),this.otherSelectAllBox=this.otherContainer.find(".select-all a"),this.addBtn=this.otherContainer.find(".add")},showDialog:function(){t(".member-manage-dialog").length>0?(t(".member-manage-dialog").show(),t(".ui-widget-overlay").show(),this.resizePosition()):this.createDialog()},resizePosition:function(){t(".member-manage-dialog").css({left:(t(window).width()-611)/2+"px",top:(t(window).height()-549)/2+"px"})},curCleanUp:function(){this.currentContainer.find(".a-friend").removeClass("selected"),this.currentSelectContainer.html(""),this.initCurrentCount(),this.curCheckAll()},curSelectAll:function(){this.activedUserCount=this.curTotalCount,this.curCountDom.html(this.curTotalCount),this.currentContainer.find(".a-friend").addClass("selected");var e=this.currentContainer.find(".a-friend"),n="";for(var r=0;r<e.length;r++)n+=this.getSeletedItem(t(e[r]).children("p").html(),t(e[r]).attr("data-uid"));this.curCheckAll(),this.currentSelectContainer.html(n)},curCheckAll:function(){this.activedUserCount==this.curTotalCount&&this.curTotalCount!=0?this.curSelectAllBox.addClass("checked"):this.curSelectAllBox.removeClass("checked")},curCheckBtn:function(){this.currentSelectContainer.find(".a-selected").length>0?this.removeBtn.removeClass("disable"):this.removeBtn.addClass("disable")},otherCleanUp:function(){this.otherContainer.find(".a-friend").removeClass("selected"),this.otherSelectContainer.html(""),this.initOtherCount(),this.otherCheckAll()},otherSelectAll:function(){var e=this.otherContainer.find(".a-friend").not(".hidden").not(".selected").addClass("selected"),n="";for(var r=0;r<e.length;r++)n+=this.getSeletedItem(t(e[r]).children("p").html(),t(e[r]).attr("data-uid"));t(n).appendTo(this.otherSelectContainer),this.otherActivedUCont=this.otherSelectContainer.find(".a-selected").length,this.otherCount.html(this.otherActivedUCont),this.otherCheckAll()},otherCheckAll:function(){this.otherUserList.find(".a-friend").not(".hidden").length==this.otherUserList.find(".selected").length&&this.otherUserList.find(".a-friend").not(".hidden").length>0?this.otherSelectAllBox.addClass("checked"):this.otherSelectAllBox.removeClass("checked")},otherCheckBtn:function(){this.otherSelectContainer.find(".a-selected").length>0?this.addBtn.removeClass("disable"):this.addBtn.addClass("disable")},addMember:function(){var e=this,r=[],i=this.otherSelectContainer.find(".a-selected");for(var s=0;s<i.length;s++)r.push(t(i[s]).attr("data-uid"));n.addIntoGroup(e.initGroupName,r,function(t){e.otherUserList.find(".selected").removeClass("selected"),e.otherSelectContainer.html(""),e.otherTotalCount=e.otherTotalCount,e.initOtherCount(),e.otherCheckAll(),e.otherCheckBtn(),e.options.onAddFriends(nx.data.feed.feedGId)})},removeMember:function(){var e=this,r=this.currentSelectContainer.find(".a-selected"),i=[];for(var s=0;s<r.length;s++)i.push(t(r[s]).attr("data-uid"));n.batchRemove(i,e.initGroupName,function(t){e.currentUserList.find(".selected").remove(),e.currentSelectContainer.html(""),e.initCurrentCount(),e.curCheckBtn(),e.curCheckAll(),e.options.onRemoveFriends(nx.data.feed.feedGId)})},getSeletedItem:function(e,t){var n=['<a data-uid="'+t+'" class = "a-selected">',"	<span>"+e+"</span>","	<i></i>","</a>"].join("");return n},getGroupListItem:function(e,t){var n=["<li>",'	<a class="a-group" data-map="'+t+'">'+e+"</a>","</li>"].join("");return n},getUserListItem:function(e,t,n,r){if(r)var i=['<div class="a-friend selected" data-uid="'+n+'">','	<img src="'+e+'">',"	<p>"+t+"</p>","</div>"].join("");else var i=['<div class="a-friend" data-uid="'+n+'">','	<img src="'+e+'">',"	<p>"+t+"</p>","</div>"].join("");return i},getDialog:function(e,t){var n=['	<div class="header">',"		<h2>"+t+"成员管理</h2>",'		<a class="cls-btn"></a>',"	</div>",'	<div class="dialog-tab clearfix">','		<a class="current-group selected">删除组员</a>','		<a class="other-group">添加组员</a>',"	</div>",'	<div class="dialog-content-current">','		<div class="show-list-container">','			<p class="select-all clearfix">',"				<a></a>","				全选","			</p>",'			<div class="list-detail clearfix">'+e,"			</div>","		</div>",'		<div class="select-tips clearfix">','			<span>选中的好友(<span class="selected"></span>/<span class="total"></span>)</span>','			<a class="clear-data">清空</a>',"		</div>",'		<div class="select-list-container">',"		</div>",'		<div class="footer clearfix">','			<a class="remove disable">移出'+t+"组</a>",'			<a class="cancel">取消</a>',"		</div>","	</div>",'	<div class="dialog-content-other">','		<div class="clearfix">','			<div class="group-list">','				<input class="search-friend" placeholder="搜索好友">',"				<ul>","				</ul>","			</div>",'			<div class="show-list-container">','				<p class="select-all clearfix">',"					<a></a>","					全选","				</p>",'				<div class="list-detail clearfix">',"				</div>","			</div>","		</div>",'		<div class="select-tips clearfix">','			<span>选中的好友(<span class="selected"></span>)</span>','			<a class="clear-data">清空</a>',"		</div>",'		<div class="select-list-container">',"		</div>",'		<div class="footer clearfix">'
,'			<a class="add disable">移入'+t+"组</a>",'			<a class="cancel">取消</a>',"		</div>","	</div>"].join("");return n},initCurrentCount:function(){this.activedUserCount=0,this.curCountDom.html(0),this.curTotalCount=this.currentUserList.find(".a-friend").length,this.curTotalDom.html(this.curTotalCount)},initOtherCount:function(){this.otherActivedUCont=0,this.otherCount.html(0)},renderSpecificGroup:function(e,n){var r=e.candidate;this.otherActList=r;var i="",s=[],o=this.otherSelectContainer.find("a");for(var u=0;u<o.length;u++)s.push(t(o[u]).attr("data-uid"));for(var u=0;u<r.length;u++)t.inArray(r[u].id.toString(),s)!=-1?i+=this.getUserListItem(r[u].head,r[u].name,r[u].id,!0):i+=this.getUserListItem(r[u].head,r[u].name,r[u].id);n==-1?this.groupList.find(".a-group:eq(0)").addClass("actived"):(this.groupList.find(".actived").removeClass("actived"),this.groupList.find("a[data-map="+n+"]").addClass("actived")),this.otherUserList.html(i),this.otherCheckAll()},searchFriends:function(){var e=this;n.searchGroupData(e.searchInput.val(),e.activedGroupName,function(t){e.otherUserList.find(".a-friend").addClass("hidden");var n=t.data;if(n.length>0)for(var r=0;r<n.length;r++)e.otherUserList.find(".a-friend[data-uid="+n[r].fid+"]").removeClass("hidden");e.searchInput.val().trim()==""&&e.otherUserList.find(".a-friend").removeClass("hidden"),e.otherCheckAll(),e.otherCheckBtn()})}})}),define("newsfeed/advert",function(require){var $=require("jquery"),advert={singleCol:!1,_closeEvent:function(e){var t=$(".openAdvert");t.length&&t.on("click",".openAdvert-close",function(n){t.remove(),$("#openAdvert_data").remove(),$.ajax({url:"http://www.renren.com/ajax/v7closeActivity",type:"POST",data:{spreadId:e},dataType:"json",success:function(e){}}),n.stopPropagation()})},_locationEvent:function(){var e=$(".openAdvert");e.length&&e.on("click",".openAdvert-logo, .openAdvert-bottom",function(e){window.open($(this).attr("data-href")),e.stopPropagation()})},_ajax:function(){var This=this,openAdvertData=$("#openAdvert_data");if(!openAdvertData.length)return;var data;eval("data ="+openAdvertData.attr("openAdvert-data"));var iconUrl=data.folImg||"",logoUrl=data.freImg||"",linkUrl=data.link.match("http://")?data.link:"http://"+data.link,slogan=data.content||data.name;$("#toolBackTo").append(This._tpl.openAdvert(logoUrl,iconUrl,linkUrl,slogan)),This._position(),This._closeEvent(data.id),This._locationEvent()},_tpl:{openAdvert:function(e,t,n,r){r=r.length<=9?r:r.substr(0,9);var i=['<div class="openAdvert">','	<div class="openAdvert-top">','		<img class="openAdvert-logo" src="'+e+'" data-href="'+n+'">','		<span class="openAdvert-close"></span>',"	</div>",'	<a class="openAdvert-bottom" data-href="'+n+'" target="_blank">','		<img class="openAdvert-icon" src="'+t+'">','		<span class="openAdvert-slogan">'+r+"</span>","	</a>","</div>"].join("");return i}},_position:function(){return;var e},renderDom:function(){var e=$(window).width(),t=$("#webpager").hasClass("fold"),n=!nx.data.isDoubleFeed;switch(arguments[1]){case"fold":t=!0;break;case"unfold":t=!1;break;case"single":n=!0;break;case"double":n=!1;break;default:}e>=1500&&t&&n?$(".openAdvert").length?(this._position(),$(".openAdvert").show()):this._ajax():$(".openAdvert").is(":hidden")||$(".openAdvert").hide()},scroolEvent:function(){$(".openAdvert").length&&$(document).scrollTop()>0?$(".openAdvert-top").show():$(".openAdvert-top").hide()},bindEvent:function(){$(window).scroll(this.scroolEvent),$(document).on("mainframe:reflow",this.renderDom.bind(this))},init:function(){if(window.location.href.match("matter"))return;this.bindEvent()}};return advert}),define("newsfeed/doubleCols",function(require,exports){var $=require("jquery"),tools=require("newsfeed/tools"),doubleCols={win:$(window),rootEle:$("html"),bdContainer:$(".bd-container"),doubleImg:function(img,closeWid){var This=$(img),wid=This.attr("data-width"),hei=This.attr("data-height"),data=eval("("+This.attr("data-viewer")+")");if(!wid){setTimeout(function(){doubleCols.doubleImg(img,closeWid)},300);return}if(wid>closeWid){This.css({width:closeWid+"px",height:hei*closeWid/wid+"px"});var vocalPlayer=This.parent().siblings(".vocal-player");vocalPlayer.length&&(vocalPlayer.css({width:closeWid-20+"px"}),vocalPlayer.find(".count").css({left:closeWid-110+"px"}),This.parent().siblings(".vocal-btn").css({left:(closeWid-84)/2+"px"}))}},imgReset:function(){if(nx.browser.name.toLowerCase().match("ie"))return;var e=$(".location-left").find("img")||[],t=$(".share-photo").find("img")||[],n=$(".photo-content-1").find("a:not(.location-left)").find(".photo-feed-pic1")||[];if($(".double-cols-feed").length)e.each(function(e,t){var n=$(t).attr("data-width");n?doubleCols.doubleImg(t,410):setTimeout(function(){doubleCols.doubleImg(t,410)},200)}),t.each(function(e,t){var n=$(t).attr("data-width");n?doubleCols.doubleImg(t,410):setTimeout(function(){doubleCols.doubleImg(t,410)},200)}),n.each(function(e,t){var n=$(t).attr("data-width");n?doubleCols.doubleImg(t,440):setTimeout(function(){doubleCols.doubleImg(t,440)},200)});else{var r=function(e,t){var n=$(e),r=n.width(),i=n.height();n.attr("style","");if(r==t){var s=t+60;n.css({width:s+"px",height:i*s/r+"px"});var o=n.parent().siblings(".vocal-player");o.length&&(o.css({width:s-20+"px"}),o.find(".count").css({left:s-110+"px"}),n.parent().siblings(".vocal-btn").css({left:(s-84)/2+"px"}))}};e.each(function(e,t){r(t,410)}),t.each(function(e,t){r(t,410)}),n.each(function(e,t){r(t,440)})}},adjustHeight:function(){var e=$("#feed-list"),t=$("#feed-list-right"),n=e.height(),r=t.height(),i;while(n>r){i=e.children().last();if(!(i.height()+20<n-r))break;t.append(i),n=$("#feed-list").height(),r=$("#feed-list-right").height()}while(n<r){i=t.children().last();if(!(i.height()+20<r-n))break;e.append(i),n=$("#feed-list").height(),r=$("#feed-list-right").height()}},_doubleFeed:function(e){var t=this,n=$("#feed-list"),r=$("#feed-list-right");setTimeout(function(){t.imgReset()},100);if(!n.length){setTimeout(function(){t._doubleFeed(e)},50);return}var i=function(){var e=n.children(),t=[];for(var r=0;r<e.length;r++){if(e[r+1])if(e[r].className.match("linkage-for")||e[r+1].className.match("linkage-for"))continue;if(!e[r].className.match("a-feed"))continue;t.push(e[r])}return $(t)}(),s=$(),o=$("#recommendArea"),u=$("#huatiBox");if(!r.length)return;if(e){i.each(function(e,t){$(t).hasClass("similar-feed")||e%2&&(r.append(t),s=s.add(t))}),s.length&&s.eq(Math.min(s.length-2,4)).after(u),s.length?s.eq(Math.min(s.length-1,4)).after(o):$("#mergeModule").after(o),setTimeout(function(){t.adjustHeight()},500);var a=setInterval(function(){$(".advert-banner").length&&($(".advert-banner").parent().parent().hide(),clearInterval(a))},50)}else{var f=r.children(),l=[],c=0;for(var h=0;h<f.length;h++){var p=f[h].className;if(p.match("linkage-for"))l.push(f[h]);else if(p.match("a-feed")&&i[c]){if(i[c+1])while(i[c+1].className.match("linkage-for"))c++;$(i[c]).after(f[h]),c++}}l.length&&$("#"+l[0].className.match(/\d+/)[0]).after(l),r.find(".a-feed").length&&r.find(".a-feed").each(function(e,t){n.append(t)}),$("#merge-side-item-body").append(o);var d=setInterval(function(){$(".advert-banner").length&&($(".advert-banner").parent().parent().show(),clearInterval(d))},50)}},_onFeedChange:function(e,t){var n=this;if(n.bdContainer.hasClass("double-cols-feed")){setTimeout(function(){n.imgReset()},100);var r=$("#feed-list"),i=$("#feed-list-right");if(t==="empty")r.empty(),i.empty();else{var s=function(){var e=r.children(),t=[];for(var n=0;n<e.length;n++){if(e[n+1])if(e[n].className.match("linkage-for")||e[n+1].className.match("linkage-for"))continue;t.push(e[n])}return $(t)}(),o=i.find(".a-feed");s.length>o.length?s.slice(o.length).each(function(e,t){$(t).hasClass("similar-feed")||e%2&&i.append(t)}):s.length<o.length&&o.slice(s.length).each(function(e,t){e%2&&r.append(t)}),setTimeout(function(){n.adjustHeight()},500)}}},winHeight:0,winWith:0,changeCols:function(){var e=window.innerHeight||document.documentElement.clientHeight,t=window.innerWidth||document.documentElement.clientWidth;if(arguments[1]!="single"&&arguments[1]!="double"&&e===this.winHeight&&t===this.winWidth)return;this.winHeight=e,this.winWidth=t;var n=this,r=n.win.width();if(n.rootEle.hasClass("nx-main760")){r>=1260&&nx.data.isDoubleFeed?n.bdContainer.hasClass("double-cols-feed")||(n.bdContainer.addClass("double-cols-feed"),n._doubleFeed(!0)):n.bdContainer.hasClass("double-cols-feed")&&(n.bdContainer.removeClass("double-cols-feed"),$(".bd-publisher").find("div").length?($(".new-feed-tip").length&&!$(".new-feed-tip").hasClass("pubTip")&&$(".new-feed-tip").addClass("pubTip"),$("#missed-feed-tips").length&&!$("#missed-feed-tips").hasClass("pubTip")&&$("#missed-feed-tips").addClass("pubTip")):($(".new-feed-tip").length&&$(".new-feed-tip").removeClass("pubTip"),$("#missed-feed-tips").length&&$("#missed-feed-tips").removeClass("pubTip")),n._doubleFeed(!1)),r>=1260?($(".single-col").show(),$(".double-cols").show()):($(".single-col").hide(),$(".double-cols").hide()),$.event.trigger("newsfeed:"+(n.bdContainer.hasClass("double-cols-feed")?"double":"single"));if(arguments[1]==="single"||arguments[1]==="double")return;$(".none-feed").length?tools.btnFactory(2):$(".a-feed").length&&(tools.btnFactory(1),$(".setting-btn").is(":hidden")||setTimeout(function(){tools.btnFactory(4)},250))}},bindEvent:function(){var e=this;$(window).on("feedchange",this._onFeedChange.bind(this)),$(window).on("adjustheight",this.adjustHeight.bind(this)),$(document).on("mainframe:reflow",this.changeCols.bind(this))},init:function(){this.bindEvent()}};return doubleCols}),define("newsfeed/index",function(require,e){var t=jQuery.noConflict(),n=require("newsfeed/doubleCols"),r=require("newsfeed/initFeed"),i=require("newsfeed/loader"),s=require("newsfeed/feedFilter"),o=require("newsfeed/tips"),u=require("newsfeed/feedSort"),a=require("newsfeed/log"),f=require("newsfeed/advert"),l=function(){nx.data.feed==undefined&&(nx.data.feed={}),nx.data.feed.pvTab="1",new i.FeedLoader,new s.FeedFilter,new u.FeedSort,new o.FeedTips,new a.FeedLoger,n.init(),n.changeCols(),f.init(),r.init(),r.handleData(t(".bd-content").find(".a-feed")),nx.data.page&&t(nx.data.feed).trigger("contentFocus",{type:20})};e.feedIndex=l}),define("newsfeed/feed",["jquery","newsfeed/reply","newsfeed/toolbar","newsfeed/photo","newsfeed/Recommend","newsfeed/voice","newsfeed/mvideo","newsfeed/tools"],function(e,t,n,r,i,s,o,u){e.widget("newsfeed.feed",{options:{source:null},_create:function(){var a=this.element,f=a.attr("id"),l=a.children(".header").children(".user-avatar").attr("data-stype");this.feedId=f;if(!nx.data.matter&&a.find(".reply").length>0&&e("#get-params-for-"+f).length>0)try{var c=e.parseJSON(u.unescapeHTML(e("#get-params-for-"+f).html()));this.feedReply=new t.FeedReply(f,c,l)}catch(h){console.log("新鲜事"+f+"评论参数有问题，新鲜事类型为"+l)}new n.ToolBar(f),a.find(".cursor-all img").length>1&&new r.multiPhoto(f),a.find(".action-4-pics").length>0&&new i.Recommend(f),(l=="103"||l=="701"||l=="2004")&&a.find(".vocal-player").length>0&&new s.Voice(f,l),a.find(".blog-video").length>0&&this.resizeBlogIcon(f),a.find(".link-img img").length>0&&this.resizeLinkImg(f),this.options.source===13&&e("#"+f).find(".feed-hide").hide(),(nx.browser.chrome===!0||nx.browser.mozilla===!0)&&(l==="103"||l==="701"||l==="709"||l==="104")&&this.addShadow(f,l),a.find(".feed-icon-iphone").length>0&&e("#"+f).find(".feed-icon-iphone").html("手机icon<i></i>"),a.find(".feed-icon-android").length>0&&e("#"+f).find(".feed-icon-android").html("手机icon<i></i>"),a.find(".micro-video-content").length>0&&(this.mvideo=new o.MVideo(f))},_destroy:function(){this.feedReply&&this.feedReply.destroy(),this.mvideo&&this.mvideo.destroy()},resizeBlogIcon:function(t){var n=e("#"+t);if(n.find(".blog-video").length>0){var r=n.find(".play-btn"),i=n.find(".blog-video img");i.load(function(){r.css({left:(i.width()-42)/2+"px",top:(i.height()-42)/2+"px"})}),r.css({left:(i.width()-42)/2+"px",top:(i.height()-42)/2+"px"})}},resizeLinkImg:function(t){var n=e("#"+t).find(".link-img img");n.length>0&&u.linkResize(n)},addShadow:function(t,n){var r=e("#"+t);if(n==="103")var i=r.find(".share-photo");else{var s=r.find(".cursor-all"),o;if(n==="701"||n==="709")for(o=0;o<s.length;o++)e("<span class='shadow-div' data-viewer='"+e(s[o]).children("img").attr("data-viewer")+"'></span>").appendTo(s[o]);else for(o=0;o<s.length;o++)e("<span class='shadow-div'></span>").appendTo(s[o])}}})}),define("newsfeed/loader",function(require,e){var t=jQuery.noConflict(),n=require("newsfeed/tools"),r={getAllFeed:function(e,n,r,i,s,o){var u;t(".bd-container").hasClass("double-cols-feed")?u="10":u="10",t.ajax({url:"http://www.renren.com/feedretrieve4.do",type:"post",data:"byTime="+e+"&begin="+n+"&limit="+r+"&isjson=0&view="+u+"&type="+i,dataType:"text",success:function(e){s.call(o,e)}})},getGroupFeed:function(e,n,r,i,s,o){t.ajax({url:"http://www.renren.com/feedgroup.do",type:"post",data:"p="+e+"&begin="+n+"&limit="+r+"&gid="+i+"&view=10",dataType:"text",success:function(e){s.call(o,e)}})},getOriginalFeed:function(e,n,r,i,s){t.ajax({url:"http://www.renren.com/feedretrieve4.do",type:"post",data:"byTime="+e+"&begin="+n+"&limit="+r+"&isjson=0&view=10&type=1",dataType:"text",success:function(e){i.call(s,e)}})},getFocusFeed:function(e,n,r){t.ajax({url:"http://www.renren.com/feedfavorite2.do",type:"post",data:"p="+e+"&view=10",dataType:"text",success:function(e){n.call(r,e)}})},getContentFocus:function(e,n,r,i){var s;t(".bd-container").hasClass("double-cols-feed")?s="10":s="10",t.ajax({url:"http://www.renren.com/feedsubscribe.do",type:"post",data:"feedid="+e+"&limit=20&view="+s+"&sub="+n,dataType:"text",success:function(e){r.call(i,e)}})},getMissedFeedData:function(e,n,r,i){t.ajax({url:"http://www.renren.com/feedmissgetdata.do",type:"post",data:"begin="+e+"&limit="+n+"&view=10",dataType:"text",success:function(e){r.call(i,e)}})}},i=function(e){this.AUTO_LOAD=2,this.has_loaded=0,this.pageNum=0,this.nomoredata=!1,this.feedList=t("#feed-list"),this.bdContent=t(".bd-content"),this.feedLoadedFlag=!0,this.dataLength=0,this.getFeedType=0,this.sortType=t("#frameFixedNav .feed-sort .by-time"),this.gId=0,this.loadingTips="<p id='feed-loading-tips'>新鲜事读取中...</p>",this.initialize()};i.prototype={initialize:function(){this.bindEvents()},getData:function(){var e=this,n,i,s;t(nx.data.feed).trigger("feedLoading"),this.has_loaded==0?(n=0,i=10,s=0):this.has_loaded==1?(n=10,i=30,s=1):this.has_loaded==2?(n=40,i=20,s=2):(n=this.has_loaded*20,i=20,s=this.has_loaded);if(this.getFeedType==0){var o;this.sortType.hasClass("checked")?o=1:o=0,r.getAllFeed(o,n,i,-1,function(t){nx.data.feed.ifloadTime=!0,nx.data.feed.loadTime=new Date,e.handleFeedData(t)})}else if(this.getFeedType==11)r.getGroupFeed(s,n,i,e.gId,function(t){e.handleFeedData(t)});else if(this.getFeedType==12)nx.data.feed.focusContent&&(this.focusId="INF",nx.data.feed.focusContent=!1),r.getContentFocus(e.focusId,e.focusType,function(t){e.handleFeedData(t)});else if(this.getFeedType==13)r.getFocusFeed(s,function(t){e.handleFeedData(t)});else if(this.getFeedType==14)r.getMissedFeedData(n,i,function(t){e.handleFeedData(t)});else if(this.getFeedType==1)r.getOriginalFeed(0,n,i,function(t){e.handleFeedData(t)});else{var u;this.getFeedType==9?u=1:u=0,r.getAllFeed(u,n,i,e.getFeedType,function(t){e.handleFeedData(t)})}this.bindScrollEvent()},handleFeedData:function(e){var n=this,r=e.split("##@L#");this.focusId=r[1],n.missedFeedFlag&&(n.missedFeedFlag=!1,r[4]=="1"&&(nx.data.feed.getMissedFeed=!0)),r[3]=="0"&&r[0].trim()==""?t(nx.data.feed).trigger("nomoredata"):t(nx.data.feed).trigger("feedRecieved",{data:e,loaded:n.has_loaded,type:n.getFeedType})},bindScrollEvent:function(){var e=this;this.has_loaded==0&&t(window).bind("scroll/200",e.scrollEvent)},scrollEvent:function(){var e=t("#feed-list");t(document).scrollTop()>=e.height()*.7&&t(nx.data.feed).trigger("feedLoadingStart")},bindEvents:function(){var e=this;if(nx.data.matter)return;this.bindScrollEvent(),t(nx.data.feed).on("feedLoadingStart",function(){e.feedLoadedFlag&&(e.has_loaded<=e.AUTO_LOAD-1?(e.has_loaded=e.has_loaded+1,e.feedLoadedFlag=!1,e.getData()):e.has_loaded>e.AUTO_LOAD?t(window).unbind("scroll",e.scrollEvent):t(window).unbind("scroll",e.scrollEvent))}),t(nx.data.feed).on("nomoredata",function(r){e.nomoredata=!0,t("#feed-loading-tips").hide(),nx.data.feed.focusContent?e.feedList.find(".none-feed").length==0&&n.btnFactory(3):e.feedList.find(".none-feed").length==0&&n.btnFactory(2),t(".setting-btn").is(":hidden")||n.btnFactory(4)}),t(nx.data.feed).on("feedLoading",function(t){e.feedList.find(".get-more-feed").length>0}),t(nx.data.feed).on("feedRendered",function(r){e.feedLoadedFlag=!0,e.nomoredata==0&&(n.btnFactory(1),setTimeout(function(){t(".setting-btn").is(":hidden")||n.btnFactory(4)},100))}),t(nx.data.feed).on("groupFocus",function(t,n){nx.data.feed.focus=!0,nx.data.feed.focusContent=!1,e.getFeedType=13,n||e.initFeedList()}),t(nx.data.feed).on("contentFocus",function(t,n,r){nx.data.feed.focusContent=!0,e.getFeedType=12,e.focusType=n.type,e.focusType=="1"?nx.data.feed.pvTab="5":e.focusType=="0"?nx.data.feed.pvTab="6":e.focusType=="20"&&(nx.data.feed.pvTab="7"),r||e.initFeedList()}),t(nx.data.feed).on("friendsNewsFeed",function(t,n){nx.data.feed.focusContent=!1,e.getFeedType=11,e.gId=n,e.initFeedList()}),t(nx.data.feed).on("newsfeedFilter",function(t,n,r){e.getFeedType=parseInt(n.type),r||e.initFeedList()}),t(nx.data.feed).on("friendsOriginal",function(t,n){nx.data.feed.focusContent=!1,nx.data.feed.pvTab="4",e.getFeedType=1,n||e.initFeedList()}),t(nx.data.feed).on("sortBySmart",function(){e.missedFeedFlag=!0,nx.data.feed.focusContent=!1,nx.data.feed.pvTab="3",e.getFeedType=0,e.initFeedList()}),t(nx.data.feed).on("sortByTime",function(){nx.data.feed.focusContent=!1,e.missedFeedFlag=!0,nx.data.feed.pvTab="2",e.getFeedType=0,e.initFeedList()}),t(nx.data.feed).on("getMissedFeedData",function(){nx.data.feed.focusContent=!1,e.getFeedType=14,e.initFeedList(),n.btnFactory(4)}),this.bdContent.on("click",".get-more-feed",function(n){e.has_loaded=e.has_loaded+1,t(".double-cols-feed").length?t(this).replaceWith(t('<img style="display:block; float: left;margin: 0 45px;" src="http://s.xnimg.cn/nx/core/theme/images/loading.gif">')):t(this).parents(".get-more-feed-con").remove(),e.getData(),n.preventDefault()})},initFeedList:function(){this.has_loaded=0,this.nomoredata=!1,this.bdContent.find(".a-feed").remove(),this.bdContent.find(".none-feed").remove(),this.bdContent.find(".similar-feed-link").remove(),this.bdContent.find(".get-more-feed").remove(),this.bdContent.find(".get-more-feed-con").remove(),t("#return-all-tips").remove(),t("#feed-continue-tips").remove(),t("#toolRefreshFeed .feed-continue-read").hide(),t(window).trigger("feedchange","empty"),t("#feed-loading-tips").length>0?t("#feed-loading-tips").show():t(this.loadingTips).appendTo(this.feedList),this.getData()}},e.FeedLoader=i}),define("newsfeed/initFeed",function(require,e){var t=require("jquery"),n=require("newsfeed/feedOptions"),r=require("newsfeed/similarFeed");require("ui/renren/like"),require("ui/renren/share"),require("ui/renren/vocal"),require("ui/renren/follow"),require("newsfeed/feed");var i={feedList:t("#feed-list"),bdContent:t(".bd-content"),fdNav:t(".fd-nav-list"),isCloseKeyOp:!1,isCloseKeyOp:!1,render:function(e){var n="",r,i=t(e.data);for(r=0;r<i.length;r++)t("#"+i.eq(r).attr("id")).length<=0&&n.indexOf(i.eq(r).attr("id"))==-1&&(n+=i.eq(r).get(0).outerHTML);n=t(n),this.feedList.find(".none-feed").length>0&&this.feedList.find(".none-feed").remove();if(e.insertType=="before"){var s="";for(r=i.length-1;r>=0;r--)t("#"+i.eq(r).attr("id")).length<=0&&s.indexOf(i.eq(r).attr("id"))==-1&&(s+=i.eq(r).get(0).outerHTML);t("#feed-list").find(".a-feed").length>0?t(s).insertBefore(t("#feed-list .a-feed:eq(0)")):t(s).appendTo(t("#feed-list"))}else{if(e.insertType=="similarReplace"){this.bdContent.find("img[data-src]").lazyload({instantly:!0}),this.handleData(i.get(0),"similarFeed");return}if(e.insertType=="similarAppend"){var o="",u,a=[];for(r=0;r<t(n).length;r++)o+='<div class="similar-feed-link linkage-for-'+e.selfFid+'"><i class="left-icon"></i><i class="right-icon"></i></div>',u=t(n).eq(r).addClass("similar-feed").addClass("linkage-for-"+e.selfFid),u.find(".header").addClass("hidden"),o+=u.get(0).outerHTML;o=t(o),o.insertAfter(t("#"+e.selfFid)),this.bdContent.find("img[data-src]").lazyload({instantly:!0}),this.handleData(o,"similarFeed");return}n.appendTo(this.feedList),t(window).trigger("feedchange")}this.bdContent.find("img[data-src]:not(.footprint-thumb)").lazyload({instantly:!0}),this.handleData(n,e.type)},handleData:function(e,n){var r=t(e),i=r.length;if(i>10&&!nx.browser.name.toLowerCase().match("ie")){var s=Math.floor(i/2),o=r.slice(0,s),u=r.slice(s);this.packHandle(o,n),this.packHandle(u,n)}else this.packHandle(r,n)},packHandle:function(e,r){var i=[];for(var s=0;s<e.length;s++){var o=e.eq(s);o.hasClass("a-feed")&&(i.push(o.attr("id")),o.newsfeedfeed({source:r}))}new n.FeedOptions(i),t(nx.data.feed).trigger("feedRendered",{ids:i,type:r});if(nx.data.feed.ifloadTime){var u;nx.data.feed.ifloadTime=!1;if(nx.browser.name.toLowerCase()=="msie"&&nx.browser.versionNumber==7)u="feedload-home|ie7";else if(nx.browser.name.toLowerCase()=="msie"&&nx.browser.versionNumber==8)u="feedload-home|ie8";else if(nx.browser.name.toLowerCase()=="chrome")u="feedload-home|chrome";else{if(nx.browser.name.toLowerCase()!="mozilla")return;u="feedload-home|firefox"}nx.stats.ps.add(u,new Date-nx.data.feed.loadTime)}},handlePhoto:function(e){var n=t("#"+e).find(".cursor-all img").not(".photo-content-1 img");tools.imgRelocation(e,n)},handleLike:function(e,n){if(e.likeCount>0)if(e.ownerLike){var r,i,s,o;if(n.find("img[data-uid="+nx.user.id+"]").length>0)return;var u=this.likeAvatar();if(n.find("a").length>0){i=n.find(".list-like-tip");var a="我和"+i.text();t(u).insertBefore(n.find("a:first")),n.find("a").length>4&&n.find("a:last").addClass("hidden-avatar").hide(),s=n.find(".list-like-tip .like-name"),o="";for(r=0;r<s.length;r++)o+=s.get(r).outerHTML;i.html('<i class="list-like-tip-arr"></i>我和'+o+'等<span class="tip-counts">'+e.likeCount+"</span>人赞过此内容")}else i=n.find(".list-like-tip"),t(u+'<div class="list-like-tip"><i class="list-like-tip-arr"></i>我赞过此内容</div>').appendTo(n)}else{i=n.find(".list-like-tip"),n.find(".hidden-avatar").removeClass("hidden-avatar").show(),n.find("a img[data-uid="+nx.user.id+"]").parent("a").remove(),s=n.find(".list-like-tip .like-name"),o="";for(r=0;r<s.length;r++)o+=s.get(r).outerHTML;i.html('<i class="list-like-tip-arr"></i>'+o+'等<span class="tip-counts">'+e.likeCount+"</span>人赞过此内容")}else n.html("")},likeAvatar:function(){var e=["<a>",'<img src="'+nx.user.tinyPic+'" title="'+nx.user.name+'" data-uid="'+nx.user.id+'">',"</a>"].join("");return e},likeTips:function(e,t,n){var r=['<div class="list-like-tip">','   <i class="list-like-tip-arr"></i>'+e+t+"等"+n+"人赞过此内容","</div>"].join("");return r},likeOperation:function(e){var t=this,n=e.parent().find(".like-friend-list");e.renrenlike({onadd:function(r,i){e.html("<i></i>"+i.likeCount),e.attr("title","取消赞"),t.handleLike(i,n),t.fixLikeListWidth(n.find("a").length,n)},onremove:function(r,i){i.likeCount!=0?e.html("<i></i>"+i.likeCount):e.html("<i></i>"),e.attr("title","赞"),t.fixLikeListWidth(n.find("a").length,n),t.handleLike(i,n)}})},fixLikeListWidth:function(e,t){e>4?t.css("width",140):t.css("width",e*35)},bindEvent:function(){var e=this;this.bdContent.on("click",".show-all",function(){t(this).parent(".status").html(t(this).next().html())}),this.bdContent.on("mouseover",".vocal-reply",function(){if(this.playerInited)return;this.playerInited=!0;var e=t(this).data("vocal");t.renren.vocalPlayer(e,t(this))}),this.bdContent.on("mouseover",".status-vocal-player",function(){if(this.playerInited)return;this.playerInited=!0;var e=t(this).data("vocal");t.renren.vocalPlayer(e,t(this))}),this.bdContent.on("click",".share",function(){var e={};return e=t.extend(e,t(this).data().share),t(this).renrenshare(e),!1}),this.bdContent.on("mouseover",".like",function(){e.likeOperation(t(this))}),this.bdContent.on("mouseenter",".like-friend-list",function(){e.fixLikeListWidth(t(this).find("a").length,t(this))}),t(document).on("keyup",function(n){if(e.isCloseKeyOp)return;if(n.target==t("body").get(0)){var r,i,s;if(n.keyCode===75){r=e.feedList.find(".a-feed");for(i=r.length-1;i>=0;i--){if(i===0){t(document).scrollTop(0);break}s=r.eq(i).offset().top;if(s-50<t(document).scrollTop()){t(document).scrollTop(s-60);break}}}else if(n.keyCode===74){r=e.feedList.find(".a-feed");for(i=0;i<r.length;i++){s=r.eq(i).offset().top;if(s-70>t(document).scrollTop()){t(document).scrollTop(s-60);break}}}}}),this.bdContent.on("click",".similar-title",function(e){e.preventDefault(),t(this).prev().hide(),t(this).hide(),new r.SimilarFeed({feedId:t(this).parents(".a-feed").attr("id"),moreData:t.parseJSON(t(this).attr("data-similar-feeds"))})}),this.bdContent.on("click",".more-similar-feeds a",function(){new r.SameActorFeed({otherIds:t(this).attr("data-similar-feeds"),defaultId:t(this).parents(".a-feed").attr("id")}),t(this).parents(".more-similar-feeds").remove()}),this.bdContent.on("mouseenter",".feed-icon-iphone,.feed-icon-android",function(){t(this).attr("data-title",t(this).attr("title")),t(this).attr("title","");var e=['<div class="feed-icon-tips">',"	来自人人"+t(this).attr("data-title"),"	<i></i>","</div>"].join("");t(e).appendTo(t(this))}).on("mouseleave",".feed-icon-iphone,.feed-icon-android",function(){t(this).find(".feed-icon-tips").remove(),t(this).attr("title",t(this).attr("data-title"))}),t(nx.data.feed).on("openViewer",function(){e.isCloseKeyOp=!0}),t(nx.data.feed).on("closeViewer",function(){e.isCloseKeyOp=!1}),t(nx.data.feed).on("feedRecieved",function(n,r){t("#feed-loading-tips").hide(),e.render(r)})},init:function(){this.bindEvent()}};return i}),define("newsfeed/tools",function(require,e){var t=jQuery.noConflict(),n=function(e,r){var i=t("#"+e);i.on("lazyload:load","img",function(){n.prototype.setImg(t(this))});for(var s=0;s<r.length;s++)r.eq(s).get(0).complete?n.prototype.setImg(r.eq(s)):r.eq(s).load(function(){n.prototype.setImg(r.eq(s))})};n.prototype={setImg:function(e){var t=e.width(),n=e.height(),r=e.parent("a").width(),i=e.parent("a").height();e.width()===0&&(t=e.width,n=e.height)}};var r=function(e,t,n,i,s){e.get(0).complete?(r.prototype.setImg(e,t,n,i,s),e.css("display","block"),i.show()):e.load(function(){r.prototype.setImg(e,t,n,i,s),e.css("display","block"),i.show()})};r.prototype={setImg:function(e,t,n,r,i){var s=e.width(),o=e.height();s>=200&&o>=100?(t.css({width:s-20+"px"}),n.css({left:s-300+190+"px"})):(s<200||o<100)&&t.css({width:"280px",position:"relative","margin-right":"150px","float":"left"}),i==="103"?r.css({left:(s-84)/2+"px",top:(o-42)/2+e.parents(".share-content").find(".source-desc").height()+18+"px"}):r.css({left:(s-84)/2+"px",top:(o-42)/2+"px"}),e.parent("a").hasClass("location-left")||t.css({left:"0"})}};var i=function(e){var t=e.get(0);t.complete&&t.width?(t.width>150&&t.height>150&&(t.width>t.height?(e.height(150*t.height/t.width),e.width(150)):t.width<t.height?(e.width(150*t.width/t.height),e.height(150)):(e.width(150),e.height(150))),t.height<150&&e.css("margin-top",(150-t.height)/2+"px")):e.load(function(){e.width()>150&&e.height()>150&&(e.width()>e.height()?(e.height(150*e.height()/e.width()),e.width(150)):e.width()<e.height()?(e.width(150*e.width()/e.height()),e.height(150)):(e.width(150),e.height(150))),e.height()<150&&e.css("margin-top",(150-e.height())/2+"px")})},s=function(e){e.complete?s.prototype.resizeImg(e):t(e).load(function(){s.prototype.resizeImg(e)})};s.prototype={resizeImg:function(e){var n=e.width,r=e.height,i=t(e).parent("a").width(),s=t(e).parent("a").height();t(e).css({"margin-top":(s-r)/2+"px","margin-left":(i-n)/2+"px"})}};var o=function(e){var n=parseInt(e);if(n===1||n===2){t(".get-more-feed").remove();if(t(".newsfeed-empty").length>0)return}if(t("#return-all-tips").length>0&&n===4)return;var r={1:{className:"get-more-feed",appendTo:"#feed-list",text:"显示更多新鲜事"},2:{className:"none-feed",appendTo:"#feed-list",text:"<span class='tips-split tips-split-left'></span><span class='none-feed-span'>没有更多新鲜事了，<a href='http://share.renren.com/share/hot/v7'>去分享频道</a>看看更多精彩内容</span><span class='tips-split tips-split-right'></span>"},3:{className:"none-feed",appendTo:"#feed-list",text:"没有关注新鲜事了，<a href='http://follow.renren.com/recommend/v7'>发现更多感兴趣的人</a>"},4:{className:"read-all-feed",appendTo:"#feed-list",text:"全部标记为已读"}};if(n!==4)t(".get-more-feed-con").length>0&&t(".get-more-feed-con").remove(),t("."+r[n].className).length>0&&t("."+r[n].className).remove();else{t(".read-all-feed").length>0&&t(".read-all-feed").remove();if(!t(".a-feed").length)return}var i=(t(".double-cols").hasClass("checked")>0||nx.data.isDoubleFeed)&&t(window).width()>=1260;i&&(r[1].appendTo=".bd-content",r[2].appendTo=".bd-content",r[3].appendTo=".bd-content",r[4].appendTo=".bd-content");var s=t("<a></a>");if(n===2||n===3)s=t("<p></p>"),t(".read-all-feed").length>0&&t(".read-all-feed").remove();n===1&&i&&(s=t('<div class="clearfix"></div>'),r[1].className="get-more-feed-con",r[1].text='<span class="tips-split tips-split-left"></span><a class="get-more-feed" href="javascript:;">显示更多新鲜事</a><span class="tips-split tips-split-right"></span>'),t(s).addClass(r[n].className).appendTo(r[n].appendTo).attr("href","#nogo").html(r[n].text)},u=function(e){var t,n;e.focus(),document.createRange?(t=document.createRange(),t.selectNodeContents(e),t.collapse(!1),n=window.getSelection(),n.removeAllRanges(),n.addRange(t)):document.selection&&(t=document.body.createTextRange(),t.moveToElementText(e),t.collapse(!1),t.select())},a=function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},f=function(e){var n=t("#feed-list"),r=n.find(".a-feed");for(var i=0;i<r.length;i++)if(t(r[i]).position().top+35>t(document).scrollTop()){var s=i===0?0:i-1,o=n.find(".a-feed:eq("+s+")"),u;if((t(document).scrollTop()-o.position().top)/o.height()>.5)switch(e){case"like":u=o.next().find(".like");break;case"share":u=o.next().find(".share");break;case"reply":u=o.next().find(".reply-input");break;case"continue":u=o.next()}else switch(e){case"like":u=o.find(".like");break;case"share":u=o.find(".share");break;case"reply":u=o.find(".reply-input");break;case"continue":u=o}return u}},l=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\?&]"+e+"=([^&#]*)",r=new RegExp(n),i=r.exec(t);return i?decodeURIComponent(i[1].replace(/\+/g," ")):""},c=function(e){var t=e.match(/@[^@\s\)]+\)/g),n=[],r="";if(t){var i="";for(var s=0;s<t.length;s++)t[s].match(/\((\d+)\)/)?i=t[s].match(/\((\d+)\)/)[1]:i="",n.push(i);r=n.join("_")}return r};e.getAtlog=c,e.queryByName=l,e.fixDom=f,e.unescapeHTML=a,e.setEndOfContenteditable=u,e.btnFactory=o,e.imgRelocation=n,e.vocalResize=r,e.linkResize=i,e.recommandResize=s}),define("newsfeed/reply",function(require,e){var t=jQuery.noConflict();require("ui/Reply"),require("ui/scrollbar");var n={getAllComments:function(e,n,r,i,s){t.ajax({url:e,type:r,dataType:"text",data:n,success:function(e){t.parseJSON(e).code=="0"?i.call(s,t.parseJSON(e)):console.log(t.parseJSON(e).msg)}})}},r=function(e,n,r){var i=this;this.feedId=e,this.article=t("#"+e),this.replyBtn=this.article.find(".reply"),this.replyInfo=n,this.replyListContainer=this.article.find(".feed-reply-container"),this.getAllCommentFlag=!1,this.replyList=this.article.find(".feed-replies"),this.packAllReBtn="<div class='pack-replies clearfix'><span>收起评论</span><i></i></div>",this.showAllReBtn=this.article.find(".more-replies"),this.feedType=parseInt(r),this.initAvatar(),this.article.find(".feed-reply-container").length>0?this.replyUI=new jQuery.ui.Reply({replyData:n,defaultTextarea:!1,replyAdded:function(){i.insertComment()}},t("#"+e)):this.bindNoReplyEvent(),this.bindEvents()};r.prototype={destroy:function(){this.replyUI&&(this.replyUI.destroy(),this.replyUI=null)},bindEvents:function(){var e=this;this.article.on("click",".more-replies span,.more-replies i",function(n){nx.data.matter&&t(this).parent(".more-replies").children("span").html()=="更多评论"?t(this).parent(".more-replies").hide():/\d+/.exec(t(this).html())&&parseInt(/\d+/.exec(t(this).html())[0])<2?t(this).parent(".more-replies").remove():t(this).parent(".more-replies").removeClass("more-replies").addClass("pack-replies clearfix").find("span").html("收起评论"),e.getAllCommentFlag==0&&(e.insertAllComment(!1),e.getAllCommentFlag=!0)}),this.article.on("click",".pack-replies span,.pack-replies i",function(){var n=this;e.getAllCommentFlag=!1;if(e.isPageOrZhan()===!0)t(this).parent(".pack-replies").hide(),e.article.find(".a-reply").remove
(),e.article.find(".feed-reply-container").remove(),e.article.find(".own-reply").remove(),e.destroyScrollBar(),setTimeout(function(){t(n).parent(".pack-replies").remove()},200);else{var r=e.article.find(".a-reply").length;r<3?t(this).parent(".pack-replies").remove():t(this).parent(".pack-replies").removeClass("pack-replies").addClass("more-replies").find("span").html("还有"+(r-2)+"条评论"),e.insertShowBtn(),e.destroyScrollBar()}})},bindNoReplyEvent:function(){var e=this,n=!1;this.replyBtn.on("click",function(){e.getAllCommentFlag==0?(t("<div class='feed-reply-container'><div class='feed-replies'></div></div>").appendTo(e.article),e.replyList=e.article.find(".feed-replies"),e.replyListContainer=e.article.find(".feed-reply-container"),e.replyUI=new jQuery.ui.Reply({replyData:e.replyInfo,defaultTextarea:!0,replyAdded:function(){e.insertComment()}},t("#"+e.feedId)),e.getAllCommentFlag==0&&(e.insertAllComment(!1),e.getAllCommentFlag=!0)):(e.getAllCommentFlag=!1,e.article.find(".pack-replies").remove(),e.article.find(".a-reply").remove(),e.article.find(".feed-reply-container").remove(),e.article.find(".own-reply").remove(),e.destroyScrollBar())})},insertComment:function(){if(this.article.find(".a-reply").length>6||this.article.find(".more-replies").length>0)this.getAllCommentFlag==0?(this.insertAllComment(!0),this.getAllCommentFlag=!0):(this.insertPackBtn(),this.destroyScrollBar(),this.addScrollBar(!0))},destroyScrollBar:function(){this.replyListContainer.css({height:"auto",overflow:"hidden"}),this.replyListContainer.scrollbar({destroy:"destroy"}),this.replyListContainer.find(".ui-scrollbar-bar").css("height","auto")},insertAllComment:function(e){var r=this,i=this.buildParams();n.getAllComments(this.replyInfo.loadURI,i,this.sendMethod,function(n){var i="",s=0;if(n.comments!=undefined){for(var o=0;o<n.commentCount;o++)n.comments[o].isWhisper===!1&&(i+=r.replyUI.singleReplyHTML(n.comments[o],!0),s++);nx.data.matter!==undefined?s>=3?r.article.find(".more-replies").show().removeClass("more-replies").addClass("pack-replies clearfix").find("span").html("收起评论"):r.article.find(".more-replies").remove():s>=3&&r.article.find(".more-replies").show().removeClass("more-replies").addClass("pack-replies clearfix").find("span").html("收起评论"),r.replyList.find(".a-reply").remove(),t(i).appendTo(r.replyList)}else{for(var u=0;u<n.replyList.length;u++)i+=r.singleReplyHTML(n.replyList[u],"page");r.replyList.html(""),t(i).appendTo(r.replyList),r.article.find(".a-reply").length>5&&r.insertPackBtn()}r.addScrollBar(e)})},buildParams:function(){var e="";return this.replyInfo.cSection==="true"||this.replyInfo.type==="edm"?(e="type="+this.replyInfo.type+"&entryId="+this.replyInfo.cid+"&entryOwnerId="+this.replyInfo.oid,this.sendMethod="get"):nx.data.matter!=undefined&&nx.data.matter.isFriendComment==="true"&&this.feedType!=502&&this.feedType!=505&&this.feedType!=107?this.loadURI="http://comment.renren.com/comment/xoa2/friends":(e="doingId="+this.replyInfo.cid+"&owner="+this.replyInfo.oid+"&source="+this.replyInfo.cid+"&t="+this.replyInfo.typeNum,this.replyInfo.type=="zhan"?this.sendMethod="get":this.sendMethod="post"),e},addScrollBar:function(e){this.isPageOrZhan()===!0?this.replyList.height()>=400&&(this.replyListContainer.addClass("shadow-inset"),this.replyListContainer.css({height:"400px",overflow:"hidden"}),this.replyListContainer.scrollbar({minScrollbarLength:1,wheelSpeed:20,stopBubble:!0}),e&&(this.replyListContainer.scrollTop(this.replyList.height()-400),this.replyListContainer.scrollbar({update:"update"}))):this.replyListContainer.find(".a-reply").length>20&&(this.replyListContainer.addClass("shadow-inset"),this.replyListContainer.css({height:"400px",overflow:"hidden"}),this.replyListContainer.scrollbar({minScrollbarLength:1,wheelSpeed:20,stopBubble:!0}),e&&(this.replyListContainer.scrollTop(this.replyList.height()-400),this.replyListContainer.scrollbar({update:"update"})))},insertShowBtn:function(){var e=this.article.find(".a-reply").length;this.article.find(".a-reply").not(".a-reply:eq(0)").not(".a-reply:last").remove()},insertPackBtn:function(){this.getAllCommentFlag=!0,this.article.find(".more-replies").length>0&&this.article.find(".more-replies").remove(),this.article.find(".pack-replies").length==0&&t(this.packAllReBtn).prependTo(this.article.find(".feed-replies"))},showAllBtn:function(e){var t="<div class='more-replies'><span>还有"+e+"条评论</span><i></i></div>";return t},isPageOrZhan:function(){return this.replyInfo.isUserFeed=="0"?!0:!1},initAvatar:function(){var e=this.article.find(".own-reply .avatar");e.attr({namecard:nx.user.id,href:"http://www.renren.com/profile.do?id="+nx.user.id,target:"_blank"}).children("img").attr("src",nx.user.tinyPic)},singleReplyHTML:function(e,t){var n=this,r="";e.replyerName&&(e.ubname=e.replyerName,e.ubid=e.replyerId,e.replyer_tinyurl=e.replyerHead),this.replyInfo.oid==nx.user.id?e.ubid==nx.user.id?r='<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">删除</a>':r='<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">删除</a>'+'<a href="#nogo" class="to-reply" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">回复</a>':e.ubid==nx.user.id?r='<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">删除</a>':r='<a href="#nogo" class="to-reply" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">回复</a>';var i;e.vocal_url?i=['<a href="javascript:;" data-vocal=\'{"voiceId":'+parseInt(e.id)+',"url": "'+e.vocal_url+'", "time":'+e.vocal_length+', "ownerId":'+e.ownerId+', "count":0}\' class="vocal-player  vocal-reply ">','<span class="count">0</span>','<span class="time">'+e.vocal_length+'"</span>','<span class="icon"></span>','<span class="bg-progress">','<span class="count">0</span>','<span class="time">'+e.vocal_length+'"</span>','<span class="icon"></span>',"</span>","</a>"].join(""):i='<span class = "text">'+e.replyContent+"</span>";var s=['<div class = "a-reply clearfix">','	<a href="http://www.renren.com/'+e.ubid+'/profile" class = "avatar" target="_blank" namecard="'+e.ubid+'">','		<img src="'+e.replyer_tinyurl+'" class="user-avatar">',"	</a>",'	<div class = "reply-content">','		<p class="reply-info clearfix">','		<a href="http://www.renren.com/'+e.ubid+'/profile" class = "user-name" target="_blank" namecard="'+e.ubid+'">'+e.ubname+"</a>",'		<span class="reply-time">'+e.replyTime+"</span>",'		<span class="reply-tool clearfix">'+r,"		</span>","		</p>"+i,"	</div>","</div>"].join("");return s}},e.FeedReply=r}),define("ui/Reply",function(require,e){var t=require("jquery"),n=require("mustache.js"),r=require("newsfeed/tools");require("ui/renren/textbox"),require("ui/scrollbar"),require("ui/renren/replyOption");var i=['<div class="own-reply clearfix">','    <a class="avatar">','        <img src="'+nx.user.tinyPic+'">',"    </a>",'    <div class="own-reply-content">','        <div class="input-container">','            <div contenteditable="true" class="reply-input"></div>','            <div class="tool-bar clearfix">','                <a class="emotion" href="#nogo">表情</a>',"                <p>",'                    <span class="rest-count">0</span>',"                    /","                    <span>{{maxCount}}</span>",'                    <span class="tips-text">Ctrl+Enter发送</span>',"                </p>","            </div>","        </div>",'        <div class="reply-btns clearfix">','            <a href="#nogo" class="add-comment">发布评论</a>','            <a href="#nogo" class="cancel-comment">取消</a>',"        </div>","    </div>","</div>"].join(""),s={deleteComment:function(e,n,r,i){t.ajax({url:e,type:"post",dataType:"text",data:n,context:i,success:r})},addComment:function(e,n,r,i){t.ajax({url:e,type:"post",dataType:"json",data:n,success:function(e){e.code==0?r.call(i,e):require(["ui/dialog"],function(){t.dialog.error(e.msg)})}})}};t.widget("ui.Reply",{options:{replyData:null,defaultTextarea:!0,replyAdded:t.noop},_create:function(){this.replyListContainer=this.element.find(".feed-reply-container"),this.replyList=this.replyListContainer.find(".feed-replies"),this.replyData=this.options.replyData,this.feedId=this.element.attr("id"),this.feedType=parseInt(this.element.find(".user-avatar").attr("data-stype")),this.feedType==502||this.feedType==505?this.maxCount=240:this.maxCount=140,this.options.defaultTextarea&&this.createTextarea(),this.initTextarea(),this.hasShowAllRe=!1,this.enableFlag=!1,this.copyFlag=!1,this.replyToName="",this.replyToId="",this.replyId="",this.text="",this._events(),t.ui.Reply.instances+=1},_destroy:function(){t.ui.Reply.instances-=1,t.ui.Reply.instances===0&&t(document).off("."+this.widgetEventPrefix)},createTextarea:function(){t(n.render(i,{maxCount:this.maxCount})).insertAfter(this.replyListContainer)},initTextarea:function(){this.inputContainer=this.element.find(".input-container"),this.replyTextarea=this.element.find(".reply-input"),this.textCount=this.element.find(".rest-count"),this.toolBar=this.element.find(".tool-bar"),this.subBtn=this.element.find(".add-comment"),this.cancelBtn=this.element.find(".cancel-comment"),this.replyOptionBtn=this.element.find(".tips-text"),this.subBtn.addClass("disabled"),this.replyTextarea.html("评论...")},_events:function(){this._on(this.replyTextarea,{textboxchange:"checkTextCount",focus:function(){this.activeCommentArea()},keydown:function(e){(nx.data.reply.isEnterSend||e.ctrlKey||e.metaKey)&&e.keyCode===13&&(this.sendComment(),e.preventDefault())}}),this._on(this.subBtn,{click:"sendComment"}),this._on(this.cancelBtn,{click:"deactiveCommentArea"}),this._on(this.replyList,{"click .to-reply":function(e){e.preventDefault(),e.stopImmediatePropagation();var n=t(e.target);this.replyToName=n.attr("data-uname"),this.replyToId=n.attr("data-uid"),this.replyId=n.attr("data-rid"),this.activeCommentArea(this.replyToName,this.replyToId,this.replyId)},"click .delete":function(e){e.preventDefault(),e.stopImmediatePropagation();var n=t(e.target),r=n.attr("data-rid"),i=n.attr("data-uid"),o=n.attr("data-uname"),u=this.buildDelParams(r,i);t.dialog.confirm("确定删除此评论吗？",function(){s.deleteComment(u.delURI,u.params,function(){var e=n.parents(".feed-reply-container"),t=n.parents(".feed-replies");n.parents(".a-reply").remove(),t.find(".pack-replies").length&&t.find(".a-reply").length<3&&t.find(".pack-replies").remove(),t.find(".more-replies").length&&t.find(".a-reply").length<=1&&t.find(".more-replies").find("span").click(),this.isPageOrZhan()===!0?t.height()>400?(e.scrollTop(t.height()-400),e.scrollbar({update:"update"})):(e.css("height","auto"),e.scrollbar({destroy:"destroy"})):t.find(".a-reply").length>20?(e.scrollTop(t.height()-400),e.scrollbar({update:"update"})):(e.css("height","auto"),e.scrollbar({destroy:"destroy"}))}.bind(this))}.bind(this))},click:function(e){var n=t(e.target),r=n.closest(".a-reply");n.closest("a",r).length===0&&r.find(".to-reply").trigger("click")},"mouseover .trigger-like-comment":function(e){var n=t(e.target);n.html()==="已赞"&&n.html("取消")},"mouseout .trigger-like-comment":function(e){var n=t(e.target);n.html()==="取消"&&n.html("已赞")},"mouseenter .a-reply":function(e){var n=t(e.target).closest(".a-reply");n.find(".trigger-like-comment").renrenlike({isComment:!0,elmComment:n,onadd:function(e,n){var r;e.element.addClass("liked"),e.element.text("已赞"),n.likeCount>0&&e.element.parents(".reply-info").find(".reply-like").length===0?(r=t("<a href='#nogo' class='reply-like'>"+n.likeCount+"</a>"),e.element.parents(".reply-info").find(".reply-time").length>0?r.insertAfter(e.element.parents(".reply-info").find(".reply-time")):r.insertAfter(e.element.parents(".reply-info").find(".time"))):(r=e.element.parents(".reply-info").find(".reply-like"),r.html(n.likeCount)),r.addClass("reply-liked")},onremove:function(e,t){var n=t.likeCount>0?t.likeCount:"";e.element.removeClass("liked"),e.element.text("赞"),t.likeCount===0?e.element.parents(".reply-info").find(".reply-like").remove():e.element.parents(".reply-info").find(".reply-like").removeClass("reply-liked").html(t.likeCount)}.bind(this)})}}),t.ui.Reply.instances===0&&t(document).on("click."+this.widgetEventPrefix+" focus."+this.widgetEventPrefix,function(e){t(".input-container.active-textarea").each(function(n,r){r=t(r);if(r.find(e.target).length===0){var i=r.closest(".a-feed").Reply("instance");i.text||i.deactiveCommentArea()}})})},activeCommentArea:function(e,t,n){this.inputContainer.hasClass("active-textarea")||(this.inputContainer.addClass("active-textarea"),this.replyTextarea.apptextbox(),this.toolBar.children("a").remove().end().prepend(this.replyTextarea.apptextbox("getButtonPane")),this.toolBar.show(),this.subBtn.show(),this.cancelBtn.show(),nx.data.reply=nx.data.reply||{},this.replyOptionBtn.renrenreplyOption()),arguments.length===3&&(this.replyToName=e,this.replyToId=t,this.replyId=n);if(e){var r=this.replyTextarea.apptextbox("getContents");r.indexOf(this.replyUser)==0&&(r=r.replace(this.replyUser,"")),this.replyUser="回复"+this.replyToName+"：",this.replyTextarea.apptextbox("setContents",""),this.replyTextarea.apptextbox("insertAtCaret",this.replyUser+r)}this.checkTextCount()},deactiveCommentArea:function(){this.replyTextarea.data("app-textbox")&&this.replyTextarea.apptextbox("destroy"),this.replyTextarea.prop("contenteditable",!0),this.inputContainer.removeClass("active-textarea"),this.subBtn.hide(),this.cancelBtn.hide(),this.toolBar.hide(),this.textCount.html(0),this.replyTextarea.blur();if(nx.browser.webkit){var e=t("#feed-reply-focus");e.length==0&&(e=t('<input id="feed-reply-focus" style="width:1px;height:1px;border:none;margin:0;padding:0;" tabIndex="-1">').appendTo(t(".nx-content"))),e[0].setSelectionRange(0,0),e.blur()}},checkTextCount:function(){this.text=this.replyTextarea.apptextbox("getRawContents");var e=this.text.length;this.textCount.html(e),e>this.maxCount?(this.subBtn.addClass("disabled"),this.enableFlag=!1,this.toolBar.find("p").addClass("error-c")):e==0?(this.subBtn.addClass("disabled"),this.enableFlag=!1,this.toolBar.find("p").removeClass("error-c")):(this.subBtn.removeClass("disabled"),this.enableFlag=!0,this.toolBar.find("p").removeClass("error-c"))},getComment:function(){var e=this.text;if(e.length===0){require(["ui/dialog"],function(){t.dialog.error("输入不能为空")});return}e.indexOf("回复"+this.replyToName+"：")===-1&&(this.replyToName="",this.replyToId="",this.replyId="");if(this.enableFlag){var n={ownerId:nx.user.id,replyer_tinyurl:nx.user.tinyPic,ubname:nx.user.name,replyContent:encodeURIComponent(e),replyToId:this.replyToId,replyTime:(new Date).toLocaleString(),like:{liked:!1,count:0}};return this.deactiveCommentArea(),n}},sendComment:function(){var e=this.getComment();if(!e)return;var n=this.buildParams(e);s.addComment(this.replyData.sendURI,n,function(n){var i;this.replyData.cSection==="true"||this.replyData.type==="edm"?i=this.singleReplyHTML(n.comment,!0):i=this.singleReplyHTML(n,!1),t(i).appendTo(this.replyList),t(nx.data.feed).trigger("replyAdded",{stype:this.feedType,atlog:r.getAtlog(decodeURIComponent(e.replyContent)),feedId:this.feedId,replyTo:this.replyToId}),this.options.replyAdded()},this)},buildParams:function(e){var t="";if(this.replyData.cSection==="true"||this.replyData.type==="edm")t="content="+e.replyContent+"&type="+this.replyData.type+"&entryId="+this.replyData.cid+"&entryOwnerId="+this.replyData.oid+"&stype="+this.replyData.stype+"&sourceId="+this.replyData.cid,this.feedType==709&&(t+="&isLinked=true");else{if(this.replyData.type==="zhan")return t="content="+e.replyContent+"&type=nf&toId="+e.replyToId,t;t="c="+e.replyContent+"&owner="+this.replyData.oid+"&source="+this.replyData.cid+"&t="+this.replyData.typeNum}return e.replyToId!==""?t+="&rpLayer=1&replyTo="+e.replyToId+"&toCommentId="+this.replyId:t+="&rpLayer=0",t},buildDelParams:function(e,t){var n={};return this.replyData.cSection==="true"||this.replyData.type==="edm"?(n.params="type="+this.replyData.type+"&entryId="+this.replyData.cid+"&entryOwnerId="+this.replyData.oid+"&stype="+this.replyData.stype+"&sourceId="+this.replyData.cid,n.delURI=this.replyData.delURI.replace("commentId",e)):(this.replyData.type==="zhan"?n.delURI=this.replyData.delURI.replace("{{commentId}}",e):n.delURI=this.replyData.delURI,n.params="createId="+t+"&doingId="+this.replyData.cid+"&owner="+this.replyData.oid+"&replyId="+e+"&source="+this.replyData.cid+"&t="+this.replyData.typeNum),n},isPageOrZhan:function(){return this.replyData.isUserFeed=="0"?!0:!1},singleReplyHTML:function(e,t){var n="";t||(e.commentId=e.id,e.authorName=e.replyerName,e.authorId=e.replyerId,e.content=e.replyContent,e.authorHeadUrl=e.replyerHead,e.time=e.replyTime,e.vocal_url&&(e.authorId=e.ownerId)),this.replyData.oid==nx.user.id?e.authorId==nx.user.id?n='<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">删除</a>':n='<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">删除</a>'+'<a href="#nogo" class="to-reply" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">回复</a>':e.authorId==nx.user.id?n='<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">删除</a>':n='<a href="#nogo" class="to-reply" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">回复</a>';var r;e.vocal_url?r=['<a href="javascript:;" data-vocal=\'{"voiceId":'+parseInt(e.id)+',"url": "'+e.vocal_url+'", "time":'+e.vocal_length+', "ownerId":'+e.authorId+', "count":0}\' class="vocal-player  vocal-reply ">','    <span class="count">0</span>','    <span class="time">'+e.vocal_length+'"</span>','    <span class="icon"></span>','    <span class="bg-progress">','        <span class="count">0</span>','        <span class="time">'+e.vocal_length+'"</span>','        <span class="icon"></span>',"    </span>","</a>"].join(""):r='<span class = "text">'+e.content+"</span>";var i;if(this.replyData.type)switch(this.replyData.type){case"status":i="http://status.renren.com/getdoing.do?id="+this.replyData.oid+"&doingId="+this.replyData.cid;break;case"share":i="http://share.renren.com/share/"+this.replyData.oid+"/"+this.replyData.cid;break;case"blog":i="http://blog.renren.com/blog/"+this.replyData.oid+"/"+this.replyData.cid;break;case"photo":i="http://photo.renren.com/photo/"+this.replyData.oid+"/photo-"+this.replyData.cid;break;case"album":i="http://photo.renren.com/photo/"+this.replyData.oid+"/album-"+this.replyData.cid}var s="",o="";e.like!==undefined&&(e.like.liked?(s='<a href="#nogo" class="trigger-like-comment liked" data-like=\'{"stype":"'+this.replyData.type+'","sourceId":"'+e.commentId+'","resource":"'+this.replyData.cid+'","owner":"'+e.authorId+'","resourceownerid":"'+this.replyData.oid+'","url":"'+i+'","liked":'+e.like.liked+"}'>已赞</a>",o='<span class="reply-like reply-liked" >'+e.like.count+"</span>"):e.like.count==0?s='<a href="#nogo" class="trigger-like-comment" data-like=\'{"stype":"'+this.replyData.type+'","sourceId":"'+e.commentId+'","resource":"'+this.replyData.cid+'","owner":"'+e.authorId+'","resourceownerid":"'+this.replyData.oid+'","url":"'+i+'","liked":'+e.like.liked+"}'>赞</a>":(s='<a href="#nogo" class="trigger-like-comment" data-like=\'{"stype":"'+this.replyData.type+'","sourceId":"'+e.commentId+'","resource":"'+this.replyData.cid+'","owner":"'+e.authorId+'","resourceownerid":"'+this.replyData.oid+'","url":"'+i+'","liked":'+e.like.liked+"}'>赞</a>",o='<span class="reply-like" >'+e.like.count+"</span>"));var u=['<div class = "a-reply clearfix">','    <a href="http://www.renren.com/'+e.authorId+'/profile" class = "avatar" target="_blank" namecard="'+e.authorId+'">','        <img src="'+e.authorHeadUrl+'" class="user-avatar">',"    </a>",'    <div class = "reply-content">','        <p class="reply-info clearfix">','        <a href="http://www.renren.com/'+e.authorId+'/profile" class = "user-name" target="_blank" namecard="'+e.authorId+'">'+e.authorName+"</a>",'        <span class="reply-time">'+e.time+"</span>"+o,'        <span class="reply-tool clearfix">'+n+s,"        </span>","        </p>"+r,"    </div>","</div>"].join("");return u}}),t.ui.Reply.instances=0}),define("newsfeed/toolbar",function(require,e){require("ui/tooltip"),require("ui/feedSetting");var t=jQuery.noConflict(),n={setFocus:function(e,n,r,i){t.ajax({url:"http://www.renren.com/relationFeedOper.do?action="+e,type:"post",data:"id="+n,dataType:"text",success:function(n){t.parseJSON(n).code===0?r.call(i):t.parseJSON(n).code===3?e==="addHigh"?t.dialog.success("该用户已经添加至特别关注名单中"):t.dialog.success("该用户已经添加至屏蔽名单中"):t.parseJSON(n).code===2?t.dialog.error("特别关注已经达到20个好友上限"):t.parseJSON(n).code===4&&t.dialog.error("请先加好友")}})},readNews:function(e,n,r){t.ajax({url:"http://www.renren.com/readNews.do",type:"post",dataType:"text",data:"t=s&i="+e,success:function(){n.call(r)}})},removeFeed:function(e,n,r,i){t.ajax({url:"http://www.renren.com/removefeed.do",type:"post",dataType:"text",data:"uid="+nx.user.id+"&feedid="+e+"&actor="+n,success:function(e){r.call(i)},error:function(e){throw new Error("删除失败！")}})}},r=function(e){this.feedList=t("#feed-list"),this.initialize(e)};r.prototype={initialize:function(e){this.initParam(e),this.bindEvent(e)},initParam:function(e){var n=this.article=t("#"+e);this.clsFeedBtn=n.find(".feed-hide"),this.clsFeedBtn.attr("title","标记为已读"),this.clsFeedBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(n.vertical).addClass(n.horizontal).appendTo(this)}}}),this.feedMenu=n.find(".feed-menu"),this.feedMenu.length>0&&(this.ownerId=n.find(".feed-user-name").attr("namecard")||n.find(".user-avatar").attr("data-id"),this.bindMenuEvent(e)),this.feedTool=n.find(".feed-tool"),this.feedTool.length>0&&this.bindToolEvent()},double_cols:function(){t(".double-cols-feed").length&&setTimeout(function(){var e=t("#feed-list").height(),n=t("#feed-list-right").height(),r;while(e>n){r=t("#feed-list").children().last();if(!(r.height()+20<e-n))break;t("#feed-list-right").append(r),e=t("#feed-list").height(),n=t("#feed-list-right").height()}while(e<n){r=t("#feed-list-right").children().last();if(!(r.height()+20<n-e))break;t("#feed-list").append(r),e=t("#feed-list").height(),n=t("#feed-list-right").height()}},100)},bindToolEvent:function(){var e=this;this.feedTool.on("mouseenter",function(){e.feedMenu.show()}),this.feedTool.on("mouseleave",function(){e.feedMenu.hide()})},bindMenuEvent:function(e){var r=this;this.feedMenu.on("mouseenter",function(){r.feedMenu.show()}),this.feedMenu.on("mouseleave",function(){r.feedMenu.hide()}),this.feedMenu.on("click",".feed-focus-user",function(){n.setFocus("addHigh",r.ownerId,function(){require(["ui/dialog"],function(){t.dialog.success("成功添加")})})}),this.feedMenu.on("click",".feed-block-user",function(){var e=t.dialog.confirm("确定要屏蔽该用户的新鲜事么？",function(){n.setFocus("addLow",r.ownerId,function(){t.dialog.success("成功屏蔽")})},function(){})}),this.feedMenu.on("click",".feed-setting-item",function(){new jQuery.ui.feedSetting}),this.feedMenu.on("click",".hide-feed",function(){console.log(r.ownerId),n.removeFeed(e,r.ownerId,function(){r.article.remove(),r.double_cols()})})},bindEvent:function(e){var r=this;this.clsFeedBtn.click(function(){n.readNews(e,function(){r.article.hasClass("similar-feed")?r.article.prev().remove():r.article.next().hasClass("similar-feed-link")&&(r.article.next().remove(),r.article.next().removeClass("similar-feed").find(".header").removeClass("hidden")),r.article.remove(),r.double_cols(),t(document).trigger("scroll"),r.feedList.find(".a-feed").length==0&&t(".get-more-feed").addClass("border-top")})})}},e.ToolBar=r}),define("newsfeed/groupFeed",["jquery","backbone","exports"],function(e,t,n){var r={getAllFeedCount:function(t,n,r){e.ajax({url:"http://www.renren.com/leftmenu/getAllFeedCount",type:"post",data:"group="+t,dataType:"text",success:function(t){n.call(r,e.parseJSON(t))}})},clearCount:function(t,n,r){e.ajax({url:"http://www.renren.com/leftmenu/clearFeedCount",type:"post",data:"groupId="+t,dataType:"text",success:function(){n.call(r)}})},getSpecificGInfo:function(t,n,r){e.ajax({url:t,type:"get",dataType:"text",success:function(e){n.call(r,e)}})}},i=function(){this.feedList=e("#feed-list"),this.rightMenu=e(".nx-right"),this.bannerMoreGroupCon=e(".nx-main .nf-group-list-container"),this.bannerMoreGroup=e(".nx-main .nf-group-list"),this.bannerGroup=e(".nx-main .fd-nav-list"),this.gidList=this.bannerGroup.find("a[data-gid]"),this.moreBtn=this.bannerGroup.find(".fd-nav-showmore a"),this.navGName=this.bannerGroup.find(".fd-nav-gName"),this.navGNameLabel=this.bannerGroup.find(".fd-nav-gName-label"),this.router=new t.Router,this.router.route("newsfeed/group/:groupId",this.filterByGroup.bind(this)),this.initFeedCount(),this.initGroupMenu(),this.events()};i.prototype={events:function(){var t=this;this.navGName.on("click",function(e){t.bannerMoreGroup.find("a[data-gid="+this.getAttribute("data-gid")+"]").trigger("click")}),this.bannerGroup.on("click",".nf-group-list a",function(n){e(document).scrollTop(0),n.stopPropagation(),n.preventDefault(),t.bannerGroup.find(".fd-nav-cur-item").removeClass("fd-nav-cur-item");var i=this;t.bannerGroup.find(".fd-nav-showmore").addClass("fd-nav-cur-item");var s=e(this).attr("data-gid");r.getSpecificGInfo(e(this).attr("href"),function(n){t.navGName.css("display","inline-block"),t.navGNameLabel.hide(),t.initRightMenu(),t.initFeedList(s),e(n).prependTo(t.rightMenu),t.changeLocation(e(i)),t.cleanCount(s)}),e(".read-all-feed").remove(),t.router.navigate("newsfeed/group/"+s)})},filterByGroup:function(e){this.bannerGroup.find('a[data-gid="'+e+'"]').trigger("click")},initRightMenu:function(){e("#friends-filter").length>0&&e("#friends-filter").remove(),e("#recommendFriBox").show(),e(".ui-renren-publisher").show(),e("#mergeModule").hide(),e(".nx-right .photopast").hide(),e("#focus-filter").hide(),e("#follow_right").hide(),e("#footprintArea").hide(),e("#toolRefreshFeed").hide().attr("data-isShow","false"),e("#special-focus").remove()},initFeedList:function(t){this.feedList.children().not(".new-feed-tip").remove(),e(nx.data.feed).trigger("friendsNewsFeed",t)},initScrollBar:function(){},cleanCount:function(e){var t=this;r.clearCount(e,function(){t.bannerGroup.find("a[data-gid="+e+"]").children(".fd-nav-num").text("")})},initFeedCount:function(){var t=this,n=[];for(var i=0;i<this.gidList.length;i++)n.push(e(this.gidList[i]).attr("data-gid"));r.getAllFeedCount(n.toString(),function(e){for(var n=0;n<e.length;n++)parseInt(e[n].count)>20?t.bannerGroup.find("a[data-gid="+e[n].groupId+"]").children(".fd-nav-num").text("20+"):parseInt(e[n].count)<=0?t.bannerGroup.find("a[data-gid="+e[n].groupId+"]").children(".fd-nav-num").text(""):t.bannerGroup.find("a[data-gid="+e[n].groupId+"]").children(".fd-nav-num").text(e[n].count)})},changeLocation:function(e){var t=e.children(".nf-item-gname").text();this.navGName.html(t),this.navGName.attr("data-gid",e.attr("data-gid")),this.bannerMoreGroup.find(".actived").removeClass("actived"),e.addClass("actived")},groupMoreList:function(e){var t=['<li class="nf-group-item">','	<a href="http://www.renren.com/home/getGroupDetail?groupId='+e.id+'" data-gid="'+e.id+'" class="clearfix duplicate">','		<span class="nf-item-gname">'+e.name+"</span>",'		<span class="feeds-count fd-nav-num">'+e.count+"</span>","	</a>","</li>"].join("");return t},navListItem:function(e){var t=['<a href="'+e.href+'" data-gid="'+e.id+'">'+e.name,'	<span class="fd-nav-num">'+e.count+"</span>","</a>"].join("");return t},initGroupMenu:function(){var e=this.bannerGroup.find(".fd-nav-item:eq(4) a"),t=e.attr("data-gid");this.bannerGroup.find("a[data-gid="+t+"]").length>1&&(this.bannerMoreGroup.find("li:eq(0) a").addClass("duplicate"),this.bannerMoreGroup.find("a[data-gid="+t+"]").addClass("actived"))}},n.groupFeed=i}),define("newsfeed/feedFilter",["jquery","backbone","follow/feed/focusFilter","newsfeed/specialFocus","follow/feed/recommend","newsfeed/groupFeed","exports"],function(e,t,n,r,i,s,o){var u=/(?:newsfeed\/([a-z]+)){1}$/,a=["photo","video","status","blog","share"],f=function(){this.firstLoad=!0,this.nav=e("#frameFixedNav .fd-nav-list"),this.filterText=this.nav.find(".fd-nav-filter"),this.filterList=this.nav.find(".newsfeed-filter-list"),this.navSplitIcon=this.nav.find(".split-icon"),this.navFeedSort=this.nav.find(".sort-setting"),this.feedList=e("#feed-list"),this.bindEvents(),this.router=new t.Router,this.router.route("(newsfeed/:tag)",this.filterByTag.bind(this)),new s.groupFeed,t.history.start({pushState:!0,hashChange:!1,silent:!1,preventDefault:!0,root:window.location.pathname.slice(1).replace(/(?:^|\/)newsfeed\/.*$/,"")}),this.firstLoad=!1};f.prototype={bindEvents:function(){this.nav.on("click",".fd-nav-item>a",function(t){var n=e(t.target),r=(n.attr("href")||"").match(u)||(n.html().trim()==="新鲜事"?["",""]:null);r&&(n=n.parent(),r=r[1],e(document).scrollTop(0),n.siblings(".fd-nav-cur-item").removeClass("fd-nav-cur-item"),n.addClass("fd-nav-cur-item"),n.find(".fd-nav-num").remove(),this["tag2"+r]?(this["tag2"+r](),this.router.navigate("newsfeed/"+r)):(this.tag2all(),r?this.router.navigate("newsfeed/"+r):this.router.navigate("")),t.preventDefault())}.bind(this));var t=this;this.filterList.on("click","li",function(t){e(document).scrollTop(0);var n=e(t.target),r=n.attr("data-feed-type");n.hasClass("actived")||(n.siblings(".actived").removeClass("actived"),n.addClass("actived"),r==="0"?(this.filterText.text("新鲜事"),this.filterText.attr("href",nx.user.id),this.navSplitIcon.show(),this.navFeedSort.show()):(this.filterText.text(n.text()),this.filterText.attr("href",nx.user.id+"/newsfeed/"+n.attr("data-feed-type-label")),this.navSplitIcon.hide(),this.navFeedSort.hide()),this.filterText.attr("data-feed-type",r)),this.filterText.trigger("click")}.bind(this))},filterByTag:function(e){this.firstLoad?e&&(this["tag2"+e]?this["tag2"+e](!0):a.indexOf(e)>-1&&this.tag2all(!0)):e?a.indexOf(e)>-1?this.filterList.find('li[data-feed-type-label="'+e+'"]').trigger("click"):this.nav.find('.fd-nav-item a[href$="newsfeed/'+e+'"]').trigger("click"):this.filterList.find("li:first").trigger("click")},tag2all:function(t){var n=this.filterText.attr("data-feed-type")||"0";e(document).scrollTop(0),e(".ui-renren-publisher").show(),e(".double-cols-feed").length||e(".photopast").show(),e("#mergeModule").show(),e("#focus-filter").remove(),e("#follow_right").remove(),e("#friends-filter").remove(),e("#special-focus").remove(),e("#toolRefreshFeed").attr("data-isShow","true"),n==="0"?(this.navSplitIcon.show(),e("#frameFixedNav .feed-sort a").show()):(this.navSplitIcon.hide(),e("#frameFixedNav .feed-sort a").hide()),t?e(nx.data.feed).trigger("newsfeedFilter",[{type:n},!0]):(this.feedList.children().not(".new-feed-tip").remove(),e(".read-all-feed").remove(),e(nx.data.feed).trigger("newsfeedFilter",{type:n}))},tag2origin:function(t){e(".ui-renren-publisher").show(),e("#mergeModule").show(),e(".photopast").show(),e("#focus-filter").remove(),e("#special-focus").remove(),e("#follow_right").remove(),e("#friends-filter").remove(),e("#toolRefreshFeed").hide().attr("data-isShow","false"),e("#frameFixedNav .feed-sort a").hide(),this.nav.find(".nf-group-list-container .actived").removeClass("actived"),t?e(nx.data.feed).trigger("friendsOriginal",!0):(this.feedList.children().not(".new-feed-tip").remove(),e(".read-all-feed").remove(),e(nx.data.feed).trigger("friendsOriginal"))},tag2focus:function(t){e(".ui-renren-publisher").show(),e("#right-menu").hide(),e(".photopast").hide(),e("#friends-filter").remove(),e("#toolRefreshFeed").hide().attr("data-isShow","false"),e("#special-focus").remove(),e("#mergeModule").hide(),e("#follow_right").length>0&&e("#follow_right").remove(),this.nav.find(".fd-nav-gName-box").hide(),this.nav.find(".nf-group-list-container .actived").removeClass("actived"),new n.focusFilter,i.init(),e.renren.follow._delegated||(e.renren.follow._delegated=!0,e("body").delegate(".btn_follow","mouseover",function(){e(this).renrenfollow()})),t?e(nx.data.feed).trigger("contentFocus",[{type:"1"},!0]):(e(".read-all-feed").remove(),this.feedList.children().not(".new-feed-tip").remove(),e(nx.data.feed).trigger("contentFocus",{type:"1"}))},tag2specialfocus:function(t){e(".ui-renren-publisher").show(),e(".photopast").hide(),e("#mergeModule").hide(),e("#focus-filter").remove(),e("#follow_right"
).remove(),e("#friends-filter").remove(),e("#toolRefreshFeed").hide().attr("data-isShow","false"),e("#footprintArea .side-item").css("margin-top","0"),this.nav.find(".fd-nav-gName-box").hide(),this.nav.find(".nf-group-list-container .actived").removeClass("actived"),new r.SpecialFocus,t?e(nx.data.feed).trigger("groupFocus",!0):(this.feedList.children().not(".new-feed-tip").remove(),e(".read-all-feed").remove(),e(nx.data.feed).trigger("groupFocus"))}},o.FeedFilter=f}),define("ui/feedSetting",function(require,e){var t=jQuery.noConflict();require("ui/friendSearch");var n={getBanList:function(e,n){t.ajax({url:"http://www.renren.com/fetchRelationFeed.do",type:"get",dataType:"text",data:"action=ban",success:function(r){e.call(n,t.parseJSON(r))}})},relationAction:function(e,n,r,i){t.ajax({url:"http://www.renren.com/relationFeedOper.do?action="+e,type:"post",dataType:"text",data:"id="+n,success:function(e){t.parseJSON(e).code==0&&r.call(i)}})}};t.widget("ui.feedSetting",{options:{},_create:function(){var e=this;this.banFriendData=[],this.banPageData=[],n.getBanList(function(n){var r="",i="",s=n.candidate;for(var o=0;o<s.length;o++){var u=parseInt(s[o].id);u>1e3&&u<6e8||u>699999999&&u<780000001||u>799999999&&u<2147479033?r+=e.singleUserItem(s[o],"single-user"):i+=e.singleUserItem(s[o],"single-page")}t.ui.dialog({dialogClass:"feed-setting",width:569,buttons:[]}),t(".feed-setting .ui-widget-content").hide(),t(".feed-setting .ui-widget-header").hide(),t(".feed-setting .ui-widget-footer").hide(),r==""&&(r='<p class="none-item">无屏蔽的好友</p>'),i==""&&(i='<p class="none-item">无屏蔽的公共主页或小站</p>'),t(e.getSettingDialog(r,i)).appendTo(t(".feed-setting")),e.dialog=t(".feed-setting"),e.searchInput=e.dialog.find(".ui-friend-search"),e.friendContent=e.dialog.find(".friend-content"),e.friendTab=e.dialog.find(".friend-tab"),e.friendArea=e.friendContent.find(".select-area"),e.pageContent=e.dialog.find(".page-content"),e.pageTab=e.dialog.find(".page-tab"),e.dialogClsBtn=e.dialog.find(".cls-btn"),e.dialogCnclBtn=e.dialog.find(".cancel-btn"),e.searchInput.friendSearch({inputClass:e.searchInput,placeholder:"输入想屏蔽好友",showGroupName:!1,groupName:"",selectEvent:function(t,n,r){var i={id:t,name:n,head:r};e.addLow(i)}}),t("body").css("overflow","hidden"),e.reloPosition(),e._events()})},_init:function(){},_destroy:function(){},_events:function(){var e=this;this.friendTab.on("click",function(){t(this).hasClass("actived")||(t(this).addClass("actived"),e.pageTab.removeClass("actived"),e.pageContent.hide(),e.friendContent.show())}),this.pageTab.on("click",function(){t(this).hasClass("actived")||(t(this).addClass("actived"),e.friendTab.removeClass("actived"),e.friendContent.hide(),e.pageContent.show())}),this.dialogClsBtn.on("click",function(){e.dialog.remove(),t("body").css("overflow","auto")}),this.dialogCnclBtn.on("click",function(){e.dialog.remove(),t("body").css("overflow","auto")}),this.dialog.on("click",".ban-item",function(){e.delLow(t(this).attr("data-uid"),t(this))})},reloPosition:function(){t(".feed-setting").css({left:(t(window).width()-611)/2+"px",top:(t(window).height()-549)/2+t(document).scrollTop()+"px"})},addLow:function(e){var r=this;this.friendArea.find(".ban-item[data-uid="+e.id+"]").length>0?t.dialog.success("您所选择的的用户已经在屏蔽列表中了"):n.relationAction("addLow",e.id,function(){r.friendArea.children(".none-item").length>0&&t(".feed-setting .none-item").remove(),r.friendArea.find(".single-user").length>0?t(r.singleUserItem(e,"single-user")).insertBefore(r.friendArea.find(".single-user:eq(0)")):t(r.singleUserItem(e,"single-user")).appendTo(r.friendArea)})},delLow:function(e,r){var i=this;n.relationAction("delLow",e,function(){r.remove(),i.friendArea.find(".single-user").length==0&&t('<p class="none-item">无屏蔽的好友</p>').appendTo(i.friendArea)})},getSettingDialog:function(e,t){var n=['	<div class="header">',"		<h2>新鲜事设置</h2>",'		<a href="#nogo" class="cls-btn" title="关闭"></a>',"	</div>",'	<div class="content">','		<div class="content-tab clearfix">','			<a href="#nogo" class="friend-tab actived">已屏蔽的好友</a>','			<a href="#nogo" class="page-tab">已屏蔽的公共主页或小站</a>',"		</div>",'		<div class="friend-content">','			<input class="ui-friend-search" placeholder="输入想屏蔽好友">','			<div class="select-area clearfix">'+e,"			</div>","		</div>",'		<div class="page-content">',"			<p>以下是你已屏蔽的所有公共主页或者小站</p>",'			<div class="select-area clearfix">'+t,"			</div>","		</div>","	</div>",'	<div class="footer">','		<a href="#nogo" class="cancel-btn">关闭</a>',"	</div>"].join("");return n},singleUserItem:function(e,t){var n=['<a href="#nogo" class="ban-item '+t+' clearfix" data-uid="'+e.id+'">','	<img src="'+e.head+'">','	<div class="info">','		<p class="uname">'+e.name+"</p>",'		<p class="operation">解除屏蔽</p>',"		<i></i>","	</div>","</a>"].join("");return n}})}),define("newsfeed/feedOptions",function(require,e){var t=jQuery.noConflict(),n=function(e){this.feedIds=e,this.init()};n.prototype={init:function(){var e=this.getShareData(),t=this.getLikeData(),n=this.getUserData();this.initReplyStyel(),this.allData={share:{shareIds:e.ids,shareList:e.shareList,shareSourceStatusList:e.sourceStatusList,shareStatusList:e.statusList},like:{likeIds:t.ids,likeBtnList:t.likeBtnList},act361:{actNewlist:n.newlist,actIds:n.ids}},this.requestMarkData(this.allData)},getShareData:function(){var e={},n={},r=[],i={},s=[];for(var o=0;o<this.feedIds.length;o++){var u=t("#"+this.feedIds[o]),a=u.find(".share"),f=parseInt(u.children(".header").children(".user-avatar").attr("data-stype")),l,c;if(a.length>0&&(f==601||f==602||f==701||f==709||f==102||f==103||f==104||f==107||f==110||f==708||f==1011||f==9801||f==9802||f==9803||f==9805||f==2904||f==2907||f==3730||f==3731||f==3732||f==3733||f==3735||f==3801||f==3802||f==3803||f==3804||f==602)){l=t.parseJSON(a.attr("data-share")),c=l.owner+"_"+l.id;if(f==601||f==701||f==709||f==708||f==1011||f==9801||f==9802||f==9803)c=this.packageShareUrl(f,l,a);e[this.feedIds[o]]=c,n[this.feedIds[o]]=a}a.length>0&&(f==502||f==505)&&(l=this.packageStatusData(a),c=l.uid+"_"+l.did,i[c]=a,r.push(l)),a.length>0&&a.children("i").html()!=""&&a.addClass("has-num")}return e!={}&&s.push(JSON.stringify(e)),{ids:s,shareList:n,sourceStatusList:r,statusList:i}},getLikeData:function(){var e=[],n={},r={},i=t("#feed-list").children(".a-feed"),s="",o=i.length;for(var u=0;u<this.feedIds.length;u++){var a=t("#"+this.feedIds[u]),f=a.find(".like"),l=parseInt(a.children(".header").children(".user-avatar").attr("data-stype"));if(l&&f&&(l==601||l==701||l==709||l==102||l==103||l==104||l==107||l==110||l==502||l==505||l==708||l==501||l==1011||l==9801||l==9802||l==9803||l==9805||l==2904||l==2907||l==1014||l==213||l==8001||l==8002||l==8003||l==8004||l==8016||l==8017||l==8018||l==8019||l==3730||l==3731||l==3732||l==3733||l==3735||l==3801||l==3802||l==3803||l==3804||l==602||l==4001||l==4002||l==4003||l==4004||l==4005)){var c=this.packageLikeData(f);s=c.type+"_"+c.sourceId,e.push(s),r[s]=f,f._num=!0}f.length>0&&f.text().trim()!=""&&f.addClass("has-num")}return{ids:e,likeBtnList:r}},getUserData:function(){var e=[],n=t("#feed-list").find(".user-avatar .avatar"),r={};for(var i=0;i<this.feedIds.length;i++){n=t("#"+this.feedIds[i]).find(".user-avatar .avatar");var s=n.attr("namecard");r[s]==undefined?(e.push(s),r[s]=new Array,r[s].push(n)):r[s].push(n)}return{ids:e,newlist:r}},initReplyStyel:function(){for(var e=0;e<this.feedIds.length;e++){var n=t("#"+this.feedIds[e]),r=n.find(".reply");r.length>0&&r.children("i").html()!=""&&r.addClass("has-num")}},requestMarkData:function(e){var n=this;t.ajax({url:"http://www.renren.com/getFeedOptions",data:"activityList="+encodeURIComponent(e.act361.actIds.join(","))+"&likeList="+encodeURIComponent(e.like.likeIds.join("-"))+"&shareList="+encodeURIComponent(e.share.shareIds.join(","))+"&doingList="+encodeURIComponent(JSON.stringify(e.share.shareSourceStatusList)),type:"post",dataType:"text",success:function(r){try{var i=t.parseJSON(r);i.shareStatus&&n.addShareNum(e.share.shareList,i.shareStatus.value),i.likeStatus&&n.addlikeNum(e.like.likeBtnList,i.likeStatus.likeList),i.activityStatus&&nx.data.matter==undefined&&n.markUserFeed(e.act361.actNewlist,i.activityStatus),i.doingStatus&&n.addShareStatusNum(e.share.shareStatusList,i.doingStatus.value)}catch(s){console.log(s)}}})},packageShareUrl:function(e,t,n){var r;return e==601?r="http://blog.renren.com/GetEntry.do?id="+t.id+"&owner="+t.owner:e==701||e==708?r="http://photo.renren.com/photo/"+t.owner+"/photo-"+t.id:e==1011?r="http://mvideo.renren.com/video/"+t.owner+"/"+t.id:e==9801||e==9802||e==9803||e==9805?r="http://wiki.renren.com/movie/"+t.owner+"/comment/"+n.parents(".a-feed").find(".feed-content").attr("data-wikimid"):r="http://photo.renren.com/photo/"+t.owner+"/album-"+t.id,r},packageStatusData:function(e){var n=t.parseJSON(e.attr("data-share")),r={};return r.uid=n.owner,r.did=n.id,r},packageLikeData:function(e){var n=t.parseJSON(e.attr("data-like")),r={};return r.sourceId=n.sourceId,r.type=n.stype,r},addShareNum:function(e,n){for(var r=0;r<n.length;r++){n[r].num==-1&&(n[r].num=0);var i=this.cutShareLikeNum(n[r].num);i!=0&&(t(e[n[r].fid]).children("i").html(i),t(e[n[r].fid]).addClass("has-num"),this.isNeedSharePopup(t(e[n[r].fid]),i))}},addShareStatusNum:function(e,n){for(var r=0;r<n.length;r++)if(e[n[r].gid]){e[n[r].gid]._num=n[r].num;var i=this.cutShareLikeNum(n[r].num);i!=0&&(t(e[n[r].gid]).children("i").html(i),t(e[n[r].gid]).addClass("has-num"),this.isNeedSharePopup(t(e[n[r].gid]),i))}},addlikeNum:function(e,n,r){var i,s;for(i=0;i<n.length;i++){var o=e[n[i].gid],u=n[i].likeCount,a=n[i].ownerLike;n[i].gid.indexOf("comment")==-1&&n[i].gid.indexOf("wikicomment")==-1?u>0&&(a?(t(o).addClass("liked"),t(o).html("<i></i>"+this.cutShareLikeNum(u))):(t(o).html("<i></i>"+this.cutShareLikeNum(u)),t(o).addClass("has-num")),this.isNeedLikePopup(o,u,a)):console.log(o);if(n[i].likeList.length>0){var f=t(o).parent(".appendix").children(".like-friend-list"),l=n[i].likeList,c="",h="";for(s=0;s<(l.length>4?4:l.length);s++)c+=this.likeAvatar(l[s]);for(s=0;s<l.length;s++)l[s].userId!=parseInt(nx.user.id)&&(s!=l.length-1?h+="<span class='like-name'>"+l[s].name+" </span>":s==l.length-1&&(h+="<span class='like-name'>"+l[s].name+"</span>"));n[i].ownerLike==1?h==""?f.html(c+this.likeTips("我",h,"","")):f.html(c+this.likeTips("我和",h+"等",n[i].likeCount,"人")):f.html(c+this.likeTips("",h+"等",n[i].likeCount,"人"))}}},markUserFeed:function(e,n){var r=this;for(var i=n.length-1;i>=0;i--)if(n[i].mid!=0){var s=e[n[i].uid];for(var o=s.length-1;o>=0;o--){var u=t(s[o]).parents(".a-feed");if(u.length>0){var a=u.find(".header .feed-user-info"),f=nx.data.feed.fedact,l=f["m"+n[i].mid];if(l){if(a.find(".similar-title").length>0)return;var c=t("<a class='add-mark2' title='"+l.alt+"' target='_blank' href='"+l.url+"'><img src='"+l.imgurl+"' alt='"+l.alt+"'></a>");c.appendTo(a)}}}}},likeAvatar:function(e){var t=["<a>",'<img src="'+e.headUrl+'" title="'+e.name+'" data-uid="'+e.userId+'">',"</a>"].join("");return t},likeTips:function(e,t,n,r){var i=['<div class="list-like-tip">','   <i class="list-like-tip-arr"></i>'+e+t+'<span class="tip-counts">'+n+"</span>"+r+"赞过此内容","</div>"].join("");return i},isNeedLikePopup:function(e,t,n){var r=e.parents(".a-feed").find(".user-avatar").attr("data-stype");if(r=="103"){var i=e.parents(".a-feed").find(".share-photo img");i.attr("data-viewer")!=undefined&&this.addLikePopupData([i],t,n)}else if(r=="102"){var s=e.parents(".a-feed").find(".share-content .read-more"),o=e.parents(".a-feed").find(".share-content .share-blog-title");(s.attr("data-viewer")!=undefined||o.attr("data-viewer")!=undefined)&&this.addLikePopupData([s,o],t,n)}},isNeedSharePopup:function(e,t){var n=e.parents(".a-feed").find(".user-avatar").attr("data-stype");if(n=="103"){var r=e.parents(".a-feed").find(".share-photo img");r.attr("data-viewer")!=undefined&&this.addSharePopupData([r],t)}else if(n=="102"){var i=e.parents(".a-feed").find(".share-content .read-more"),s=e.parents(".a-feed").find(".share-content .share-blog-title");(i.attr("data-viewer")!=undefined||s.attr("data-viewer")!=undefined)&&this.addSharePopupData([i,s],t)}},addSharePopupData:function(e,n){var r=t.parseJSON(e[0].attr("data-viewer"));r.shareCount=n;for(var i=0;i<e.length;i++)e[i].attr("data-viewer",JSON.stringify(r))},addLikePopupData:function(e,n,r){var i=t.parseJSON(e[0].attr("data-viewer"));i.likeCount=n,i.isLike=r;for(var s=0;s<e.length;s++)e[s].attr("data-viewer",JSON.stringify(i))},cutShareLikeNum:function(e){var t=e;if(!(e<1e4)){var n=Math.floor(e/1e4),r=Math.floor(e/1e3%10);e<1e5?r!=0?t=n+"."+r+"w":t=n+"w":parseInt(e)<1e7?t=n+"w":t="999w"}return t}},e.FeedOptions=n}),define("newsfeed/tips",function(require,e){var t=jQuery.noConflict(),n=require("newsfeed/tools");require("ui/tooltip");var r={getSpecificFeed:function(e,n,r){t.ajax({url:"http://www.renren.com/requestfeedbyid.do",type:"post",data:"id="+e+"&view=10",dataType:"text",success:function(e){n.call(r,e)}})},getMissedFeedCount:function(e,n){t.ajax({url:"http://www.renren.com/feedmisscount.do?view=10",type:"get",dataType:"text",success:function(r){var i=t.parseJSON(r);i.code=="0"&&e.call(n,i.value)}})},readAllMissedFeed:function(e,n){t.ajax({url:"http://www.renren.com/feedmissreadall.do",type:"post",dataType:"text",success:function(t){e.call(n,t)}})},readAllFeed:function(e,n){t.ajax({url:"http://www.renren.com/readNews.do",type:"post",dataType:"text",data:"t=a",success:function(){e.call(n)}})}},i=function(){this.feedList=t("#feed-list"),this.feedTips=this.feedList.children(".new-feed-tip"),this.feedTipsBtn=this.feedTips.children("a"),this.feedTipsClsBtn=this.feedTips.find(".tips-close"),this.feedTipsCount=this.feedTipsBtn.children("span"),this.feedTips2=t("#toolRefreshFeed"),this.feedTipsBtn2=this.feedTips2.children(".refresh-back-to"),this.feedTipsCount2=this.feedTipsBtn2.find(".count-num"),this.continueBtn=t("#toolRefreshFeed .feed-continue-read"),this.continueFeedId="",this.continueBtnIsShown=!1,this.missedTipsFlag=!1,this.continueTips='<div id="feed-continue-tips" class="clearfix"><span class="tips-split"></span><span class="tips-text">上回阅读到这里</span><span class="tips-split"></span></div>',this.isNewLogin=!1,this.isMissedFeed=t("#needRequestMissFlag").val(),this.backTips='<div id="return-all-tips" class="clearfix"><span class="tips-split"></span><a href="javascript:;">返回全部新鲜事</a><span class="tips-split tips-split-right"></span></div>',this.backFooterTips='<div id="return-all-tips-footer" class="clearfix"><span class="tips-split"></span><a href="javascript:;">返回全部新鲜事</a><span class="tips-split tips-split-right"></span></div>',this.sideBarW=t(".nx-sidebar").width(),this.containW=t(".bd-container").width(),this.contentW=t(".bd-content").width(),this.nrWidth1=t("#toolBackTo").css("left"),this.feedTips2.css("left",this.nrWidth1),this.nav=t("#frameFixedNav"),this.checkBtn=this.nav.find(".fd-nav-filter"),this.filterList=this.nav.find(".newsfeed-filter-list"),this.initMissedFeed(),this.bindEvents()};i.prototype={bindEvents:function(){var e=this;t("body").delegate("#webpager","feed_status",function(n,i){if(e.feedTips2.attr("data-isshow")=="false")return;var s=i.content;e.feedTips2.show();if(s.feed_stype=="102"||s.feed_stype=="103"||s.feed_stype=="104"||s.feed_stype=="107"||s.feed_stype=="110"||s.feed_stype=="501"||s.feed_stype=="502"||s.feed_stype=="504"||s.feed_stype=="505"||s.feed_stype=="601"||s.feed_stype=="701"||s.feed_stype=="708"||s.feed_stype=="709"||s.feed_stype=="1101"||s.feed_stype=="1209"||s.feed_stype=="1011"){if(e.missedTipsFlag)return;if(s.feed_actor==nx.user.id){if(e.checkBtn.text()!="新鲜事")return;t(".newsfeed-empty").length>0&&t(".newsfeed-empty").remove(),r.getSpecificFeed(s.feed_id,function(e){t(nx.data.feed).trigger("feedRecieved",{data:e,insertType:"before"})})}else{var o=e.feedTipsBtn.attr("data-fid");t("#missed-feed-tips").length>0&&t("#missed-feed-tips").remove(),o?o.indexOf(s.feed_id)==-1&&(e.feedTipsBtn.attr("data-fid",o+","+s.feed_id),e.feedTipsBtn2.attr("data-fid",o+","+s.feed_id),e.feedTipsCount.html(parseInt(e.feedTipsCount.text())+1),e.feedTipsCount2.html(parseInt(e.feedTipsCount2.text())+1)):(e.feedTipsBtn.attr("data-fid",s.feed_id),e.feedTipsBtn2.attr("data-fid",s.feed_id),e.feedTipsBtn.css("display","block"),e.feedTipsClsBtn.css("display","block"),t(".get-more-feed").length>0&&e.feedList.find(".a-feed").length==0?t(".get-more-feed").addClass("border-top"):t(".get-more-feed").length==0&&e.feedList.find(".a-feed").length==0&&t(".new-feed-tip a").addClass("border-bottom"),t(".newsfeed-empty").length>0&&t(".newsfeed-empty").remove(),t(document).scrollTop()!==0&&(e.feedTips2.show(),e.continueBtnIsShown==0&&(e.feedTips.css("display","none"),e.feedTipsBtn2.css("display","block"))),e.feedTipsCount.html(parseInt(e.feedTipsCount.text())+1),e.feedTipsCount2.html(parseInt(e.feedTipsCount2.text())+1))}}}),t(window).on("scroll",function(){var n=t(".nx-right").height()-t(window).height()+265;t(document).scrollTop()>0&&e.feedTipsCount2.html()!=="0"?(e.feedTips2.show(),e.continueBtnIsShown==0&&(e.feedTipsBtn2.css("display","block"),e.feedTips.css("display","none"))):(e.feedTipsBtn2.hide(),e.feedTips.show()),t(document).scrollTop()>e.continueReadPos&&(t("#feed-continue-tips").remove(),e.hideContinueBtn())}),t(document).on("mainframe:reflow",function(n,r){var i=(t(".bd-container").width()-e.contentW)/2+e.contentW+t(".nx-sidebar").width()+20;window.webpager!==undefined&&window.webpager.getFold===undefined?r==="fold"?t(window).width()<1024?e.fixLoction70():e.fixLocationLeft(i):r==="unfold"&&(t(window).width()-(t(".nx-sidebar").width()+e.contentW+240)<180?e.fixLoction310():e.fixLocationLeft(i)):window.webpager!==undefined&&window.webpager.getFold()===!0&&r===undefined?t(window).width()<1024?e.fixLoction70():e.fixLocationLeft(i):window.webpager!==undefined&&window.webpager.getFold()===!1&&r===undefined?t(window).width()-(t(".nx-sidebar").width()+e.contentW+240)<180?e.fixLoction310():e.fixLocationLeft(i):window.webpager!==undefined&&window.webpager.getFold&&(r==="fold"?t(window).width()<1024?e.fixLoction70():e.fixLocationLeft(i):r==="unfold"&&(t(window).width()-(t(".nx-sidebar").width()+e.contentW+240)<180?e.fixLoction310():e.fixLocationLeft(i)))}),this.feedTipsBtn.on("click",function(){e.isBackToAllFeed()||r.getSpecificFeed(t(this).attr("data-fid"),function(n){e.resetTips(),t(nx.data.feed).trigger("feedRecieved",{data:n,insertType:"before"})})}),e.feedTipsClsBtn.on("click",function(){e.resetTips()}),this.feedTipsBtn2.on("click",function(){e.isBackToAllFeed()||r.getSpecificFeed(t(this).attr("data-fid"),function(r){t("#feed-continue-tips").length>0&&t("#feed-continue-tips").remove(),n.fixDom("continue")==undefined?e.continueFeedId=e.feedList.find(".a-feed:last").attr("id"):e.continueFeedId=n.fixDom("continue").attr("id"),e.feedList.find(".a-feed:eq(0)").attr("id")!=e.continueFeedId&&(t(e.continueTips).insertBefore(t("#"+e.continueFeedId)),e.showContinueBtn()),t(document).scrollTop(0),e.resetTips(),t(nx.data.feed).trigger("feedRecieved",{data:r,insertType:"before"}),e.continueReadPos=t("#"+e.continueFeedId).position().top+35-41+1,t(".double-cols-feed").length>0&&t(e.continueTips).css("top",e.continueReadPos+"px")})}),this.continueBtn.on("click",function(){t(document).scrollTop(t("#"+e.continueFeedId).position().top+35-41),e.continueBtn.hide(),e.continueBtnIsShown=!1}),t(nx.data.feed).on("feedRecieved",function(){nx.data.feed.getMissedFeed&&(nx.data.feed.getMissedFeed=!1,e.initMissedFeed())}),t(".bd-content").on("click",".read-all-feed",function(){t.ui.dialog({dialogClass:"ui-dialog-confirm",width:550,buttons:[{text:"取消",click:function(){var e=t(this).dialog("instance");e._trigger("cancel"),e.destroy()}},{text:"确定","class":"ui-button-blue",click:function(e){var n=t(this).dialog("instance"),r=n._trigger("confirm");r&&n.destroy()}}],confirm:function(){r.readAllFeed(function(){t(".bd-content").find(".a-feed").remove(),t(".bd-content").find(".similar-feed-link").length&&t(".bd-content").find(".similar-feed-link").remove(),t(".read-all-feed").remove(),n.btnFactory(2)})}},"<div><h1>是否将全部新鲜事设置为已读</h1><h1>（会将原创内容、好友分组的新鲜事也一并设置为已读）</h1></div>")})},isBackToAllFeed:function(){return this.checkBtn.text()!="新鲜事"?(this.filterList.find(".actived").removeClass("actived"),this.filterList.find("li:eq(0)").addClass("actived"),this.checkBtn.html("新鲜事").attr("data-feed-type","0"),this.nav.find(".split-icon").css("display","block"),this.nav.find(".sort-setting").css("display","block"),t(nx.data.feed).trigger("newsfeedFilter",{type:"0"}),t(document).scrollTop(0),this.resetTips(),!0):!1},feedTips2Left:function(){var e="",n=this,r=setInterval(function(){var i=t("#toolBackTo").css("right");i==e?(n.feedTips2.css({left:t(window).width()-parseInt(i)-n.feedTips2.width(),right:"auto"}),clearInterval(r)):e=i},20)},fixLoction70:function(){this.feedTips2Left()},fixLoction310:function(){this.feedTips2Left()},fixLocationLeft:function(e){this.feedTips2Left()},resetTips:function(){this.feedTipsBtn.css("display","none"),this.feedTipsClsBtn.css("display","none"),this.feedTipsBtn2.css("display","none"),this.feedTipsBtn.attr("data-fid",""),this.feedTipsBtn2.attr("data-fid",""),this.feedTipsCount.html(0),this.feedTipsCount2.html(0)},showContinueBtn:function(){var e=this;this.continueBtn.css("display","block"),this.continueBtnIsShown=!0,setTimeout(function(){e.hideContinueBtn()},3e4)},hideContinueBtn:function(){this.continueBtn.hide(),this.continueBtnIsShown=!1,t(document).scrollTop()>0&&this.feedTipsCount2.html()!=="0"&&this.feedTipsBtn2.show()},initMissedFeed:function(){var e=this;this.isMissedFeed=="1"&&r.getMissedFeedCount(function(n){if(n[0].feedcount=="0")return;if(t("#missed-feed-tips").length>0)return;var r=e.missedFeedTmpl(n[0]);t(r).insertBefore(e.feedTips),e.missedTipsFlag=!0,e.initMissedParams()})},missedFeedTmpl:function(e){var t="";this.isNewLogin?t='<a href="#nogo" class="tips-text">好久没登录了？你错过了'+e.friendcount+"位好友的"+e.feedcount+"条精彩内容</a>":t='<a href="#nogo" class="tips-text">没有更多新鲜事了，但你错过了'+e.friendcount+"位好友的"+e.feedcount+"条新鲜事</a>";var n=['<div id="missed-feed-tips">'+t,'	<a href="#nogo" title="今天不再出现" class="tips-close ui-icon ui-icon-close">关闭</a>',"</div>"].join("");return n},initMissedParams:function(){this.missedTipsCon=t("#missed-feed-tips"),this.missedTipsGetBtn=this.missedTipsCon.find(".tips-text"),this.missedTipsClsBtn=this.missedTipsCon.find(".tips-close"),this.missedTipsClsBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-6",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(n.vertical).addClass(n.horizontal).appendTo(this)}}}),this.bindMissedEvent()},bindMissedEvent:function(){var e=this;this.missedTipsClsBtn.on("click",function(){r.readAllMissedFeed(function(){e.missedTipsCon.remove()})}),this.missedTipsGetBtn.on("click",function(n){if(t(n.target).hasClass("tips-text")){t(nx.data.feed).trigger("getMissedFeedData");if(t("#return-all-tips").length>0)return;e.missedTipsCon.hide(),t(".double-cols-feed").length>0?t(e.backTips).addClass("double-cols-miss-tips").insertBefore(".bd-publisher"):t(e.backTips).insertAfter(e.missedTipsCon),e.missedTipsCon.remove(),e.checkBtn.text()!="新鲜事"&&(e.checkBtn.html("新鲜事").attr("data-feed-type","0"),e.filterList.find(".actived").removeClass("actived"),e.filterList.find("li:eq(0)").addClass("actived"))}}),t(".bd-content").on("click","#return-all-tips-footer a, #return-all-tips a",function(){t("#return-all-tips").remove(),t(document).scrollTop(0),e.missedTipsFlag=!1,t(nx.data.feed).trigger("newsfeedFilter",{type:0})})}},e.FeedTips=i}),define("newsfeed/specialFocus",function(require,e){var t=jQuery.noConflict(),n=require("mustache.js"),r={Templ:{successIcon:'<span class="add-success"><i></i>添加成功</span>',avatarList:['<div class="group-member">',"	<h2>",'		<span class="group-name">特别关注</span>(<span class="user-counts">{{candidate.length}}</span>)','		<a href="javascript:;" class="tool-box"></a>',"	</h2>",'	<div class = "member-list clearfix">',"	{{#candidate}}",'		<a href="http://www.renren.com/{{id}}/profile" namecard="{{id}}" title="{{name}}" target="_blank">','			<img src="{{head}}">',"		</a>","	{{/candidate}}","	</div>",'	<input class = "ui-friend-search" placeholder="输入好友姓名加入本组">',"</div>"].join(""),recommondList:['<div class="group-suggestor">',"	<h2>建议添加为特别关注</h2>",'		<ul class="suggestor-list">',"			{{#list}}",'				<li class="clearfix">','					<img src="{{tiny_url}}">','					<a href="http://www.renren.com/profile.do?id={{id}}" class="suggest-name">{{name}}</a>','					<a href="javascript:;" class="add-special" data-uid="{{id}}">添加</a>',"				</li>","			{{/list}}","		</ul>","</div>"].join(""),singleItem:['<a href="http://www.renren.com/{{id}}/profile" namecard="{{id}}" title="{{name}}" target="_blank">','	<img src="{{head}}">',"</a>"].join("")}},i=null;require("ui/friendSearch"),require("newsfeed/specialManage");var s={getFocusList:function(e,n){t.ajax({url:"http://www.renren.com/fetchRelationFeed.do?action=focus",type:"get",dataType:"json",success:function(t){e.call(n,t)}})},addIntoFocus:function(e,n,r){t.ajax({url:"http://www.renren.com/relationFeedOper.do?action=addHigh",type:"post",data:"id="+e,dataType:"text",success:function(e){t.parseJSON(e).code===0?n.call(r,e):t.parseJSON(e).code===2?t.dialog.errorMsg("已达到20人数上限，去管理列表吧"):t.parseJSON(e).code===3?t.dialog.errorMsg("您已添加过该用户"):t.parseJSON(e).code===4&&t.dialog.errorMsg("请先加好友")}})}},o=function(){this.init()};o.prototype={init:function(){this.rightMenu=t(".nx-right"),this.insertRightMenu()},insertRightMenu:function(){if(t("#special-focus").length>0)return;t("<div id='special-focus' class='side-item'></div>").insertBefore(t("#feed-list-right")),this.container=t("#special-focus"),this.getFocusAvatar(),this.events()},getFocusAvatar:function(){var e=this;s.getFocusList(function(i){var s=t(n.render(r.Templ.avatarList,i));s.appendTo(e.container),e.initAvatarItem(),e.searchInput.friendSearch({placeholder:"输入好友姓名添加特别关注",showGroupName:!0,selectEvent:function(t,n,r,i){var s={id:t,name:n,head:r};e.addFocus(s)}})})},initAvatarItem:function(){this.uList=this.container.find(".member-list"),this.listCount=this.container.find(".user-counts"),this.searchInput=this.container.find(".ui-friend-search"),this.toolBoxBtn=this.container.find(".tool-box")},events:function(){var e=this;this.container.on("click",".add-special",function(){var e=this,i=t(this).attr("data-uid");s.addIntoFocus(i,function(i){t(n.render(r.Templ.successIcon)).appendTo(t(e).parent("li")),t(e).remove()})}),this.container.on("click",".tool-box",function(){var i=e.uList.find("a"),s=[];for(var o=0;o<i.length;o++)s.push({uId:t(i[o]).attr("namecard"),uName:t(i[o]).attr("title"),uTiny:t(i[o]).children("img").attr("src")});t.renren.specialManage({specialUList:s,submit:function(i){e.uList.html("");for(var s=0;s<i.length;s++)t(n.render(r.Templ.singleItem,i[s])).appendTo(e.uList);e.listCount.html(i.length)}})})},addFocus:function(e){var i=this;s.addIntoFocus(e.id,function(s){t(n.render(r.Templ.singleItem,e)).appendTo(i.uList),i.listCount.html(parseInt(i.listCount.html())+1)})}},e.SpecialFocus=o,t.widget("dialog.errorMsg",t.dialog.alert,{_create:function(){this.options.buttons=[],this.options.modal=!1,this._super(),this._delay("destroy",3e3)}})}),define("feed/xiaozu",function(require,e){function a(e,n){s[e]?n(s[e]):t.ajax({url:u,dataType:"json",method:"post",data:"voteId="+e,success:function(t){s[e]=t,n(t)}})}function f(e,n,r){setTimeout(function(){t(".progress-len",n.get(0)).css("width",180*e.percent/100+"px")},100);var i=t("input",n.get(0));return r!==0&&(e.isChecked?i[0].checked=!0:i.removeAttr("checked")),i[0].disabled=!0,'<div class="progress">			<div class="progress-len" style="width:0" ></div>			<div class="progress-data">'+e.ballot+"("+e.percent+"%)</div>		</div>"}function l(e,n,r){e.msg&&t.dialog.alert(e.msg),e.options&&t.each(e.options,function(e,i){var s=f(i,t(n[e]),r);t(n[e]).append(s)})}function c(e,n){t.ajax({url:o,dataType:"json",method:"post",data:e,success:function(e){n(e)}})}var t=require("jquery"),n=jQuery,r="nxContainer",i=t("#"+r),s={},o="http://xiaozu.renren.com/xiaozu/uservote?from=newsfeed",u="http://xiaozu.renren.com/xiaozu/isUserHasVote?from=newsfeed";i.delegate(".group-vote-open-btn","click",function(){var e=t(this),n=e.attr("opened"),r=e.attr("voteid"),i=e.attr("isvoted"),s=e.closest(".group-vote-items"),o=t(".group-vote-item",s[0]);n==1?(t(".group-vote-item:gt(3)",s[0]).hide(),e.attr("opened",0),e.html("展开全部选项")):(e.attr("reqed")||a(r,function(n){e.attr("reqed",1),n.options?(l(n,o),e.attr("isvoted",1)):(e.attr("isvoted",0),t(".group-vote-btn-con",s[0]).show())}),t(".group-vote-item",s[0]).show(),e.attr("opened",1),e.html("收起部分选项"))}),i.delegate(".group-vote-btn","click",function(e){var n=t(this),r=n.attr("voteid"),i=n.closest(".group-vote-items"),s=i.find("input:checked"),o=t(".group-vote-item",i[0]);if(!s.length){t.dialog.alert("请选择一个选项!");return}var u=[],a="";t.each(s,function(e,t){t.checked&&u.push(t.value)}),a="voteId="+r+"&optIds="+u.join("&optIds="),c(a,function(e){l(e,o,e.flag),n.hide()})})}),define(function(require){require("feed/xiaozu")}),define("feed/vipSend",function(require,e){function i(e){define(["vip/plugin/sendBirthGift"],function(t){t.initialize(e)})}function s(e){define(["vip/skin"],function(t){t.init(e)})}var t=require("jquery"),n=this,r=t("#nxContainer");r.delegate(".feed-send-gift-btn","click",function(){var e=t(this).attr("data-userId");t.ajax({url:"http://i.renren.com/api4v7/getV7BirthGiftJsSrc",type:"post",dataType:"json",success:function(t){define.config({map:{"vip/plugin/sendBirthGift":t[0]}}),i(e)}})}),r.delegate(".vip-feed-skin-btn","click",function(){var e=t(this).attr("data-tplV7Id");t.ajax({url:"http://i.renren.com/api4v7/getV7SkinJsSrc",type:"post",dataType:"json",success:function(t){define.config({map:{"vip/skin":t[0]}}),s(e)}})})}),define(function(require){require("feed/vipSend")}),define("feed/huatiImg",function(require,e){function o(e,n){var r=n.attr("feedid");e&&t.each(e,function(n,i){var s=t("#huati_vote_"+r+"_"+n),o="",u='<span class="votenum ">'+Math.round(i)+"%</span>";s.removeClass("unvote"),e.hasVoteId==n?s.addClass("voteds"):s.addClass("votedus"),s.html(u)})}function u(e,n){t.ajax({url:s,dataType:"json",method:"post",data:e,success:function(e){n(e)}})}var t=require("jquery"),n="nxContainer",r=t("#"+n),i={},s="http://huati.renren.com/vote";r.delegate(".voteicon","click",function(e){var n=t(this);if(!n.hasClass("unvote"))return;var r=n.attr("voteid"),i=n.attr("optIds"),s=n.attr("topicTitle"),a=n.attr("topic_suffix"),f=n.attr("topic_id");query={voteId:r,options:i,type:"106",optionContent:"",topicTitle:s,suffix:a,topicId:f},u(query,function(e){o(e,n)})})}),define(function(require){require("feed/huatiImg")}),define("newsfeed/specialManage",function(require,e){require("ui/scrollbar"),require("ui/placeholder");var t=jQuery.noConflict(),n=require("mustache.js"),r={Templ:{mamageContent:['	<div class="dialog-content-other">','		<div class="clearfix">','			<div class="group-list">','				<input class="search-friend">','				<div class="glist-container">',"					<ul>","					</ul>","				</div>","			</div>",'			<div class="show-list-container">','				<p class="select-all clearfix">',"					<a></a>","					全选","				</p>",'				<div class="detail-container">','					<div class="list-detail clearfix">',"					</div>","				</div>","			</div>","		</div>",'		<div class="select-tips clearfix">','			<span>已选特别关注成员<span class="count-msg">(<span class="selected"></span>/20)</span><span class="error-tips">最多选择20个好友</span></span>','			<a class="clear-data">清空</a>',"		</div>",'		<div class="actived-container">','			<div class="select-list-container clearfix">',"			</div>","		</div>","	</div>"].join(""),groupListItem:["<li>",'	<a class="a-group" data-map="{{mapCount}}">{{groupName}}</a>',"</li>"].join(""),singleUserItem:['<div class="a-friend {{selected}}" data-uid="{{userId}}">','	<img src="{{userTiny}}">',"	<p>{{userName}}</p>",'	<i class="active-icon"></i>',"</div>"].join(""),singleActivedItem:['<a data-uid="{{uId}}" class = "a-selected" data-utiny="{{uTiny}}">',"		<span>{{uName}}</span>","		<i></i>","	</a>"].join("")}},i=null,s={getAllData:function(e,n){var r=JSON.stringify({uid:!0,uhead:!0,uname:!0,group:!0,init:!0,param:{}});t.ajax({url:"http://friend.renren.com/friendsSelector.do",type:"post",dataType:"text",data:"p="+r,success:function(r){e.call(n,t.parseJSON(r))}})},getSpecificData:function(e,n,r){var i=JSON.stringify({uid:!0,uhead:!0,uname:!0,group:e,init:e==="全部好友",param:{}});t.ajax({url:"http://friend.renren.com/recommendSelector.do",type:"post",cache:!0,dataType:"text",data:"p="+i,success:function(e){n.call(r,t.parseJSON(e))},error:function(e){console.log("失败")}})},searchGroupData:function(e,n,r,i){var s;n==="全部好友"?s="all":s="normal",t.ajax
({url:"http://friend.renren.com/friends/api/searchgroupdata?t="+Math.random(),type:"post",dataType:"text",data:"p=[{'t':'people','data':'"+e+"'},{'t':'gid','data':'"+n+"'},{'t':'gtype','data':'"+s+"'}]",success:function(e){r.call(i,t.parseJSON(e))}})},setFocus:function(e,n,r,i){t.ajax({url:"http://www.renren.com/relationFeedOper.do?action="+e,type:"post",data:"id="+n,dataType:"text",success:function(e){}})}};t.widget("renren.specialManage",{options:{specialUList:[],submit:function(e){}},_create:function(){var e=this,i=t(n.render(r.Templ.mamageContent));this._dialog=t.ui.dialog({title:"特别关注成员管理",dialogClass:"special-management",show:!1,width:610,buttons:[{text:"取消",click:function(){var e=t(this).dialog("instance");e._trigger("cancel"),e.close()}},{text:"确认","class":"ui-button-blue",click:function(){var e=t(this).dialog("instance"),n=e._trigger("confirm")}}],confirm:function(){e.addHight()},cancel:function(){e._destroy()},close:function(){e._destroy()}},i),this.dialog=t(".special-management"),this.initData(),this._events()},_init:function(){},_events:function(){var e=this;this.dialog.on("click",".a-group",function(){if(t(this).hasClass(".actived"))return;e.groupList.find(".actived").removeClass("actived"),t(this).addClass("actived"),e.getSpecificGroup(t(this).html(),t(this).attr("data-map"))}),this.dialog.on("click",".a-friend",function(){t(this).toggleClass("selected");var i=t(this).children("p").html(),s=t(this).attr("data-uid"),o=t(this).children("img").attr("src");t(this).hasClass("selected")?(t(n.render(r.Templ.singleActivedItem,{uId:s,uName:i,uTiny:o})).appendTo(e.activedUList),e.activedCount++):(e.activedUList.find(".a-selected[data-uid="+s+"]").remove(),e.activedCount--),e.isSelectAll(),e.isMaxCount(),e.activedShower.html(e.activedCount)}),this.dialog.on("click",".a-selected i",function(){var n=t(this).parent(".a-selected").attr("data-uid");t(this).parent(".a-selected").remove(),e.showUList.find(".a-friend[data-uid="+n+"]").removeClass("selected"),e.activedCount--,e.isSelectAll(),e.isMaxCount(),e.activedShower.html(e.activedCount)}),this.dialog.on("keyup",".search-friend",function(){var n=t(this).val();e.searchFirends(n)}),this.dialog.on("click",".select-all a",function(){t(this).toggleClass("checked"),t(this).hasClass("checked")?e.checkAll():e.clearAll()}),this.dialog.on("click",".clear-data",function(){e.cleanUp(),e.isSelectAll(),e.isMaxCount()})},_destroy:function(){this.dialog.remove()},initData:function(){var e=this;this.feedList=t("#feed-list"),this.gListCont=this.dialog.find(".glist-container"),this.groupList=this.dialog.find(".group-list ul"),this.activedUListCont=this.dialog.find(".actived-container"),this.activedUList=this.dialog.find(".select-list-container"),this.showUListCont=this.dialog.find(".detail-container"),this.showUList=this.dialog.find(".show-list-container .list-detail"),this.searchInput=this.dialog.find(".search-friend"),this.activedShower=this.dialog.find(".select-tips .selected"),this.errorTips=this.dialog.find(".select-tips .error-tips"),this.msgCon=this.dialog.find(".select-tips .count-msg"),this.checkAllBtn=this.dialog.find(".select-all a"),this.canSubmit=!0,this.activedCount=this.options.specialUList.length,this.initActivedData(),this.searchInput.placeholder({text:"搜索好友"}),s.getAllData(function(t){e.renderGroupList(t)})},initActivedData:function(){this.activedShower.html(this.activedCount);for(var e=0;e<this.activedCount;e++)t(n.render(r.Templ.singleActivedItem,this.options.specialUList[e])).appendTo(this.activedUList)},renderGroupList:function(e){var t=e.groups,i="";for(var s=0;s<t.length+1;s++)s===0?i+=n.render(r.Templ.groupListItem,{groupName:"全部好友",mapCount:s}):i+=n.render(r.Templ.groupListItem,{groupName:t[s-1],mapCount:s});this.groupList.html(i),this.renderSpecificGroup(e,-1),this.activedGroupName="全部好友",this.addScollBar(this.groupList,this.gListCont,223)},getSpecificGroup:function(e,t){var n=this;s.getSpecificData(e,function(r){n.activedGroupName=e,n.renderSpecificGroup(r,t)})},renderSpecificGroup:function(e,i){var s=e.candidate,o="",u,a=[],f=this.activedUList.find("a");for(u=0;u<f.length;u++)a.push(t(f[u]).attr("data-uid"));for(u=0;u<s.length;u++)t.inArray(s[u].id.toString(),a)!=-1?o+=n.render(r.Templ.singleUserItem,{userTiny:s[u].head,userId:s[u].id,userName:s[u].name,selected:"selected"}):o+=n.render(r.Templ.singleUserItem,{userTiny:s[u].head,userId:s[u].id,userName:s[u].name,selected:""});i==-1?this.groupList.find(".a-group:eq(0)").addClass("actived"):(this.groupList.find(".actived").removeClass("actived"),this.groupList.find("a[data-map="+i+"]").addClass("actived"),this.searchFirends(this.searchInput.val())),this.showUList.html(o),this.isSelectAll(),this.isMaxCount(),this.addScollBar(this.showUList,this.showUListCont,223),t(".a-friend img").lazyload()},searchFirends:function(e){var t=this;s.searchGroupData(e,t.activedGroupName,function(n){t.showUList.find(".a-friend").addClass("hidden");var r=n.data;if(r.length>0)for(var i=0;i<r.length;i++)t.showUList.find(".a-friend[data-uid="+r[i].fid+"]").removeClass("hidden");e.trim()===""&&t.showUList.find(".a-friend").removeClass("hidden"),t.isSelectAll(),t.isMaxCount(),t.addScollBar(t.showUList,t.showUListCont,223)})},checkAll:function(){var e=this.showUList.find(".a-friend").not(".hidden").not(".selected");e.addClass("selected");for(var i=0;i<e.length;i++)t(n.render(r.Templ.singleActivedItem,{uId:t(e[i]).attr("data-uid"),uName:t(e[i]).children("p").html(),uTiny:t(e[i]).children("img").attr("src")})).appendTo(this.activedUList),this.activedCount++;this.activedShower.html(this.activedCount),this.isMaxCount()},clearAll:function(){var e=this.showUList.find(".selected").not(".hidden");for(var n=0;n<e.length;n++)this.activedUList.find("a[data-uid="+t(e[n]).attr("data-uid")+"]").remove();this.showUList.find(".selected").removeClass("selected"),this.activedCount=this.activedUList.find("a").length,this.activedShower.html(this.activedCount),this.isMaxCount()},isSelectAll:function(){this.showUList.find(".selected").not(".hidden").length===this.showUList.find(".a-friend").not(".hidden").length&&this.showUList.find(".selected").not(".hidden").length!==0?this.checkAllBtn.addClass("checked"):this.checkAllBtn.removeClass("checked")},isMaxCount:function(){this.activedCount>20?(this.msgCon.addClass("error-msg"),this.errorTips.show(),this.canSubmit=!1):(this.msgCon.removeClass("error-msg"),this.errorTips.hide(),this.canSubmit=!0),this.addScollBar(this.activedUList,this.activedUListCont,67)},cleanUp:function(){this.showUList.find(".selected").removeClass("selected"),this.activedUList.html(""),this.searchInput.val(""),this.searchFirends(""),this.activedCount=0,this.activedShower.html(this.activedCount),this.isMaxCount()},addScollBar:function(e,n,r){e.height()>r?n.scrollbar({minScrollbarLength:1,wheelSpeed:20,stopBubble:!0,scroll:function(){t.fn.lazyload.update()}}):n.scrollbar({destroy:"destroy"})},addHight:function(){if(this.canSubmit){var e=this.activedUList.find(".a-selected"),n=[];for(var r=0;r<this.options.specialUList.length;r++)s.setFocus("delHigh",this.options.specialUList[r].uId);for(var i=0;i<e.length;i++)s.setFocus("addHigh",t(e[i]).attr("data-uid")),n.push({id:t(e[i]).attr("data-uid"),name:t(e[i]).children("span").html(),head:t(e[i]).attr("data-utiny")});this.feedList.html(""),t(nx.data.feed).trigger("groupFocus"),this.options.submit(n),this._destroy()}else t.dialog.alert("已达到20人数上限")}})}),define("newsfeed/similarFeed",["exports","jquery","newsfeed/feed"],function(e,t){var n={getData:function(e,n,r){t.ajax({url:"http://www.renren.com/getavatars.do",type:"get",dataType:"text",data:"uids="+e,success:function(e){n.call(r,t.parseJSON(e))}})},getFeedById:function(e,n,r){t.ajax({url:"http://www.renren.com/requestfeedbyid.do",type:"post",data:"id="+e+"&view=10",dataType:"text",success:function(e){n.call(r,e)}})}},r=function(e){this.feedIds=e.otherIds,this.defaultId=e.defaultId,this.init()};r.prototype={init:function(){var e=this;n.getFeedById(this.feedIds,function(n){t(nx.data.feed).trigger("feedRecieved",{data:n,insertType:"similarAppend",type:"",selfFid:e.defaultId})})}};var i=function(e){this.feedList=t("#feed-list"),this.similarFeedId=e.feedId,this.article=t("#"+e.feedId),this.feedsData=e.moreData,this.header=this.article.find(".header"),this.defaultUser=this.header.find(".user-avatar"),this.defaultUid=this.defaultUser.find(".avatar").attr("namecard"),this.hasSwitched=0,this.activedIcon='<i class="similar-feed-icon show-icon"></i>',this.uids=new Array,this.defaultFid=new Array,this.init()};i.prototype={init:function(){this.header.addClass("over-hidden").find(".feed-tool").hide(),this.header.find(".feed-action-info").hide(),this.getIds(),this.getAvatars()},getAvatars:function(){var e=this;n.getData(this.uids.toString(),function(n){t(e.getUList(n)).appendTo(e.header),e.setParams(),e.events(),e.addActionBar(e.similarFeedId),e.similarFeedCon.hide(),e.similarFeedCon.fadeIn(200,function(){e.canSwitchTime>0&&e.similarFeedCon.find(".default-user img").show(),e.defaultUser.find("a:eq(0)").attr("href","javascript:;").removeAttr("target").addClass("avatar-first"),t(e.activedIcon).appendTo(e.defaultUser.find(".avatar")),e.defaultFid.length>0&&new r({otherIds:e.defaultFid.toString(),defaultId:e.similarFeedId})})})},getIds:function(){for(var e=0;e<this.feedsData.length;e++){var n=t.inArray(this.feedsData[e].actor,this.uids);this.feedsData[e].actor!=this.defaultUid&&n==-1&&this.uids.push(this.feedsData[e].actor)}},setParams:function(){this.similarFeedCon=this.article.find(".similar-ulist-container"),this.nextBtn=this.similarFeedCon.find(".next-cont"),this.preBtn=this.similarFeedCon.find(".pre-cont"),this.avatarList=this.similarFeedCon.find("ul"),this.canSwitchTime>0&&this.nextBtn.show();for(var e=0;e<this.feedsData.length;e++)if(this.feedsData[e].actor==this.defaultUid)this.defaultFid.push(this.feedsData[e].feed);else{var n=t.inArray(this.feedsData[e].actor,this.uids),r=this.avatarList.find("li").eq(n).find("a");r.attr("data-similar-fid")==undefined||r.attr("data-similar-fid")==""?r.attr("data-similar-fid",this.feedsData[e].feed):r.attr("data-similar-fid",r.attr("data-similar-fid")+","+this.feedsData[e].feed)}this.defaultUser.find(".avatar").attr("data-default-id",this.similarFeedId+","+this.defaultFid.toString())},events:function(){var e=this;this.nextBtn.click(function(){e.header.find(".similar-feed-icon").parent(".avatar").length>0&&e.header.find(".similar-feed-icon").hide(),e.hasSwitched<e.canSwitchTime&&(e.hasSwitched=e.hasSwitched+1,e.preBtn.show(),e.hasSwitched==e.canSwitchTime&&e.nextBtn.hide(),e.avatarList.animate({left:0-e.hasSwitched*360+"px"},1e3))}),this.preBtn.click(function(){e.hasSwitched!=0&&(e.hasSwitched=e.hasSwitched-1,e.nextBtn.show(),e.avatarList.animate({left:0-e.canSwitchTime*360+(e.canSwitchTime-e.hasSwitched)*360+"px"},1e3,function(){e.hasSwitched==0&&e.preBtn.hide(),e.header.find(".similar-feed-icon").parent(".avatar").length>0&&e.header.find(".similar-feed-icon").show()}))}),this.avatarList.on("click",".similar-list-avatar",function(){var n=e.header.find(".similar-feed-icon");e.toggleIcon(n,t(this).parent("li")),e.getSimilarData(t(this).attr("data-similar-fid"))}),this.defaultUser.on("click",".avatar-first",function(){var n=e.header.find(".similar-feed-icon");e.toggleIcon(n,t(this)),e.getSimilarData(t(this).attr("data-default-id"))})},getUList:function(e){this.uListLength=e.length,this.canSwitchTime=this.uListLength/6<=1?0:Math.ceil(this.uListLength/6)-1;var t="";for(var n=0;n<this.uListLength;n++)t+='<li><a class="similar-list-avatar" href="javascript:;" namecard="'+e[n].uid+'"><img src="'+(e[n].avatar==""?"http://head.xiaonei.com/photos/0/0/men_tiny.gif":e[n].avatar)+'" width="50">'+this.getVipHats(e[n].hat_id)+"</a>"+this.getVipHatsLink(e[n].hat_id)+"</li>";t='<div class="user-list-container"><ul class="clearfix" style="width:'+(this.uListLength+1)*60+'px">'+t+"</ul></div>";var r=['<div class="similar-ulist-container clearfix">','	<span class="pre-cont"><a href="javascript:;" class="pre-p"></a></span>'+t,'	<span class="next-cont"><a href="javascript:;" class="next-p"></a></span>',"</div>"].join("");return r},toggleIcon:function(e,n){e.length>0&&e.remove(),t(this.activedIcon).appendTo(n)},getSimilarData:function(e){var t=this,i=e.split(","),s;i.length>1?(s=i[0],n.getFeedById(s,function(n){t.exchangeFeed(n);var i=e.substring(e.indexOf(","));new r({otherIds:i,defaultId:s})})):(s=e,n.getFeedById(s,function(e){t.exchangeFeed(e)}))},exchangeFeed:function(e){var n=this.article.attr("id");if(e=="")this.article.find(".feed-content").html('<p class="no-feed-tips">该条新鲜事已删除</p>'),this.article.find(".appendix").html("").hide(),this.article.find(".feed-reply-container").html("").hide(),this.article.find(".own-reply").html("").hide(),this.article.find("div:last").css("display")=="none"&&this.article.find("div:last").html("").hide(),this.setArticleAtr("","");else{var r=t(e),i=r.attr("id"),s=r.find(".user-avatar").attr("data-stype");this.article.find(".feed-content").replaceWith(r.find(".feed-content")).show(),this.article.find(".appendix").replaceWith(r.find(".appendix")).show(),this.article.find(".feed-reply-container").replaceWith(r.find(".feed-reply-container")).show(),this.article.find(".own-reply").replaceWith(r.find(".own-reply")).show(),this.article.find("div:last").css("display")=="none"&&r.find("div:last").css("display")=="none"&&this.article.find("div:last").replaceWith(r.find("div:last")).show(),this.setArticleAtr(i,s),this.addActionBar(i),t(nx.data.feed).trigger("feedRecieved",{data:this.article.get(0),insertType:"similarReplace"})}this.rmPrevFeeds(n),this.article.newsfeedfeed("destroy").newsfeedfeed()},rmPrevFeeds:function(e){e!=""&&t(".bd-content").find(".linkage-for-"+e).remove()},getVipHats:function(e){if(e=="0")return"";var t="<div style=\"display:block;width:58px;height:33px;position:absolute;top:-8px;left:0px;background:url('http://s.xnimg.cn/xnapp/vip/resimg/viphat/"+e+"/hat.png') no-repeat;_background:none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=noscale, src='http://s.xnimg.cn/xnapp/vip/resimg/viphat/"+e+'/hat.png\');" class="hats"></div>';return t},getVipHatsLink:function(e){if(e=="0")return"";var t='<a target="_blank" href="http://i.renren.com/store/hat/home" title="点击美化小头像" style="cursor:pointer;position:absolute;left:25px;top:-8px;display:block;width:33px;height:33px;text-indent:-9999em;outline:0 none;">点击美化小头像</a>';return t},addActionBar:function(e){if(t.parseJSON(t("#get-params-for-"+e).html()).no_desc=="1"){var n=t(this.article.find(".header .feed-action-info p"));n.insertAfter(this.article.find(".header")).addClass("similar-feed-desc").html(n.text().substring(0,n.text().indexOf("-")))}else this.article.find(".similar-feed-desc").remove()},setArticleAtr:function(e,t){this.article.attr("id",e),this.article.find(".user-avatar").attr("data-stype",t)}},e.SameActorFeed=r,e.SimilarFeed=i}),define("newsfeed/feedSort",function(require,e){require("ui/tooltip");var t=jQuery.noConflict(),n=require("newsfeed/tools"),r=require("newsfeed/doubleCols"),i={setOrder:function(e,n,r){t.ajax({url:"http://www.renren.com/feed_setting/set_order",type:"post",data:"feed_order="+e,dataType:"text",success:function(){n.call(r)}})},setViewPort:function(e,n,r){t.ajax({url:"http://www.renren.com/feed_setting/setFeedShow",type:"post",data:"feedType="+e,dataType:"text",success:function(e){n.call(r)}})}},s=function(){var e=t("#frameFixedNav .feed-sort");this.sortBtn=e.find(".setting-btn"),this.sortList=e.find("ul"),this.splitIcon=t(".fd-nav-list .split-icon"),nx.user.isvip,nx.data.isDoubleFeed?this.sortList.find(".double-cols").addClass("checked"):this.sortList.find(".single-col").addClass("checked"),this.initDialog(),this.events()};s.prototype={events:function(){var e=this;this.sortBtn.on("click",function(){e.sortList.show()}),this.sortList.on("click","li",function(s){if(t(this).hasClass("checked"))return e.sortList.hide(),!1;t(this).hasClass("by-smart")?i.setOrder("false",function(){t(nx.data.feed).trigger("sortBySmart"),t.dialog.systemTips("新鲜事已为智能排序")}):t(this).hasClass("by-time")?i.setOrder("true",function(){t(nx.data.feed).trigger("sortByTime"),t.dialog.systemTips("新鲜事已为时间排序")}):t(this).hasClass("single-col")?(i.setViewPort("off",function(){nx.data.isDoubleFeed=!1,r.changeCols(s,"single"),t.dialog.systemTips("已切换单栏浏览模式"),t(".none-feed").length?n.btnFactory(2):t(".a-feed").length&&n.btnFactory(1),t(".a-feed").length&&n.btnFactory(4)}),t("#mergeModule").before(t("#huatiBox")),t("#huatiBoxIn").remove(),t.renren.huati({column:"single",amount:1,listWidth:224})):t(this).hasClass("double-cols")&&(i.setViewPort("on",function(){nx.data.isDoubleFeed=!0,r.changeCols(s,"double"),t.dialog.systemTips("已切换双栏浏览模式"),t(".none-feed").length?n.btnFactory(2):t(".a-feed").length&&setTimeout(function(){n.btnFactory(1)},500),t(".a-feed").length&&n.btnFactory(4),t(".bd-publisher").find("div").length?(t(".new-feed-tip").length&&!t(".new-feed-tip").hasClass("pubTip")&&t(".new-feed-tip").addClass("pubTip"),t("#missed-feed-tips").length&&!t("#missed-feed-tips").hasClass("pubTip")&&t("#missed-feed-tips").addClass("pubTip")):(t(".new-feed-tip").length&&t(".new-feed-tip").removeClass("pubTip"),t("#missed-feed-tips").length&&t("#missed-feed-tips").removeClass("pubTip"))}),t("#huatiBoxIn").remove(),t.renren.huati({column:"double",amount:1,listWidth:424})),e.exchangeClass(t(this))}),t(".fd-nav-list").on("click","a",function(){t(this).html().trim()!=="新鲜事"&&t(this).parents(".feed-sort").length==0&&t(this).hasClass("fd-nav-gName-label")==0&&t(this).hasClass("fd-nav-gName")==0&&(e.sortBtn.hide(),e.splitIcon.hide())}),t("body").on("click",function(n){t(n.target).parents(".sort-setting").length==0&&t(n.target).hasClass("setting-btn")==0&&e.sortList.hide()})},exchangeClass:function(e){if(e.hasClass("by-smart")||e.hasClass("by-time"))this.sortList.find(".checked").not(".single-col").not(".double-cols").removeClass("checked"),e.addClass("checked"),this.sortList.hide();else if(e.hasClass("single-col")||e.hasClass("double-cols"))this.sortList.find(".checked").not(".by-smart").not(".by-time").removeClass("checked"),e.addClass("checked"),this.sortList.hide()},initDialog:function(){t.widget("dialog.systemTips",t.ui.dialog,{_createWidget:function(e){this.options.modal=!1,this._super({buttons:[],dialogClass:"newsfeed-dialog-systemTips ui-dialog",width:220,height:33,position:{my:"center",at:"top+110",of:window,collision:"fit",using:function(e){var n=t(this).css(e).offset().top;n<0&&t(this).css("top",e.top-n)}}},"<div><p>"+e+"</p></div>"),this._delay("destroy",2e3)}})}},e.FeedSort=s}),define("newsfeed/Recommend",function(require,e){var t=jQuery.noConflict(),n=require("newsfeed/tools"),r={getRecommendData:function(e,n,r,i,s){t.ajax({url:"http://rcd.renren.com/cwf_nget_newsfeed",type:"post",dataType:"text",data:"type=3G_SOCIALFEEDLOADER&limit="+e+"&p="+n+"&uid="+nx.user.id+"&idlist="+r.toString(),success:function(e){var n=t.parseJSON(e);i.call(s,n)}})}},i=function(e){this.feedArticle=t("#"+e),this.pNum=0,this.shownIdList=[],this.uListContainer=this.feedArticle.find(".action-4-pics"),this.showMoreBtn=this.feedArticle.find(".show-more-action"),this.initAvatar(),this.initIdList(),this.events()};i.prototype={initAvatar:function(){var e=this.feedArticle.find(".action-feed-content img");for(var t=0;t<e.length;t++)n.recommandResize(e[t])},initIdList:function(){var e=this.feedArticle.find(".action-4-pics a");for(var n=0;n<e.length;n++)this.shownIdList.push(t(e[n]).find("a").eq(0).attr("namecard"))},events:function(){var e=this;this.feedArticle.on("click",".show-more-action",function(){e.showMoreItem(t(this))})},showMoreItem:function(e){var i=this;if(this.pNum===2)return;this.pNum=this.pNum+1,r.getRecommendData(8,this.pNum,this.shownIdList,function(e){if(e.code&&e.code==-1)i.changeMoreBtn();else{var r=e.explanations;if(r.length>0){var s="";for(var o=0;o<r.length;o++)t(i.actionModule(r[o])).appendTo(i.uListContainer),n.recommandResize(i.feedArticle.find(".action-4-pics a:eq("+(o+4)+") img").get(0));(i.pNum==2||r.length<8)&&i.changeMoreBtn()}else i.changeMoreBtn()}})},changeMoreBtn:function(){this.showMoreBtn.attr("href","http://friend.renren.com/managefriends").attr("target","_blank").text("寻找更多可能认识的人")},actionModule:function(e){var t=['	<a href="http://www.renren.com/profile.do?id='+e.id+'" namecard="'+e.id+'" target="_blank">','		<img src="'+e.main_url+'">',"		<span>"+e.name+"</span>","	</a>"].join("");return t}},e.Recommend=i}),define("newsfeed/mvideo",["jquery","exports"],function(e,t){var n=function(e){this.feedId=e,require(["ui/renren/mvideo"],this.init.bind(this))};n.prototype.init=function(){var t=e("#"+this.feedId).find(".micro-video-content"),n=t.prop("href").match(/\d+/g),r=430;e(".double-cols-feed").length&&(r=410),t.renrenmvideo({width:r,height:r,screenshot:t.find("img").prop("src"),ownerId:n[0],videoId:n[1]}),e(document).on("newsfeed:single.newsfeed_mvideo",function(){t.renrenmvideo("option",{width:430,height:430})}),e(document).on("newsfeed:double.newsfeed_mvideo",function(){t.renrenmvideo("option",{width:410,height:410})}),this.ms=t},n.prototype.destroy=function(){this.ms&&e(document).off(".newsfeed_mvideo")},t.MVideo=n}),define("newsfeed/photo",function(require,e){var t=jQuery.noConflict(),n=require("newsfeed/tools"),r={getOriginalPhoto:function(e,n,r,i){t.ajax({url:"http://photo.renren.com/photo/"+e+"/album-"+n+"/photoFeed/v7",type:"get",dataType:"text",success:function(e){var n=t.parseJSON(e);n.code===0?r.call(i,n):t.dialog.alert(n.msg)}})},getSharePhotoData:function(e,n,r,i,s){t.ajax({url:"http://photo.renren.com/photo/"+e+"/album-"+n+"/sharePhotoFeed/v7?photoId="+r,type:"get",dataType:"text",success:function(e){var n=t.parseJSON(e);n.code===0?i.call(s,n):t.dialog.alert(n.msg)}})}},i=function(e){this.feedId=e,this.article=t("#"+e),this.showMoreBtn=this.article.find(".show-more-pic"),this.resizePhoto(),this.showMoreBtn.length>0&&this.events()};i.prototype={resizePhoto:function(){var e=this.article.find(".cursor-all img").not(".photo-content-1 img");n.imgRelocation(this.feedId,e)},events:function(){var e=this;this.showMoreBtn.click(function(){e.showMorePic()})},showMorePic:function(e){var n=this;if(this.article.find(".photo-content-more").length>0){var i=t.parseJSON(this.article.find(".appendix .like").attr("data-like")),s=i.sourceId,o=i.owner;r.getOriginalPhoto(o,s,function(e){var t=e.data,r=n.article.find(".photo-content-more");n.handlePic(t,r,6,"original")})}else if(this.article.find(".album-imgs-more").length>0){var u=n.showMoreBtn.attr("data-more"),a=n.showMoreBtn.attr("data-albumId"),f=n.showMoreBtn.attr("data-owner");r.getSharePhotoData(f,a,u,function(e){var t=e.data,r=n.showMoreBtn.parent(".album-imgs-more"),i=r.find(".cursor-all:eq(0)").attr("href");n.handlePic(t,r,0,"share",i)})}},handlePic:function(e,n,r,i,s){var o=e.length>12?12:e.length,u="",a="";for(var f=r;f<o;f++)if(e[f]!=""){if(e[f].largeUrl.indexOf("gif")!=-1||e[f].largeUrl.indexOf("GIF")!=-1)a='<i class="icon">GIF图</i>',e[f].showUrl=e[f].showUrl+".jpg";else switch(e[f].isFullOrLong){case 0:a="";break;case 1:a='<i class="icon">全景图</i>';break;case 2:a='<i class="icon">长图</i>'}i=="original"?f==7||f==10?u+="<a href='#nogo' class='cursor-all clearfix middle-p'><img src="+e[f].showUrl+' data-viewer = \'{"type":"photo","owner":"'+e[f].owner+'","id":"'+e[f].id+'","url":"'+e[f].largeUrl+'","width":'+e[f].width+',"height":'+e[f].height+"}'>"+a+"</a>":u+="<a href='#nogo' class='cursor-all clearfix'><img src="+e[f].showUrl+' data-viewer = \'{"type":"photo","owner":"'+e[f].owner+'","id":"'+e[f].id+'","url":"'+e[f].largeUrl+'","width":'+e[f].width+',"height":'+e[f].height+"}'>"+a+"</a>":i=="share"&&(f==1||f==4?u+="<a href='"+s+"' target = '_blank' class='cursor-all clearfix middle-p'><img src="+e[f].showUrl+">"+a+"</a>":u+="<a href='"+s+"' target = '_blank' class='cursor-all clearfix'><img src="+e[f].showUrl+">"+a+"</a>")}this.showMoreBtn.hide(),t(u).appendTo(n),this.resizePhoto()}},e.multiPhoto=i}),define("newsfeed/voice",function(require,e){var t=jQuery.noConflict(),n=require("newsfeed/tools"),r=function(e,n){this.feedArticle=t("#"+e),this.feedStype=n,this.resizeVocalImg(),this.events()};r.prototype={events:function(){this.feedArticle.on("mouseover",".vocal-btn",function(){if(this.playerInited)return;this.playerInited=!0;if(t(this).parents(".feed-content").length>0)var e=t(this).parents(".feed-content").find(".vocal-player");else var e=t(this).parents(".photo-feed-content").find(".vocal-player");var n=e.data("vocal");t.renren.vocalPlayer(n,e)}),this.feedArticle.on("click",".vocal-btn",function(){t(this).hide();if(t(this).parents(".feed-content").length>0)var e=t(this).parents(".feed-content").find(".vocal-player");else var e=t(this).parents(".photo-feed-content").find(".vocal-player");e.css("display","block"),e.trigger("click")})},resizeVocalImg:function(){var e=this.feedArticle.find(".feed-content").length>0?this.feedArticle.find(".feed-content .vocal-player"):this.feedArticle.find(".photo-feed-content .vocal-player"),t=this.feedArticle.find(".feed-content").length>0?this.feedArticle.find(".feed-content .vocal-player .count"):this.feedArticle.find(".photo-feed-content .vocal-player .count"),r=this.feedArticle.find(".vocal-btn"),i;switch(this.feedStype){case"103":i=this.feedArticle.find(".share-photo img");break;case"701":i=this.feedArticle.find(".photo-feed-pic1");break;case"2004":i=this.feedArticle.find(".share-photo img")}n.vocalResize(i,e,t,r,this.feedStype)}},e.Voice=r}),define("newsfeed/logerFactory",function(require,e){var t=jQuery.noConflict();t.widget("newsfeed.logerFactory",{options:{logUrl:"",logData:"",logType:"",logSelector:"",limitTime:3e4,packageNum:30,cleanData:function(){},getData:function(){},cultCount:function(){console.log("XXX"),this.timeSendData()}},_create:function(){this.logUrl=this.options.logUrl,this.logSelector=this.options.logSelector,this.logType=this.options.logType,this.logType==="time"?(this.limitTime=this.options.limitTime,this.timer(),this.timeEvents()):this.logType==="sendLog"?this.timeSendData():(this.packageNum=this.options.packageNum,this.logCount=0,this.bindClickEvent())},_init:function(){},_destroy:function(){},timeEvents:function(){var e=this;t(window).on("unload",function(){e.timeSendData()})},timeSendData:function(){if(this.options.getData()=="")return;var e=this.logUrl+"?"+this.options.getData();try{this.sendStats(e),this.options.cleanData()}catch(t){console.log("新鲜事log请求有问题")}},timer:function(){var e=this;setInterval(function(){if(this.options.getData()=="")return;var e=this.logUrl+"?"+this.options.getData();try{this.sendStats(e),this.options.cleanData()}catch(t){console.log("新鲜事log请求有问题")}},this.limitTime)},bindClickEvent:function(){var e=this;if(this.logSelector=="")return;t(document).on("click",this.logSelector,function(){if(this.packageNum!=undefined){this.logCount=this.logCount+1;if(this.logCount==this.packageNum)if(e.options.getData!=""){var t=e.logUrl+"?"+e.options.getData();e.sendStats(t),e.cleanData()}else{var t=e.logUrl+"?"+e.logData;e.sendStats(t)}}else{var t=e.logUrl+"?"+e.logData;e.sendStats(t)}})},sendStats:function(e){var t="log_"+(new Date).getTime(),n=window[t]=new Image;n.onload=n.onerror=function(){window[t]=null},n.src=e,n=null}})}),define("newsfeed/log",function(require,e){var t=jQuery.noConflict(),n=require("newsfeed/tools"),r=function(){this.feedList=t("#feed-list"),this.nav=t("#frameFixedNav"),this.rightMenu=t(".nx-right"),this.initParams(),this.events(),this.timer()};r.prototype={initParams:function(){this.pvLog="",this.clickLog="",this.replyLog="",this.likeLog="",this.readLog="",this.shareLog="",this.blockLog="",this.actionLog="",this.atLog="",this.cultCount=0},recordPvLog:function(e,t){var n="",r="1";t=="similarFeed"&&(r="2");for(var i=0;i<e.length;i++){var s=this.getLogData(e[i]);n+=",0,"+s.exposeTime+","+nx.user.id+",,"+e[i]+","+s.feedOwnerId+","+s.feedStype+","+s.indexNum+","+s.createTime+","+s.platForm+","+nx.data.feed.pvTab+","+r+","+(new Date).getTime()+",0,,,"+s.privacyLog+",",s=null,i<e.length-1&&(n+="|")}this.pvLog=this.pvLog==""?n:this.pvLog+"|"+n,this.sendLog()},recordReplyLog:function(e,t){var n="",r="",i=this.getLogData(e);t==""?r=i.feedOwnerId:r=t,n=",2,"+(new Date).getTime()+","+i.exposeTime+","+nx.user.id+",,"+e+","+i.feedOwnerId+","+i.feedStype+","+i.indexNum+","+i.createTime+","+i.platForm+","+nx.data.feed.pvTab+",1,0,0,"+r+",",this.replyLog=this.replyLog==""?n:this.replyLog+"|"+n,this.checkCount()},recordShareLog:function(e){var t="",n=this.getLogData(e);t=",3,"+(new Date).getTime()+","+n.exposeTime+","+nx.user.id+",,"+e+","+n.feedOwnerId+","+n.feedStype+","+n.indexNum+","+n.createTime+","+n.platForm+","+nx.data.feed.pvTab+",1,0,0,,"+n.original_source+","+n.original_actor+",",this.shareLog=this.shareLog==""?t:this.shareLog+"|"+t,this.checkCount()},recordLikeLog:function(e,t,n){var r="",i=this.getLogData(e);r=","+t+","+(new Date).getTime()+","+i.exposeTime+","+nx.user.id+",,"+e+","+i.feedOwnerId+","+i.feedStype+","+i.indexNum+","+i.createTime+","+i.platForm+","+nx.data.feed.pvTab+",1,0,0,"+n+",",this.likeLog=this.likeLog==""?r:this.likeLog+"|"+r,this.checkCount()},recordReadLog:function(e){var t="",n=this.getLogData(e);t=",7,"+(new Date).getTime()+","+n.exposeTime+","+nx.user.id+",,"+e+","+n.feedOwnerId+","+n.feedStype+","+n.indexNum+","+n.createTime+","+n.platForm+","+nx.data.feed.pvTab+",1,0,0,",this.readLog=this.readLog==""?t:this.readLog+"|"+t,this.checkCount()},recordBlockLog:function(e,t){var n="",r=this.getLogData(e);n=","+t+","+(new Date).getTime()+","+r.exposeTime+","+nx.user.id+",,"+e+","+r.feedOwnerId+","+r.feedStype+","+r.indexNum+","+r.createTime+","+r.platForm+","+nx.data.feed.pvTab+",1,0,0,,user,"+r.feedOwnerId+",",this.blockLog=this.blockLog==""?n:this.blockLog+"|"+n,this.checkCount()},recordAtLog:function(e,t){var n="";n=","+(new Date).getTime()+","+nx.user.id+","+e+","+t+","+"0"+",",this.atLog=this.atLog==""?n:this.atLog+"|"+n,this.checkCount()},recordActionLog:function(e){var t="";t=","+(new Date).getTime()+","+nx.user.id+","+e+",,0,",this.actionLog=this.actionLog==""?t:this.actionLog+"|"+t,this.checkCount()},checkCount:function(){this.cultCount++,this.cultCount>=15&&this.sendLog()},events:function(){var e=this;t(nx.data.feed).on("feedRendered",function(t,n){var r=n.ids,i=n.type;e.recordPvLog(r,i)}),t(nx.data.feed).on("replyAdded",function(t,n){e.recordReplyLog(n.feedId,n.replyTo)}),this.feedList.on("click",".share",function(){var n=t(this).parents(".a-feed").attr("id");e.recordShareLog(n)}),this.feedList.on("click",".like, .trigger-like-comment",function(){var n="5",r="1";t(this).hasClass("liked")&&(n="6"),t(this).hasClass("trigger-like-comment")&&(r="2");var i=t(this).parents(".a-feed").attr("id");e.recordLikeLog(i,n,r)}),this.feedList.on("click",".feed-hide",function(){var n=t(this).parents(".a-feed").attr("id");e.recordReadLog(n)}),this.feedList.on("click",".feed-block-user",function(){var n=t(this).parents(".a-feed").attr("id");e.recordBlockLog(n,"8")}),this.feedList.on("click",".feed-focus-user",function(){var n=t(this).parents(".a-feed").attr("id");e.recordBlockLog(n,"9")}),t(nx.data.feed).on("replyAdded",function(t,n){var r=n.atlog,i=n.stype;e.recordAtLog(r,i)}),this.nav.on("click",".fd-nav-item:eq(0) a",function(){e.recordActionLog("11")}),this.nav.on("click",".friends-original",function(){e.recordActionLog("12")}),this.nav.on("click",".content-focus",function(){e.recordActionLog("13")}),this.nav.on("click",".group-focus",function(){e.recordActionLog("14")}),this.nav.on("click",".nf-group-item a",function(){e.recordActionLog("15")}),this.rightMenu.on("click",".sort-type",function(){t(this).attr("data-type")=="0"?e.recordActionLog("16"):t(this).attr("data-type")=="20"&&e.recordActionLog("17")}),this.rightMenu.on("click",".btn_follow",function(){e.recordActionLog("18")}),this.rightMenu.on("click",".tool-box",function(){e.recordActionLog("19")}),this.feedList.on("click",".reply",function(){e.recordActionLog("20")}),this.feedList.on("click",".pack-replies span, .pack-replies i, .more-replies span, .more-replies i",function(){if(t(this).parent().hasClass("pack-replies")==1){var n=t(this).parents(".a-feed").attr("id");t("#get-params-for-"+n).length>0&&t.parseJSON(t("#get-params-for-"+n).html()).isUserFeed=="0"&&e.recordActionLog("21")}}),this.feedList.on("click",".feed-setting-item",function(){e.recordActionLog("22")}),this.feedList.on("click",".new-feed-tip a",function(){e.recordActionLog("23")}),t(".refresh-back-to").on("click",function(){e.recordActionLog("24")}),this.feedList.on("click",".feed-action-info a",function(){e.recordActionLog("25")}),this.feedList.on("click",".user-avatar .avatar",function(){e.recordActionLog("26")}),this.feedList.on("click",".a-reply",function(){e.recordActionLog
("27")}),t("#toolBackTo a").eq(0).on("click",function(){e.recordActionLog("28")}),this.feedList.on("click",".get-more-feed",function(){e.recordActionLog("29")}),this.feedList.on("click",".show-more-pic",function(){e.recordActionLog("30")})},getLogData:function(e){var r={},i=t("#"+e),s=i.find(".user-avatar"),o=s.find(".avatar").attr("href");r.exposeTime=n.queryByName("expose_time",o),r.feedOwnerId=n.queryByName("ff_id",o),r.feedStype=n.queryByName("sfet",o),r.indexNum=i.index(),r.createTime=s.attr("data-create-time"),r.platForm=n.queryByName("platform",o),r.privacyLog="",s.attr("original_source")&&(r.original_source=s.attr("original_source")),s.attr("original_actor")&&(r.original_actor=s.attr("original_actor"));var u=s.attr("data-sourcecontrol");return u==undefined?r.privacyLog="1":u==""||u=="99"?r.privacyLog="1":u=="0"?r.privacyLog="3":u=="-1"&&r.privacyLog=="2",r},timer:function(){var e=this;setInterval(function(){if(e.packageSendData()=="")return;try{e.sendLog()}catch(t){console.log("新鲜事log请求有问题")}},3e4)},packageSendData:function(){if(this.pvLog==""&&this.clickLog==""&&this.replyLog==""&&this.likeLog==""&&this.readLog==""&&this.shareLog==""&&this.blockLog==""&&this.actionLog==""&&this.atLog=="")return"";var e="pv="+this.pvLog+"&click="+this.clickLog+"&reply="+this.replyLog+"&like="+this.likeLog+"&read="+this.readLog+"&share="+this.shareLog+"&block="+this.blockLog+"&action="+this.actionLog+"&at="+this.atLog;return e},sendLog:function(){var e=this,t="http://log.feed.renren.com/xfeed/log?"+this.packageSendData();this.sendStats(t),e.pvLog=e.clickLog=e.replyLog=e.likeLog=e.readLog=e.shareLog=e.blockLog=e.actionLog=e.atLog="",this.cultCount=0},sendStats:function(e){var t="log_"+(new Date).getTime(),n=window[t]=new Image;n.onload=n.onerror=function(){window[t]=null},n.src=e,n=null}},e.FeedLoger=r}),define("follow/feed/recommend",function(require,e){var t=require("jquery"),n=require("mustache.js");this.ajaxLoadNum=0;var r=function(e,t,n){var r=this;r.elem=e,r.amount=t,r.itemWidth=n,r.init=function(){r.total=r.elem.find("li").length,r.elem.find("ul").width(r.itemWidth*r.total),r.total<=r.amount&&r.elem.find(".pager-btn").remove(),r.events()},r.init()};r.prototype={events:function(){var e=this,n=e.elem.find(".pager-btn");e.elem.hover(function(){t(this).find(".pager-btn").css("display","inline-block")},function(){t(this).find(".pager-btn").css("display","none")}),e.elem.on("click",".pager-btn",function(){var n=t(this);e.total=e.elem.find("li").length,e.start=parseInt(e.elem.data("start"))||0;if(n.hasClass("forward-disable")||n.hasClass("back-disable"))return!1;n.hasClass("pager-forward")?(e.start=e.start+e.amount,e.start>=e.total-e.amount&&n.addClass("forward-disable"),n.prev().hasClass("back-disable")&&n.prev().removeClass("back-disable")):n.hasClass("pager-back")&&(e.start=e.start-e.amount,e.start==0&&n.addClass("back-disable"),n.next().hasClass("forward-disable")&&n.next().removeClass("forward-disable")),e.elem.data("start",e.start).find("ul").animate({left:-(e.itemWidth*e.start)+"px"},500)}),t(".userhead").on("mouseover",function(e){t(".double-cols-feed").length&&t(this).parent().find(".double-hover").show()}).on("mouseleave",function(e){t(".double-cols-feed").length&&t(this).parent().find(".double-hover").hide()})}},e.init=function(){t.ajax({url:"http://follow.renren.com/recommend/friends/v7",type:"GET",data:"uid="+nx.user.id,dataType:"json",success:function(t){t.code==0&&(e.ajaxLoadNum++,e.followNum=t.data.followInfo.publisherCount,e.userRender(t.data.followInfo),e.recommendRender(t.data.recommendInfo),e.getPageNum(),e.getZhanNum())}})},e.userRender=function(e){e.subscriberCount>0&&e.openFollow&&(e.subStatus=!0),e.publisherCount>0&&(e.pubStatus=!0),e.uid=nx.user.id;var i=['<div class="side-item follow-user-box">','	<div class="side-item-header follow-user-pub">',"		<h4>我关注的</h4>","	</div>",'	<div class="side-item-body user-follow-area clearfix">',"		{{#pubStatus}}",'		<a target="_blank" class="myfollow-person" href="http://follow.renren.com/list/{{uid}}/pub/v7">','			<img class="myfollow-icon" src="http://s.xnimg.cn/nx/newsfeed/res/myfollow-person.png"><span class="myfollow-num">{{publisherCount}}</span><span class="myfollow-text">关注的人</span>',"		</a>","		{{/pubStatus}}","		{{^pubStatus}}",'		<a target="_blank" class="myfollow-person" href="http://follow.renren.com/recommend/v7">','			<div class="default"><span class="myfollow-num">0</span><span class="myfollow-text">关注的人</span></div>','			<div class="hover">发现<br>更多红人</div>',"		</a>","		{{/pubStatus}}",'		<a target="_blank" class="page-pub" href="http://page.renren.com/">','			<div class="default"><span class="myfollow-num">0</span><span class="myfollow-text">公共主页</span></div>','			<div class="hover">发现更多<br>公共主页</div>',"		</a>",'		<a target="_blank" class="user-zhan" href="http://zhan.renren.com/suggest">','			<div class="default"><span class="myfollow-num">0</span><span class="myfollow-text">小站</span></div>','			<div class="hover">发现更多<br>推荐小站</div>',"		</a>","	</div>",'	<div id="fansBox">','		<div class="side-item-header side-item-fans">',"			{{#openFollow}}","			<h4>关注我的<span>{{subscriberCount}}</span></h4>",'			<div class="option">','				<a href="javascript:void(0);" class="pager-btn pager-back back-disable" title="上一页"></a>','				<a href="javascript:void(0);" class="pager-btn pager-forward" title="下一页"></a>','				<a href="http://follow.renren.com/list/{{uid}}/sub/v7" target="_blank" title="查看更多" class="more"></a>',"			</div>","			{{/openFollow}}","			{{^openFollow}}","			<h4>关注我的人<span>0</span></h4>",'			<a class="btn_green border btn_follow_open" href="http://follow.renren.com/promotion/v7" target="_blank">开启关注','				<div class="tip_open">',"					<p>开启专注后，你可以拥有自己的粉丝</p>","					<p>区分好友和粉丝，净化新鲜事！</p>","					<i></i>","				</div>	","			</a>","			{{/openFollow}}","		</div>","		{{#subStatus}}",'		<div class="fans-follow-area">','			<ul class="side-item-info clearfix">',"				{{#subscriberList}}","				<li>",'					<a class="headImg" namecard="{{id}}" href="http://www.renren.com/{{id}}/profile" target="_blank"><img onload="nx.image.resize(this,30,30,\'center\')" src="{{headUrl}}" /></a>',"				</li>","				{{/subscriberList}}","			</ul>","		</div>","		{{/subStatus}}","	</div>","</div>"].join("");t("#follow_right").append(n.to_html(i,e)),t(".double-cols-feed").length?new r(t("#fansBox"),11,38):new r(t("#fansBox"),6,36)},e.recommendRender=function(e){t.each(e.recommendList,function(e,t){t.isAuthed&&(t.subAuthInfo=nx.stringplus.TSubString(t.authDescription,16,"..."),nx.stringplus.Length(t.authDescription)!=nx.stringplus.Length(t.subAuthInfo)&&(t.authinfoHover=!0))});var i=['<div class="side-item">','	<div id="recommendBox">','		<div class="side-item-header clearfix">',"			<h4>关注推荐</h4>",'			<div class="option">','				<a href="javascript:void(0);" class="pager-btn pager-back back-disable" title="上一页"></a>','				<a href="javascript:void(0);" class="pager-btn pager-forward" title="下一页"></a>','				<a href="http://follow.renren.com/recommend/v7" target="_blank" title="更多推荐" class="more"></a>',"			</div>","		</div>",'		<div class="recommend_follow_area">','			<ul class="follow_list clearfix" data-from="0106003">',"				{{#list}}",'				<li class="item_recommend">','					<p class="userhead border" namecard="{{id}}">','						<a class="photo" target="_blank" href="http://www.renren.com/profile.do?id={{id}}">','							<img onload="nx.image.resize(this,100,100,\'center\')" src="{{icon}}" />',"						</a>",'						<a class="double-hover btn_follow follow0" data-uid="{{id}}"></a>','						<span class="username">{{#isAuthed}}<img src="http://a.xnimg.cn/nx/follow/cssimg/authed.png" />{{/isAuthed}}{{name}}</span>',"					</p>","					{{#isAuthed}}","						{{#authinfoHover}}",'						<p class="authinfo" title="{{authDescription}}">{{subAuthInfo}}</p>',"						{{/authinfoHover}}","						{{^authinfoHover}}",'						<p class="authinfo">{{subAuthInfo}}</p>',"						{{/authinfoHover}}","					{{/isAuthed}}","					{{^isAuthed}}",'					<p class="authinfo">{{univName}}</p>',"					{{/isAuthed}}",'					<p class="follow-nums">{{friendFollowCount}}位好友关注</p>','					<a href="javascript:void(0);" class="btn_gray btn_follow border follow0" data-uid="{{id}}"><span class="default">关注</span><span class="hover">关注</span></a>',"				</li>","				{{/list}}","			</ul>","		</div>","	</div>","</div>"].join("");t("#follow_right").append(n.to_html(i,{list:e.recommendList})),t(".double-cols-feed").length?(t(".recommend_follow_area").find("li").find(".userhead").attr("namecard","0"),new r(t("#recommendBox"),4,106)):new r(t("#recommendBox"),2,110)},e.getPageNum=function(){t.ajax({url:"http://page.renren.com/home/myAttentionPages/pagenum",type:"GET",dataType:"json",success:function(n){n.code===0&&(n.data.pagenum>0&&(t("#follow_right .follow-user-box").find(".page-pub").attr("href","http://page.renren.com/home/mypages").html('<img class="myfollow-icon" src="http://s.xnimg.cn/nx/newsfeed/res/myfollow-page.png"><span class="myfollow-num">'+n.data.pagenum+'</span><span class="myfollow-text">公共主页</span>'),e.pageNum=n.data.pagenum),e.ajaxLoadNum++,e.ajaxLoadNum==3&&e.isZero())}})},e.getZhanNum=function(){t.ajax({url:"http://zhan.renren.com/followingsites/count",type:"GET",dataType:"json",success:function(n){n.code==0&&(n.count>0&&t("#follow_right .follow-user-box").find(".user-zhan").attr("href","http://zhan.renren.com/followings").html('<img class="myfollow-icon" src="http://s.xnimg.cn/nx/newsfeed/res/myfollow-zhan.png"><span class="myfollow-num">'+n.count+'</span><span class="myfollow-text">小站</span>'),e.ajaxLoadNum++,e.zhanNum=n.count,e.ajaxLoadNum==3&&e.isZero())}})},e.isZero=function(){e.followNum==0&&e.pageNum==0&&e.zhanNum==0&&(t(".follow-user-box .follow-user-pub").html("<h4>我关注的<span>0</span></h4>"),t(".follow-user-box .user-follow-area").remove())}}),define("follow/feed/focusFilter",function(require,e){var t=jQuery.noConflict(),n=function(){this.feedList=t("#feed-list"),this.rightMenu=t(".nx-right"),this.init()};n.prototype={init:function(){var e=this.filterModule();t("#focus-filter").length>0&&(t("#focus-filter").remove(),t("#follow_right").remove()),this.rightMenu.find(".advert-box").length>0?t(e).insertAfter(t("#mergeModule")):t(e).appendTo(this.rightMenu),this.initParam()},initParam:function(){this.filterList=t("#focus-filter"),this.showBtn=this.filterList.find(".more-btn"),this.showMoreBtn="<i class='up'></i><i class='down'></i>",this.preventFlag=!0,this.bindEvents()},bindEvents:function(){var e=this;this.showBtn.on("click",function(){t(this).hasClass("hidden-btn")&&e.packFilterMenu()}),this.filterList.on("click",".sort-type",function(){var n=e.filterList.find(".actived");e.preventFlag?e.showFilterMenu():t(this).hasClass("actived")?e.packFilterMenu():(n.removeClass("actived"),t(this).addClass("actived"),e.packFilterMenu(t(this).attr("data-type")))})},packFilterMenu:function(e){var n=this,r=0;this.filterList.find("a").not(".actived").slideUp("fast",function(){r+=1,e!==null&&e!==undefined&&n.triggerFilter(r,e)}),this.filterList.find("a").not(".actived").addClass("hidden-item"),t(this.showMoreBtn).appendTo(this.filterList.find(".actived")),this.preventFlag=!0},showFilterMenu:function(){this.filterList.find(".hidden-item").slideDown("fast"),this.filterList.find(".hidden-item").removeClass("hidden-item"),this.filterList.find(".actived i").remove(),this.preventFlag=!1},triggerFilter:function(e,n){e===3&&t(nx.data.feed).trigger("contentFocus",{type:n})},filterModule:function(){var e=['<div id="focus-filter" class="side-item">',"	<ul>","		<li>",'			<a href="javascript:;" class="sort-type actived" data-type="1">','				关注内容<i class="up"></i><i class="down"></i>',"			</a>","		</li>","		<li>",'			<a href="javascript:;" class="sort-type hidden-item" style="display:none;" data-type="0">',"				人的新鲜事","			</a>","		</li>","		<li>",'			<a href="javascript:;" class="sort-type hidden-item" style="display:none;" data-type="20">',"				公共主页的新鲜事","			</a>","		</li>","		<li>",'			<a href="javascript:;" class="more-btn hidden-btn hidden-item" style="display:none;">',"				<i></i>","			</a>","		</li>","	</ul>","</div>",'<div id="follow_right"></div>'].join("");return e}},e.focusFilter=n}),require(["jquery"],function(e){e(function(){define(function(require,t){require("app/publisher");var n=e(".bd-publisher"),r=e(".bd-content"),i=e(".nx-content",r),s=e(".nx-right",r),o=e("<div>").prependTo(i),u,a,f=nx.browser.name.toLowerCase().match("ie");o.apppublisher({ready:function(){u=o.find(".ui-renren-publisher-avatar"),a=o.find(".triangle")},open:function(){o.find(".textarea-textzone").apptextbox("disable"),n.append(o),u.hide(),a.hide(),s.css({position:"absolute",top:0,right:0}),o.find(".textarea-textzone").velocity({height:o.hasClass("ui-renren-publisher-appstart")?67:127},200,function(){o.css({zIndex:99}).velocity({left:(r.width()-587)/2+70},{easing:nx.browser.msie?"linear":"easeOutBounce",duration:300,complete:function(){u.velocity({opacity:[1,0]},{display:"block",duration:800}),a.velocity({opacity:[1,0]},{display:"block",duration:800}),o.find(".textarea-textzone").apptextbox("enable").apptextbox("focus")}}),s.velocity({top:o.height()+35},{duration:500,complete:function(){s.data("top",s.css("top")),s.css({position:"relative",top:0})}})}),e(".double-cols-feed").length&&(e(".new-feed-tip").length&&!e(".new-feed-tip").hasClass("pubTip")&&e(".new-feed-tip").addClass("pubTip"),e("#missed-feed-tips").length&&!e("#missed-feed-tips").hasClass("pubTip")&&e("#missed-feed-tips").addClass("pubTip"))},close:function(){o.find(".textarea-textzone").velocity({height:45},200,function(){u.hide(),a.hide(),i.prepend(o),o.velocity({left:0},{duration:300,complete:function(){f?o.css({zIndex:"0"}):o.css({zIndex:"auto"})}}),s.css({position:"absolute",top:s.data("top")}).velocity({top:0},{duration:500,complete:function(){f?s.css({position:"relative",top:"0"}):s.css({position:"static"})}})}),e(".double-cols-feed").length&&(e(".new-feed-tip").length&&e(".new-feed-tip").removeClass("pubTip"),e("#missed-feed-tips").length&&e("#missed-feed-tips").removeClass("pubTip"))}})}),define(function(require,e){require("ui/renren/footprint"),jQuery.renren.footprint()}),require(["ui/renren/recommendFri"],function(){e("#recommendArea").addClass("recommend2").renrenrecommendfri({isDoubleFeed:e(".double-cols-feed").length>0}),e(document).on("newsfeed:single newsfeed:double",function(t){e("#recommendArea").renrenrecommendfri({isDoubleFeed:t.type.indexOf("double")>-1})})}),define(function(require,t){var n="single",r=1,i=224,s=e(".double-cols-feed");if(s.length||nx.data.isDoubleFeed)n="double",r=1,i=424;require("ui/renren/huati"),jQuery.renren.huati({column:n,amount:r,listWidth:i})}),define(function(require,e){var t=require("photo/past");t.init()}),define(function(require,e){var t=require("newsfeed/index");new t.feedIndex}),e("#feed-list img[data-src]").lazyload({instantly:!0})})}),define("ui/showPrivacyFoot",function(require,e){require("ui/dialog"),require("ui/friendSearch");var t=require("mustache.js"),n=!1,r=jQuery.noConflict(),i=2,s={init:function(e){this.successShowDialog(e)},successShowDialog:function(e){var t=this;r.ui.dialog({dialogClass:"privacy-foot",title:"隐身名单",width:505,height:430,buttons:[{text:"取消",click:function(){var e=this;n?r.dialog.confirm("您确认不保存之前的操作，关闭此弹层吗？",function(t){r(e).dialog("destroy")}):r(e).dialog("destroy")}},{text:"确定","class":"ui-button-blue",click:function(){t.save(),r(this).dialog("destroy")}}]}),r.ajax({url:"http://www.renren.com/hiddenfootprint/",type:"get",dataType:"json",abortOnRetry:!0,success:function(e){var n=r.parseJSON(e.hiddenFootprint);t.getNum(n)}})},getNum:function(e){var t=this;r.ajax({url:"http://www.renren.com/hiddenfootprintmanager/generalHiddenFpAssembly",type:"get",dataType:"json",abortOnRetry:!0,success:function(n){var i=n,s=i.HIDDEN_FOOTPRINT_TOALL;t.packlist(e,i),s&&r(".privacy-foot .ui-widget-content #friendselectarea").hide(),t.bindEvents()}})},packlist:function(e,n){var i=n,s={};s.vipMember=i.vipMember,s.hidetotal=i.HIDDEN_FOOTPRINT_TOALL,s.leftnum=i.MAX_FRIENDS-e.length;var o=['<p style="margin-bottom:20px" >','<label for="hiddentype1">','<input type="radio" value="1"',"{{^vipMember}}","disabled=true","{{/vipMember}}","{{#hidetotal}}",'checked="checked"',"{{/hidetotal}}",'name="hiddentype" id="hiddentype1"/>',"<span ","{{^vipMember}}",'style="color:#888;"',"{{/vipMember}}",">设置对全部好友不留脚印</span>","</label>","{{^vipMember}}",'<a href="http://i.renren.com/pay/pre" target="_blank">开通VIP会员即可对所有的好友设置隐身</a>',"{{/vipMember}}","</p>",'<p style="margin-bottom:10px">','<label for="hiddentype2">','<input type="radio" value="2" ',"{{^vipMember}}","checked=true","{{/vipMember}}","{{^hidetotal}}",'checked="checked"',"{{/hidetotal}}",'name="hiddentype" id="hiddentype2" />','<span id="usingTip">还可以选择<span id ="footnum">{{leftnum}}</span>个好友，当访问他们时不留脚印</span>',"</label>","</p>"].join(""),u=t.render(o,s),a="";for(var f=e.length-1;f>=0;f--){var l='<a href="#nogo" class="oneperson" id="'+e[f].id+'">'+'<img src="'+e[f].tinyUrl+'">'+'<div class="right">'+'<p class="name">'+e[f].name+"</p>"+'<p  class="x-to-hide"  >删除</p>'+"</div>"+"</a>";a=l+a}a='<div id="friendselectarea"><input class= "ui-friend-search"><div class="user-list" id="hiddenPeopleList" >'+a+"</div></div>",r(".privacy-foot .ui-widget-content").html(u+a)},bindEvents:function(){var e=this,t=r(".privacy-foot .ui-widget-content").find(".ui-friend-search");t.friendSearch({placeholder:"输入想隐身查看的好友",showGroupName:!1,groupName:"",selectEvent:function(t,n,r){var i={id:t,name:n,head:r};e.addNewPerson(i)}}),r(".privacy-foot").delegate(".x-to-hide","click",function(){e.removeFoot(this)}),r(".privacy-foot").delegate("#hiddentype1","click",function(){n=!0,r(".privacy-foot .ui-widget-content #friendselectarea").hide(),i!=1,i=1}),r(".privacy-foot").delegate("#hiddentype2","click",function(){n=!0,r(".privacy-foot .ui-widget-content #friendselectarea").show(),i!=2,i=2})},removeFoot:function(e){n=!0;var t=r(e).parents(".oneperson");t.remove();var i=parseInt(r(".privacy-foot .ui-widget-content").find("#footnum").text())+1;r(".privacy-foot .ui-widget-content").find("#footnum").html(i)},addNewPerson:function(e){if(r("#footnum").text()==0){r.dialog.error("已经选择了"+maxBlind+"个好友");return}var t=r(".user-list").children();for(var i=t.length-1;i>=0;i--)if(e.id==t[i].id){r.dialog.error("该好友已经在名单中。");return}n=!0;var s=['<img src="'+e.head+'">','<div class="right">','<p class="name">'+e.name+"</p>",'<p  class="x-to-hide" >删除</p>',"</div>"].join(""),o=document.getElementById("hiddenPeopleList"),u=o.childNodes[0],a=document.createElement("a");a.href="#nogo",a.className="oneperson",a.id=e.id,a.innerHTML=s,u?o.insertBefore(a,u):o.innerHTML=a.outerHTML;var f=parseInt(r(".privacy-foot .ui-widget-content").find("#footnum").text())-1;r(".privacy-foot .ui-widget-content").find("#footnum").html(f)},makecontent:function(){return r(".privacy-foot .ui-widget-content").html()==""?r(".foot-setting").html():r(".privacy-foot .ui-widget-content").find("#friendselectarea").html()},save:function(){var e=this,t="";if(i==1)t+="type=2&guestId=-1";else{var n=[],s=r(".user-list").children();for(var o=s.length-1;o>=0;o--)n.push(s[o].id);t+="type=1&guestId=-1&guestIds="+n.join("&guestIds=")}this.saveReq(t)},saveReq:function(e){n&&r.ajax({url:"http://www.renren.com/addhiddenfootprint",type:"post",data:e,dataType:"json",abortOnRetry:!0,success:function(e){var t=e;if(t.result==99){i==1?isToAll=!0:isToAll=!1;var n="您的设置已保存成功",s="您的设置已保存成功，访问隐身名单中的好友不留脚印",o;i==2?o=n:o=s,r.dialog.alert(o)}else t.result==101?r.dialog.alert("当天已经设置过10次，不能再设置了"):t.result==102?r.dialog.alert("非好友关系不能设置"):t.result==-1?r.dialog.alert("服务器错误！"):r.dialog.error("您当前无权限进行操作!")}})}};e.privacyFoot=s}),jQuery(function(){jQuery(document).on("click","[data-privacyfoot]",function(){var e=this.getAttribute("data-privacyfoot");define(function(require,t){var n=require("ui/showPrivacyFoot");n.privacyFoot.init(e)})})}),function(){var e,t,n,r,i,s;e=jQuery,i=!1,r=null,t=function(t,n,o,u,a){var f,l;if(i)return;return r=document.createElement("div"),f=n/2,l=a?31:Math.max(document.documentElement.scrollTop,document.body.scrollTop)+195,r.style.cssText="position:absolute;z-index:1990;left:50%;margin-left:-"+f+"px;top:"+l+"px;width:"+n+"px;height:"+o+"px;",a?(r.innerHTML='<div id="DULEISI_SWF"></div>',e("body").append(r),typeof swfobject=="undefined"?nx.load("http://s.xnimg.cn/jspro/lib/swfobject.js",function(){s(t,n,o)}):s(t,n,o)):(r.innerHTML='<embed src="'+t+'" type="application/x-shockwave-flash" width="'+n+'" height="'+o+'" wmode="transparent" allowscriptaccess="always" />',e("body").append(r)),i=!0},n=function(){i&&(r.parentNode.removeChild(r),i=!1)},s=function(t,n,r){var i={quality:"high",allowScriptAccess:"always",wmode:"transparent",bgcolor:"#FFFFFF",allowfullscreen:"false"},s={username:decodeURIComponent(nx.user.name),friHead01:"",friHead02:"",friHead03:""};s.userhead=nx.user.tinyPic;var o=e("#footprintList img");o.length&&(s.friHead01=o[0].src),o.length>=2&&(s.friHead02=o[1].src),o.length>=3&&(s.friHead03=o[2].src),swfobject.embedSWF(t,"DULEISI_SWF",n,r,"9.0.0","",s,i)},window.createHomeSwfAd=t,window.destroyHomeSwfAd=window.closeKsf=n}(),require(["jquery","ui/tabs"],function(e){var t={fortuneTab:"rp",footprintTab:"fp",birthTab:"bn"},n=["rp","fp","bn"];e(function(){var r=n.indexOf(e("#mergeSelected").val());e("#mergeModule").tabs({active:r>-1?r:0,activate:function(n,r){e.ajax({url:"http://www.renren.com/ajax/rightTabSelect",type:"POST",data:"rselected="+t[r.newTab.attr("id")],dataType:"text"})}})})}),define("fortune/fortuneItem",function(require,e){require("ui/tooltip");var t=require("jquery"),n=require("fortune/fortunePopup");e.ItemBody=function(){var e=this;e.s_item=t("#fortune"),e.s_itemBody=t("#fortune-side-item-body"),e.s_packUpBtn=e.s_item.find("#packUp"),e.s_unFoldBtn=e.s_item.find("#unFold"),e.s_assembleBtn=t("#assembleBtn"),e.s_freshBtn=e.s_item.find("#myFreshBtn"),e.s_getFreshTime=t("#interval").val(),e.init=function(){e.s_itemBody.css("display")=="none"&&e.s_item.addClass("packup"),e.CountFresh(),e.TitleHover(),e.AssbtnClick();var t=require("fortune/bodyHover");e.s_bodyHover=new t.BodyHover,e.s_bodyHover.HoverInit(e.s_getFreshTime)},e.init()},e.ItemBody.prototype={CountFresh:function(){var e=this;setTimeout(function(){e.s_freshBtn.addClass("active"),e.s_freshBtn.css("cursor","pointer");var t=e.s_item.find(".freshClock");t[0]&&t.css("display","none")},e.s_getFreshTime)},TitleHover:function(){var e=this;e.s_unFoldBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}}}),e.s_packUpBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}}})},AssbtnClick:function(){var e=this;e.s_assembleBtn.click(function(){var r=/msie 7/i.test(navigator.userAgent);r&&t(".nx-right").addClass("setzIndex"),e.s_packUpBtn.hide(),t("#forPopupBox").length==0&&(n.createPopup(),e.popupShow=new n.PopupShow),e.s_assembleBtn.hasClass("inactive")?e.popupShow.s_popupBox.css("display")=="none"&&e.popupShow.PopupType(0,e.s_bodyHover):e.popupShow.PopupType(1,e.s_bodyHover)})}}}),define("fortune/bodyHover",function(require,e){var t=require("jquery");e.BodyHover=function(){var e=this;e.s_item=t("#fortune"),e.s_itemBody=t("#fortune-side-item-body"),e.s_midContent=e.s_item.find(".for_content"),e.s_assembleBtn=t("#assembleBtn"),e.s_freshBtn=e.s_item.find("#myFreshBtn")},e.BodyHover.prototype={HoverInit:function(e){var t=this;t.s_getFreshTime=e,t.ChangeTime(),t.AssbtnHover(),t.FreshHover(208),t.ContentHover(),t.s_itemBody.css("display")=="none"&&t.BigitemSwitch("off"),t.LearnMoreHover()},AssbtnHover:function(){var e=this,n=t("#userIfPin").val();e.s_assembleBtn.attr("title",""),n=="true"?e.s_assembleBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-10",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}},content:"已攒"}):e.s_assembleBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-10",at:"left+66 top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").css("left","30px").appendTo(this)}},content:"点击即可随机获取人品值"})},FreshHover:function(e){var n=this;n.s_freshBtn.attr("title",""),n.s_freshBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"right+6 bottom-15",at:"left+56 top",using:function(n,r){t(this).css(n),t("<div>").addClass("right-opt-tip-arrow").css("left",e+"px").appendTo(this)}},content:function(){return n.FormatTime()}})},FormatTime:function(){var e=this,t=Math.floor(e.s_getFreshTime/6e4),n=Math.floor(e.s_getFreshTime%6e4/1e3),r=t+"分"+n+"秒",i;return e.s_getFreshTime<=0?(i="立即刷新页面即可获得1点RP",e.FreshHover(138)):i="每半小时刷新页面可获得1点RP ， 距离下<br>次还有"+r+"。",i},ContentHover:function(){var e=this;e.s_midContent.attr("title",""),e.s_midContent.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}},content:"点击查看更多"})},BigitemSwitch:function(e){var t=this;e=="on"?(t.s_assembleBtn.tooltip("enable"),t.s_midContent.tooltip("enable"),t.s_freshBtn.tooltip("enable")):e=="off"&&(t.s_assembleBtn.tooltip("disable"),t.s_midContent.tooltip("disable"),t.s_freshBtn.tooltip("disable"))},ChangeTime:function(){var e=this;setTimeout(function(){e.s_getFreshTime-=1e3,e.ChangeTime()},1e3)},LearnMoreHover:function(){var e=this;e.s_learnMoreBtn=t("#rpLearnMoreIcon"),e.s_learnMoreBtn.attr("title",""),e.s_learnMoreBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}},content:function(){var e=[];return e.push('<h3 class="fortuneLearnH3">什么是攒人品？</h3>'),e.push('<h4 style="margin-top:10px" class="fortuneLearnH4"><div class="rpLearnIcon"></div>人品值=Renren Power，是你长期混迹于人人网的象征</h4>'),e.push('<h4 class="fortuneLearnH4"><div class="rpLearnIcon"></div>每日点击一下“攒”可随机获得一定人品值</h4>'),e.push('<h4 class="fortuneLearnH4"><div class="rpLearnIcon"></div>每半小时刷新页面，也可得到1点人品值</h4>'),e.push('<h4 class="fortuneLearnH4"><div class="rpLearnIcon"></div>积攒来的人品值可以兑换各种心仪的礼品</h4>'),'<div class="rpLearnBoxWin">'+e.join("")+"</div>"}})}}}),define("fortune/fortunePopup",function(require,e){var t=require("jquery"),n=require("fortune/publisher");e.createPopup=function(){var e='<div class="fortune_popup" id="forPopupBox">                                                                              <div class="fortune_win" id="fortune_win">                                                                                    <div class="fortune_win_close" id="for_win_close"></div>                                                                                    <div class="box_mask" id="box_mask"></div>                                                                                    <div class="score_float_layer" id="score_float">                                                                                          <div class="center_box">                                                                                                <div class="text_box" id="for_scoreF_text">                                                                                                        <span><img src="http://a.xnimg.cn/imgpro/emotions/tie/18.gif" class="for_scoreF_emotion"/>恭喜您获得了<br/><span class="score_num" id="scoreNum">8</span>人品值</span>                                                                                                </div>                                                                                                <div class="verticalLine"></div>                                                                                                <div class="unlockModule">                                                                                                        <img id="rpUnlockObj"  src="http://a.xnimg.cn/n/apps/rp/res/unlockObj.png"/>                                                                                                        <div class="unlockAni"></div>                                                                                                        <span>成功解锁了每日一攒</span>                                                                                                        <a href="http://renpin.renren.com/myrp" target="_blank">全部解锁</a>                                                                                                </div>                                                                                          </div>                                                                                          <div id="rpPubSucIcon"></div>                                                                                    </div>                                                                                    <div class="popup_content_box success_unlock_box">                                                                                               <div class="unlock_obj_box">                                                                                                          <input type="hidden" class="IDhideValue"></input>                                                                                                </div>                                                                                                <div id="rpUnlockPubBox">		                                                                            <textarea name="content" placeholder="点击“炫耀一下”可获取一次攒人品机会" id="rpStatus"></textarea>		                                                                            <a href="javascript:void(0)" id="rpPubSubmit" class="ui-button-blue ui-button">炫耀一下</a>		                                                                            <span class="chars-info"><span class="chars-count">0</span>/200</span>                                                                                                </div>                                                                                    </div>                                                                                    <div class="popup_content_box no_unlock_box">                                                                                                          <span class="desc"><img src="http://a.xnimg.cn/imgpro/emotions/tie/18.gif" class="for_scoreF_emotion"/>恭喜您获得了<br/><span class="score_num"></span>人品值</span>                                                                                                <a href="http://renpin.renren.com/myrp" target="_blank" class="question"><div class="whatIcon"></div>什么是人品值？攒人品有什么用？</a>                                                                                    </div>                                                                                    <div class="for_affirm_box" id="for_affirm">                                                                                                 <div class="for_affirm_text">                                                                                                  	<span>如果关闭就会失去一次再攒人品的机会，</br>确定关闭吗？</span>                                                                                                 </div>                                                                                                <div  class="button_box">                                                                                                       <a href="#" class="for_submit ui-button-blue ui-button" id="for_sub_btn">确认</a>                                                                                                       <a href="#" class="for_cancel ui-button-white ui-button" id="for_can_btn">取消</a>                                                                                                </div>                                                                                    </div>                                                                                    <div class="popup_content_box rank_list_box">                                                                                                <div class="assembledTip">你今天攒过了，尝试每半小时刷新获取更多人品吧</div>                                                                                                <div class="todayRpRank" id="todayRpRank">                                                                                                          <h3>今日人品排名</h3><a href="http://renpin.renren.com/myrp" target="_blank" class="viewMore">查看更多</a>                                                                                                          <ul>                                                                                                                  <li id="rpRankOne"><div class="rankBox"><a class="rpRankHead" target="_blank"><img src=""/></a></div><a class="rankName" target="_blank"></a><span class="rankRp">15</span></li>                                                                                                                  <li id="rpRankTwo"><div class="rankBox"><a class="rpRankHead" target="_blank"><img src=""/></a></div><a class="rankName" target="_blank"></a><span class="rankRp">15</span></li>                                                                                                                  <li id="rpRankThree"><div class="rankBox"><a class="rpRankHead" target="_blank"><img src=""/></a></div><a class="rankName" target="_blank"></a><span class="rankRp">15</span></li>                                                                                                          <ul>                                                                                                </div>                                                                                                <div class="rpMallEntry"><span>攒了这么多RP，看看能兑换点什么吧？</span><a href="http://renpin.renren.com/mall" class="mall_button" target="_blank">RP兑换中心</a></div>                                                                                    </div>                                                                        </div></div>'
;t("#fortune-side-item-body").append(e)},e.PopupShow=function(){var e=this;e.s_item=t("#fortune"),e.s_popupBox=t("#forPopupBox"),e.s_fortuneWin=t("#fortune_win"),e.s_contentBox=e.s_fortuneWin.find(".popup_content_box "),e.s_unlockBox=e.s_item.find(".success_unlock_box"),e.s_noUnlockBox=e.s_item.find(".no_unlock_box"),e.s_rankListBox=e.s_item.find(".rank_list_box"),e.s_scoreFloat=t("#score_float"),e.s_assembledIcon=e.s_item.find(".assembled"),e.s_fortuneWinClose=t("#for_win_close"),e.s_affirmBox=t("#for_affirm"),e.s_closeAble=!0,e.s_popOpen=!1,e.ForWinClose()},e.PopupShow.prototype={PopupType:function(e,t){var n=this;n.s_showType=e,n.DocCloseFun(),n.s_showType==0?n.RankListPopup():n.s_showType==1&&n.GetRpPopup(),n.s_bodyHover=t},RankListPopup:function(){var e=this,n=t(".double-cols-feed");e.RankAjax(),e.InitSize(345,420),n[0]?e.s_fortuneWin.css("left","0px"):e.s_fortuneWin.css("right","-88px"),e.s_contentBox.hide(),e.s_popupBox.show(),e.s_rankListBox.show()},RankAjax:function(){var e=this;t.ajax({url:"http://renpin.renren.com/info/rankinfo",type:"POST",dataType:"json",success:function(n){if(n.code==0){var r=n.data;for(var i=0;i<3;i++)if(r[i]){var s=t("#todayRpRank").find("li").eq(i);s.css("visibility","visible"),s.find(".rpRankHead").attr("href","http://www.renren.com/"+r[i].userId+"/profile").find("img").attr("src",r[i].pic),s.find(".rankName").attr("href","http://www.renren.com/"+r[i].userId+"/profile").html(r[i].name),s.find(".rankRp").html(r[i].dailyRp)}e.s_closeAble=!0,e.s_popOpen=!0,e.s_bodyHover.BigitemSwitch("off")}else t.dialog.error(n.msg)},error:function(){t.dialog.error("服务器异常,请稍后再试!")}})},InitSize:function(e,t){var n=this;n.s_fortuneWin.css({height:e+"px",width:t+"px"}),n.s_popupBox.css("width",t+2+"px")},GetRpAjax:function(){var e=this;t.ajax({url:"http://renpin.renren.com/action/collectrp",type:"POST",dataType:"json",success:function(n){if(n.code==0){var r=n.unlockInfo;e.s_ifUnlock=r.id,n.currRp==-1?e.s_popupBox.find(".for_scoreF_emotion").show():e.s_popupBox.find(".for_scoreF_emotion").hide(),e.s_popupBox.find(".score_num").html(n.currRp),t("#bTotalRpNum").html(n.rp),t("#bTodayRpNum").html(n.dailyRp),t("#totalRp").val(n.rp);if(t(".assembled").length==0){var i='<div class="assembled"></div>';t(".fortuneBar").append(i),e.s_assembledIcon=e.s_item.find(".assembled")}t("#userIfPin").val("true"),t("#assembleBtn").addClass("inactive"),e.s_bodyHover.AssbtnHover(),e.s_bodyHover.BigitemSwitch("off"),e.s_assembledIcon.show(),typeof e.s_ifUnlock=="undefined"?e.NoUnlockPopup():(e.s_unlockBox.find(".unlock_obj_box").append('<img id="unlock_new_obj" src="'+r.fullurl+'"/>'),e.s_unlockBox.find(".IDhideValue").attr("value",r.id),t("#rpUnlockObj").attr("src",r.picUrl),e.s_scoreFloat.find(".unlockModule span").html('成功解锁了"'+r.name+'"'),e.UnlockPopup(r.name))}else t.dialog.error(n.msg)},error:function(){t.dialog.error("服务器异常,请稍后再试!")}})},GetRpPopup:function(){var e=this;e.GetRpAjax()},UnlockPopup:function(e){var r=this;r.s_closeAble=!1,r.s_popOpen=!0,r.InitSize(250,360),r.s_contentBox.hide(),r.s_fortuneWin.css("right","-61px"),new n.fortunePublisher("#rpUnlockPubBox"),r.s_pubSubmit=t("#rpPubSubmit"),r.s_pubContent=t("#rpStatus"),r.PubSubmit(e),r.s_popupBox.show(),r.s_unlockBox.show(),r.FloatAni(0)},NoUnlockPopup:function(){var e=this;e.s_closeAble=!0,e.s_popOpen=!0,e.s_fortuneWin.css("right","0"),e.InitSize(150,238),e.s_contentBox.hide(),e.s_popupBox.show(),e.s_noUnlockBox.show()},FloatAni:function(e){var n=this,r=3e3;n.s_scoreFloatCenter=n.s_scoreFloat.find(".center_box"),n.s_pubIcon=t("#rpPubSucIcon"),e==1?(r=3e3,n.s_scoreFloatCenter.hide(),n.s_pubIcon.show()):(n.s_scoreFloatCenter.show(),n.s_pubIcon.hide()),n.s_scoreFloat.show(),setTimeout(function(){n.s_scoreFloat.fadeOut("slow")},r)},PubSubmit:function(e){var r=this;r.s_pubSubmit.unbind("click"),r.s_pubSubmit.click(function(){if(n.publisherCheck("#rpUnlockPubBox")&&!r.s_pubSubmit.hasClass("ui-state-disabled")){r.s_pubSubmit.addClass("ui-state-disabled");var i=r.s_pubContent.val(),s=r.s_unlockBox.find(".IDhideValue").val();if(i==""||i=="点击“炫耀一下”可获取一次攒人品机会")i='成功解锁了"'+e+'"!';t.ajax({url:"http://renpin.renren.com/action/publish",type:"POST",data:"content="+i+"&unlockid="+s+"&from=1",dataType:"json",success:function(e){if(e.code==0){var n=e.unlockInfo;r.s_pubContent.val(""),r.FloatAni(1),setTimeout(function(){t(".nx-right").hasClass("setzIndex")&&t(".nx-right").removeClass("setzIndex"),r.s_popupBox.hide(),e.auth&&(t("#assembleBtn").removeClass("inactive"),r.s_assembledIcon.hide(),t("#userIfPin").val("false"),r.s_bodyHover.AssbtnHover()),r.s_closeAble=!0,r.s_popOpen=!1,r.s_bodyHover.BigitemSwitch("on"),t("#unlock_new_obj").remove(),r.s_pubSubmit.removeClass("ui-state-disabled")},3e3)}else t.dialog.error(e.msg)},error:function(){t.dialog.error("服务器异常,请稍后再试!")}})}})},ForWinClose:function(){var e=this;e.s_affirmCancelBtn=t("#for_can_btn"),e.s_affirmSubmitBtn=t("#for_sub_btn"),e.s_fortuneWinClose.click(function(){e.s_closeAble?(t(".nx-right").hasClass("setzIndex")&&t(".nx-right").removeClass("setzIndex"),e.s_popupBox.hide(),e.s_popOpen=!1,e.s_bodyHover.BigitemSwitch("on")):e.CloseAffirmFun()}),e.s_affirmCancelBtn.click(function(){e.s_affirmBox.slideUp("fast")}),e.s_affirmSubmitBtn.click(function(){t(".nx-right").hasClass("setzIndex")&&t(".nx-right").removeClass("setzIndex"),e.s_affirmBox.hide(),e.s_popupBox.hide(),e.s_pubContent.val(""),e.s_closeAble=!0,e.s_popOpen=!1,e.s_bodyHover.BigitemSwitch("on"),t("#unlock_new_obj").remove()})},DocCloseFun:function(){var e=this,n=!0;t(document).bind("click.fortune",function(){n&&e.s_closeAble&&e.s_popOpen&&(t(".nx-right").hasClass("setzIndex")&&t(".nx-right").removeClass("setzIndex"),e.s_popupBox.hide(),e.s_popOpen=!1,e.s_bodyHover.BigitemSwitch("on"),t(document).unbind("click.fortune")),n=!0}),e.s_popupBox.click(function(){n=!1})},CloseAffirmFun:function(){var e=this;e.s_affirmBox.slideDown("fast")}}}),define("fortune/publisher",function(require,e){var t=require("jquery");e.fortunePublisher=function(e){var n=this;n.s_container=t(e),n.s_pubBtn=t("#rpPubSubmit"),n.s_pubInput=t("#rpStatus"),n.s_charsBox=n.s_container.find(".chars-info"),n.s_countText=n.s_container.find(".chars-count"),n.s_charsTotal=200,n.init=function(){n.OpenAt(),n.TextareaClick(),n.StopClick()},n.init()},e.fortunePublisher.prototype={OpenAt:function(){var e=this;require.async(["ui/renren/at"],function(){e.s_pubInput.renrenat()})},TextareaClick:function(){var e=this;e.s_pubInput.click(function(){e.StartCharsCounter()})},StartCharsCounter:function(){var e=this;if(e.s_charsTotal<0)return;e.s_charsCounter=setInterval(function(){e.UpdateCharsCount()},500)},StopCharsCounter:function(){clearInterval(self.s_charsCounter)},UpdateCharsCount:function(){var e=this,t=e.GetLength(e.s_pubInput.val());e.s_countText.text(t.toString()),parseInt(e.s_countText.text())>200?(e.s_charsBox.addClass("active"),e.s_pubBtn.addClass("ui-state-disabled")):(e.s_charsBox.removeClass("active"),e.s_pubBtn.removeClass("ui-state-disabled"))},GetLength:function(e){var t=this,n=e.length;return n},StopClick:function(){var e=this;e.s_pubBtn.click(function(){e.StopCharsCounter()}),t("#for_sub_btn").click(function(){e.StopCharsCounter()})}},e.publisherCheck=function(e){var n=this,r=!0;return n.s_container=t(e),n.s_countText=n.s_container.find(".chars-count"),parseInt(n.s_countText.text())>200&&(r=!1),r}}),define(function(require,e){var t=require("fortune/fortuneItem");jQuery(function(e){new t.ItemBody})}),define("right/birthMoudle",function(require,e){require("ui/tooltip");var t=require("jquery");e.BirthBody=function(){var e=this;e.birthBox=t("#homeBirthdayPart"),e.pageIndex=1,e.totalPage=Math.ceil(t("#birthNum").val()/3),e.init=function(){e.setBgImg(),e.titleHover(),e.sendGift(),e.turnPage(),e.initName(),e.totalPage>1&&e.initOption()},e.init()},e.BirthBody.prototype={setBgImg:function(){var e=t("#birthNoticeList"),n=t("#homeBirthdayPart"),r=e.find("li");r.length>1&&n.removeClass("double-nobirth-bg")},initOption:function(){var e=this,t=e.birthBox.find(".pager-forward,.pager-back");e.birthBox.hover(function(){t.show()},function(){t.hide()})},titleHover:function(){var e=this;e.birthBox.find(".pager-forward,.pager-back,.more").tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}}})},sendGift:function(){var e=this;t(document).on("click","#homeBirthdayPart .giftBtn",function(){e.birthBox.find(".birthListBox").removeClass("overHide"),t("#mergeModule").addClass("overHide");var n='<div class="optionBox"><a href="javascript:;" id="bSendGift">送Ta礼物</a><a id="bSendMsg" href="javascript:void(0)" onclick="window.webpager.talk('+t(this).attr("data")+')">给Ta留言</a></div>';t(this).parent().css("z-index",10).append(n),t(".mergeBody").css({"z-index":10,position:"relative"}),e.bindClick(t(this).attr("data")),e.docClick()}),t("#birthNoticeList").delegate(".common-sendGift","click",function(){var n=t(this).attr("data-id");return e.sendGiftFn(n),!1})},initName:function(){var e=this;if(e.birthBox.find(".name").length>0){var t=e.birthBox.find(".name"),n=t.length;for(var r=0;r<n;r++){var i=t.eq(r).html(),s=i.replace(/[^\x00-\xff]/g,"**").length;s>=11?e.nameHover(t.eq(r)):t.eq(r).removeAttr("title")}}},nameHover:function(e){var n=this;e.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,n){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}}})},docClick:function(){var e=this;t(document).bind("click.birth",function(){e.birthBox.find(".optionBox").parent().removeAttr("style"),t(".mergeBody").removeAttr("style"),e.birthBox.find(".optionBox").remove(),e.birthBox.find(".birthListBox").addClass("overHide"),t("#mergeModule").removeClass("overHide"),t(document).unbind("click.birth")})},sendGiftFn:function(e){var n=this;this.giftModuleInited?n.showBirthDialog(e):t.ajax({url:"http://i.renren.com/api4v7/getV7BirthGiftJsSrc",type:"post",dataType:"json",success:function(t){define.config({map:{"vip/plugin/sendBirthGift":t[0]}}),n.giftModuleInited=!0,n.showBirthDialog(e)}})},bindClick:function(e){var n=this;t("#bSendGift").click(function(){n.sendGiftFn(e)})},showBirthDialog:function(e){define(["vip/plugin/sendBirthGift"],function(t){t.initialize(e)})},turnPage:function(){function o(){var s=3,o="-215px",u='<div class="listGroup">';if(e.birthBox.find(".listGroup").length<=e.pageIndex){var a=e.pageIndex==e.totalPage-1?r.length:(e.pageIndex+1)*3;for(var f=e.pageIndex*s;f<a;f++){var l=r[f].name,c=l.replace(/[^\x00-\xff]/g,"**").length,h=c>=11?"overLen":"removeTitle";u+='<li class="common-item"><div class="ui-button giftBtn" data="'+r[f].id+'"><span>送礼</span><div class="arrowIcon"></div></div>'+'<a href="http://www.renren.com/'+r[f].id+'/profile" namecard="'+r[f].id+'" class="userPhoto"><img src="'+r[f].tinyPhotoUrl+'"/></a>'+'<a href="http://www.renren.com/'+r[f].id+'/profile" namecard="'+r[f].id+'" class="name '+h+'" title="'+r[f].name+'">'+r[f].name+'</a><span class="birthday">'+r[f].birthString+"</span>"+'<p class="birthday-item-ctl"><a href="javascript:;" class="common-sendGift" data-id="'+r[f].id+'">送礼</a>'+'|<a href="javascript:;" class="leave-message" onclick="window.webpager.talk('+r[f].id+');return false;">留言</a></p></li>'}u+="</div>";var p=t(u);e.nameHover(t(".overLen",p)),t(".removeTitle",p).removeAttr("title"),t("#birthNoticeList").append(p)}n=!0,e.birthBox.find(".listGroup").not(":eq("+(e.pageIndex-1)+"),:eq("+e.pageIndex+")").hide(),e.birthBox.find(".listGroup").eq(e.pageIndex-1).animate({"margin-left":o},function(){e.birthBox.find(".listGroup").eq(e.pageIndex-1).hide(),e.pageIndex++;if(e.pageIndex===e.totalPage){var r=e.birthBox.find(".listGroup").eq(e.pageIndex-1),s=r.children("li").length;s==1&&t("#homeBirthdayPart").addClass("double-nobirth-bg"),i.addClass("forward-disable")}n=!1})}var e=this,n=!1,r=null,i=e.birthBox.find(".pager-forward"),s=e.birthBox.find(".pager-back");i.click(function(){if(t(this).hasClass("forward-disable")||n)return!1;e.birthBox.find(".listGroup").show(),s.removeClass("back-disable"),r===null?t.ajax({url:"http://www.renren.com/ajaxFriendBirthdays/get7daysFriendBirthdays",type:"post",dataType:"json",success:function(e){r=e.friendBirthdays,o()}}):o()}),s.click(function(){if(t(this).hasClass("back-disable")||n)return!1;t("#homeBirthdayPart").removeClass("double-nobirth-bg"),i.removeClass("forward-disable"),e.birthBox.find(".listGroup").show(),n=!0,e.birthBox.find(".listGroup").not(":eq("+(e.pageIndex-2)+"),:eq("+(e.pageIndex-1)+")").hide(),e.birthBox.find(".listGroup").eq(e.pageIndex-2).animate({"margin-left":"0"},function(){e.birthBox.find(".listGroup").eq(e.pageIndex-1).hide(),e.pageIndex--,e.pageIndex===1&&s.addClass("back-disable"),n=!1})})}}}),define(function(require,e){var t=require("right/birthMoudle");jQuery(function(e){new t.BirthBody})}),require(["jquery","ui/tabs"],function(e){var t=e("#viparea"),n=e("#viparea-main-area"),r=e(".notice-area");t.tabs({collapsible:!0,memoryKey:"homevipareawrapper",activate:function(t,r){e.ajax({type:"POST",dataType:"text",url:"http://i.renren.com/homecenter/pop",data:"ispop="+r.newTab.length?0:1}),r.newPanel.length?(e("#viparea-control").addClass("slide-control-opened"),n.addClass("viparea-show")):(e("#viparea-control").removeClass("slide-control-opened"),n.removeClass("viparea-show"))}}),n.tabs({event:"mouseenter",memoryKey:"homeviparea",active:e("#viparea-main-area").data("tab"),beforeLoad:function(t,n){if(n.panel.children().length!==0)return!1;e.extend(n.ajaxSettings,{type:"post",dataType:"text",success:function(e){n.panel.html(e)},error:function(){n.panel.html("网络服务异常，请稍后再试")}})},activate:function(t,n){var r=n.newTab.siblings().addBack().index(n.newTab);e("#viparea_nav span").animate({left:r*35+"px"})}}),n.on("click",".viparea_area_c a",function(t){if(this.hash&&this.hash.indexOf("#/viparea/")===0){t.preventDefault(),n.trigger("componentChange");var r=this.hash.split("/");require([r.slice(1,4).join("/")],function(t){t.init({reset:e.noop,con:{on:function(e,t){n.on(e,t)}}},r.slice(4))})}}),r.find(".close-notice-area").click(function(){r.remove();var t=r.find(".notice-content");e.ajax({type:"POST",dataType:"text",url:"http://i.renren.com/api4v7/cancelMemberZoneDisplay?uid="+nx.user.id+"&displayId="+t.attr("data-id")+"&position="+t.attr("data-position")})})}),function(){function i(){t.hide()}$=jQuery;var e=$("#vip_fixed_point"),t=$("#vip-notice-all"),n=$(".vip-notice-dialog"),r=$("#notice-buttons");if(!n.length)return;e.append(t),t.show(),t.find(".ui-widget-content").replaceWith(n.addClass("ui-widget-content").show()),r.length&&t.find(".ui-dialog-buttonset").replaceWith(r.addClass("ui-dialog-buttonset").show()),t.find(".ui-dialog-close").click(function(){i()})}(),define("home/safeAuth",function(require,e,t){var n,r,i,s,o,u,a,f,l;return n=require("jquery"),require("ui/dialog"),r=require("mustache.js"),o='<div class="dialog-safe">\n <p>为了亲的帐号安全考虑，完成一个快速的安全实名认证吧！</p>\n</div> ',u='<div class="verify-form">\n  <div class="header"><h3>进行安全验证</h3></div>\n  <div class="item">\n    <div class="leftpart"><label for="regMobile">手机号码&nbsp;:</label></div>\n    <div class="rightpart">\n      <input type="text" name="mobile" id="regMobile" maxlength="11" tabindex="1" class="left" autocomplete="off">\n    </div>\n  </div>\n  <div class="item">\n    <div class="leftpart"><label for="icode">短信验证码&nbsp;:</label></div>\n    <div class="rightpart">\n      <input type="text" name="icode" id="icode" class="left verify_icode" maxlength="6" value="" tabindex="3"> \n      <button type="button" id="btn_getcode" class="verify_geticode ui-button ui-button-default" tabindex="4">发送验证码</button>\n    </div>\n  </div>\n</div>',a={error:'<span class="msginfo">\n  <i class="ui-icon ui-iconfont icon-error" title="{{msg}}">&#xe877;</i>\n</span>',success:'<span class="msginfo"><i class="ui-icon ui-iconfont icon-success"></i></span>'},l=null,s=function(){return n(o).dialog({appendTo:"body",dialogClass:"ui-dialog-confirm",buttons:[{text:"现在就去","class":"ui-button-green",click:function(){return f(),n(this).dialog("instance").destroy()}}]})},f=function(){return l=n(u).dialog({appendTo:"body",dialogClass:"ui-dialog-confirm",width:480,buttons:[{text:"完成","class":"ui-button-green complete-secur-verify",click:function(){return i.sendPost()}}]}),i.init()},i={mobile:"",code:"",t:60,getCodeUrl:"http://reg.renren.com/realinfo/verify/downCode",bindUrl:"http://reg.renren.com/realinfo/bindMobile",init:function(){return n(function(){return n(".item").on("keyup","input",function(e){var t;t=n(e.currentTarget),t.attr("name")==="mobile"&&(i.mobile=n.trim(t.val()));if(t.attr("name")==="icode")return t.val().length>6&&t.val(t.val().substring(0,6)),i.code=n.trim(t.val())}),n(".item").on("focusout","input",function(e){var t,r;return r=i,t=n(e.currentTarget),i.verify[t.attr("name")](t,r),i.btnActive()}),n(".item").on("focusin","input",function(e){var t;return t=n(e.currentTarget),t.parent().find(".msginfo").remove()}),n("#btn_getcode").on("click",function(e){return/^1[3|4|5|7|8][0-9]\d{8}$/.test(i.mobile)?(i.getCode(),n(this).prop("disabled",!0)):n.dialog.error("请输入正确的手机号")})})},sendPost:function(){var e;e=n(".complete-secur-verify"),i.verify.mobile(n("#regMobile"),i,!0)&&i.verify.icode(n("#icode"),i,!0);if(e.hasClass("active"))return i.bindMobile(),e.prop("disabled",!0)},btnActive:function(){return n(".verify-form").find(".icon-success").length===2?n(".complete-secur-verify").addClass("active"):n(".complete-secur-verify").removeClass("active")},verify:{mobile:function(e,t,r){return t.mobile.length===0?(t.infoMsg.error(e,"手机号不能为空"),r&&n.dialog.error("手机号不能为空"),!1):/^1[3|4|5|7|8][0-9]\d{8}$/.test(t.mobile)?(t.infoMsg.success(e),!0):(t.infoMsg.error(e,"请输入正确的手机号"),r&&n.dialog.error("请输入正确的手机号"),!1)},icode:function(e,t,r){return t.code.length===0?(t.infoMsg.error(e,"验证码不能为空"),r&&n.dialog.error("验证码不能为空"),!1):/^\d{6}$/.test(t.code)?t.infoMsg.success(e):(t.infoMsg.error(e,"请输入有效的验证码"),r&&n.dialog.error("请输入有效的验证码"),!1)}},infoMsg:{error:function(e,t){var n;return n=r.render(a.error,{msg:t}),e.parent().find(".msginfo").remove().end().append(n)},success:function(e){return e.parent().find(".msginfo").remove().end().append(a.success)}},timeInterval:function(){var e,t,r;return t=i,e=n("#btn_getcode"),e.text(t.t+"秒重新发送"),r=setInterval(function(){return t.t!==0?(t.t--,e.text(t.t+"秒重新发送")):(clearInterval(r),t.t=60,e.text("发送验证码").prop("disabled",!1))},1e3)},getCode:function(){var e;return e=this,n.ajax({url:e.getCodeUrl,type:"get",data:{mobile:this.mobile},dataType:"json"}).done(function(t){return t.code===0?e.timeInterval():(n.dialog.error(t.msg),n("#btn_getcode").prop("disabled",!1))}).fail(function(e){return n.dialog.error("服务异常,请稍后重试"),n("#btn_getcode").prop("disabled",!1)})},bindMobile:function(){var e;return e=this,n.ajax({url:e.bindUrl,type:"post",data:{mobile:this.mobile,code:this.code},dataType:"json"}).done(function(e){return e.code===0?(n(".complete-secur-verify").remove(),l.dialog("instance").destroy(),window.location.href="http://www.renren.com"):(n.dialog.error(e.msg+"或者验证码已经过期"),n(".complete-secur-verify").prop("disabled",!1))}).fail(function(){return n.dialog.error("服务异常，请稍后重试"),n(".complete-secur-verify").prop("disabled",!1)})}},t.exports={init:s}}),require(["home/safeAuth","jquery"],function(e,t){return t.get("http://www.renren.com/ajax/realnamecheck/isNeedPop",function(t){if(t.errCode===0&&t.isNeedPop===!0)return e.init()},"json")});